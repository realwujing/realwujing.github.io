

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/images/favicon.jpg">
  <link rel="icon" href="/images/favicon.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Wu Jing">
  <meta name="keywords" content="3d, Linux-0.11-yuan-xy, ThreadPool, acpi, algorithm, architect, assembly, baohua, binary-analysis, books, boot, bpf, bugs, cmake-objdump, console, container, cpp, dbus, deb, debug, deepin, develop, disk, distro, docker, drivers, extern, fluid, fs, gdb, git, go, gpu, grtrace, grub, hello_world, hexo, irq, java, javascript, jenkins, k8s, kdump, kernel, kickstart, kms, kvm, linux, linux-0.11-debug, log, ltp, markdown, minifs, mm, modules, monitoring, mutex, my-project, net, nginx, patent, perf, perf-event, performance, phytium, pkg, power, proc, protobuf, protobuf_example, proxy, pthread, pulseaudio, python, qemu, qprocess_wget, qt-learning, rcu, redis, rpm-ostree, runoob-vue3-test, security, shell, sound, sources, stanford-cs336, stap, struct, svn, sync, sysrq_trigger, task, testing, thread, tick, todolist, tools, udl, unixbench, uts_namespace, valgrind, vim, virsh, virt, xisai">
  
    <meta name="description" content="grtrace å¼€å‘è¿­ä»£è®¡åˆ’ï¼ˆRoadmapï¼‰   Executive Summaryï¼ˆæ‘˜è¦ï¼‰  å½“å‰çŠ¶æ€ï¼ˆç®€è¿°ï¼‰ï¼šgrtrace å·²å®Œæˆ v0.1â€“v0.6 çš„æ ¸å¿ƒå®ç°ï¼ˆäº‹ä»¶æµã€METADATAã€å·¥å…·é“¾ä¸è‡ªæµ‹ï¼‰ã€‚v0.7&#x2F;v0.8 ä¸ºä¾›åº”å•†é€‚é…ä¸ç³»ç»Ÿè”åŠ¨çš„æŒç»­å·¥ä½œï¼Œv1.0å‘å¸ƒå°šæœªå®Œæˆã€‚ ç›®çš„ï¼šæœ¬æ–‡ä»¶é¡¶éƒ¨ç»™å‡ºä¸€é¡µå¼å¯è¯»æ¦‚è§ˆï¼ˆå¿«é€Ÿæ—¶é—´çº¿ + å½“å‰é˜»å¡ç‚¹ï¼‰ã€‚è¯¦ç»†çš„æŒ‰ç‰ˆæœ¬é‡Œç¨‹ç¢‘ç»§ç»­ä¿ç•™åœ¨ä¸‹æ–‡">
<meta property="og:type" content="article">
<meta property="og:title" content="grtrace å¼€å‘è¿­ä»£è®¡åˆ’ï¼ˆRoadmapï¼‰">
<meta property="og:url" content="https://realwujing.github.io/linux/drivers/gpu/grtrace/docs/grtrace%20%E5%BC%80%E5%8F%91%E8%BF%AD%E4%BB%A3%E8%AE%A1%E5%88%92/index.html">
<meta property="og:site_name" content="WuJing&#39;s Blog">
<meta property="og:description" content="grtrace å¼€å‘è¿­ä»£è®¡åˆ’ï¼ˆRoadmapï¼‰   Executive Summaryï¼ˆæ‘˜è¦ï¼‰  å½“å‰çŠ¶æ€ï¼ˆç®€è¿°ï¼‰ï¼šgrtrace å·²å®Œæˆ v0.1â€“v0.6 çš„æ ¸å¿ƒå®ç°ï¼ˆäº‹ä»¶æµã€METADATAã€å·¥å…·é“¾ä¸è‡ªæµ‹ï¼‰ã€‚v0.7&#x2F;v0.8 ä¸ºä¾›åº”å•†é€‚é…ä¸ç³»ç»Ÿè”åŠ¨çš„æŒç»­å·¥ä½œï¼Œv1.0å‘å¸ƒå°šæœªå®Œæˆã€‚ ç›®çš„ï¼šæœ¬æ–‡ä»¶é¡¶éƒ¨ç»™å‡ºä¸€é¡µå¼å¯è¯»æ¦‚è§ˆï¼ˆå¿«é€Ÿæ—¶é—´çº¿ + å½“å‰é˜»å¡ç‚¹ï¼‰ã€‚è¯¦ç»†çš„æŒ‰ç‰ˆæœ¬é‡Œç¨‹ç¢‘ç»§ç»­ä¿ç•™åœ¨ä¸‹æ–‡">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-11-21T18:06:27.000Z">
<meta property="article:modified_time" content="2025-11-21T18:06:27.000Z">
<meta property="article:author" content="Wu Jing">
<meta property="article:tag" content="bpf">
<meta property="article:tag" content="deb">
<meta property="article:tag" content="debug">
<meta property="article:tag" content="docker">
<meta property="article:tag" content="drivers">
<meta property="article:tag" content="fs">
<meta property="article:tag" content="git">
<meta property="article:tag" content="go">
<meta property="article:tag" content="gpu">
<meta property="article:tag" content="kernel">
<meta property="article:tag" content="linux">
<meta property="article:tag" content="log">
<meta property="article:tag" content="markdown">
<meta property="article:tag" content="perf">
<meta property="article:tag" content="performance">
<meta property="article:tag" content="python">
<meta property="article:tag" content="testing">
<meta property="article:tag" content="tools">
<meta property="article:tag" content="virt">
<meta property="article:tag" content="mm">
<meta property="article:tag" content="proc">
<meta property="article:tag" content="sync">
<meta property="article:tag" content="rcu">
<meta property="article:tag" content="irq">
<meta property="article:tag" content="grtrace">
<meta name="twitter:card" content="summary_large_image">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>grtrace å¼€å‘è¿­ä»£è®¡åˆ’ï¼ˆRoadmapï¼‰ - WuJing&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="/css/custom.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"realwujing.github.io","root":"/","version":"1.9.4","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":"6b5123e146041483d13bdfaeb6e42a76","google":"UA-265632133-1","gtag":"G-E7BV6T4RCW","tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  
    <!-- Baidu Analytics -->
    <script async>
      if (!Fluid.ctx.dnt) {
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?6b5123e146041483d13bdfaeb6e42a76";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
      }
    </script>
  

  
    <!-- Google Analytics -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript('https://www.google-analytics.com/analytics.js', function() {
          window.ga = window.ga || function() { (ga.q = ga.q || []).push(arguments) };
          ga.l = +new Date;
          ga('create', 'UA-265632133-1', 'auto');
          ga('send', 'pageview');
        });
      }
    </script>
  

  
    <!-- Google gtag.js -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript('https://www.googletagmanager.com/gtag/js?id=G-E7BV6T4RCW', function() {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-E7BV6T4RCW');
        });
      }
    </script>
  

  

  

  

  



  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>WuJing&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>é¦–é¡µ</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>å½’æ¡£</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>åˆ†ç±»</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>æ ‡ç­¾</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>å…³äº</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="grtrace å¼€å‘è¿­ä»£è®¡åˆ’ï¼ˆRoadmapï¼‰"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-11-21 18:06" pubdate>
          2025å¹´11æœˆ21æ—¥ æ™šä¸Š
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          39k å­—
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          327 åˆ†é’Ÿ
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">grtrace å¼€å‘è¿­ä»£è®¡åˆ’ï¼ˆRoadmapï¼‰</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="grtrace-å¼€å‘è¿­ä»£è®¡åˆ’ï¼ˆRoadmapï¼‰"><a href="#grtrace-å¼€å‘è¿­ä»£è®¡åˆ’ï¼ˆRoadmapï¼‰" class="headerlink" title="grtrace å¼€å‘è¿­ä»£è®¡åˆ’ï¼ˆRoadmapï¼‰"></a>grtrace å¼€å‘è¿­ä»£è®¡åˆ’ï¼ˆRoadmapï¼‰</h1><!-- markdownlint-disable MD013 -->

<blockquote>
<p>Executive Summaryï¼ˆæ‘˜è¦ï¼‰</p>
<ul>
<li>å½“å‰çŠ¶æ€ï¼ˆç®€è¿°ï¼‰ï¼šgrtrace å·²å®Œæˆ v0.1â€“v0.6 çš„æ ¸å¿ƒå®ç°ï¼ˆäº‹ä»¶æµã€METADATAã€<br>å·¥å…·é“¾ä¸è‡ªæµ‹ï¼‰ã€‚v0.7&#x2F;v0.8 ä¸ºä¾›åº”å•†é€‚é…ä¸ç³»ç»Ÿè”åŠ¨çš„æŒç»­å·¥ä½œï¼Œv1.0<br>å‘å¸ƒå°šæœªå®Œæˆã€‚</li>
<li>ç›®çš„ï¼šæœ¬æ–‡ä»¶é¡¶éƒ¨ç»™å‡ºä¸€é¡µå¼å¯è¯»æ¦‚è§ˆï¼ˆå¿«é€Ÿæ—¶é—´çº¿ + å½“å‰é˜»å¡ç‚¹ï¼‰ã€‚è¯¦ç»†çš„<br>æŒ‰ç‰ˆæœ¬é‡Œç¨‹ç¢‘ç»§ç»­ä¿ç•™åœ¨ä¸‹æ–‡â€œé™„å½• &#x2F; è¯¦ç»†é‡Œç¨‹ç¢‘â€éƒ¨åˆ†ï¼Œä¾¿äºé˜…è¯»ä¸å®¡é˜…ã€‚</li>
<li>å»ºè®®ï¼šæ—¥å¸¸ review&#x2F;è®¨è®ºä»¥æœ¬æ‘˜è¦ä¸ºåŸºå‡†ï¼›éœ€è¦å¯¹æŸä¸ªç‰ˆæœ¬æ·±å…¥æ—¶å†æ‰“å¼€â€œé™„å½•â€<br>é˜…è¯»è¯¦ç»†æ‹†è§£ã€‚</li>
</ul>
</blockquote>
<p>é…å¥—æ¶æ„æ–‡æ¡£ï¼š <a target="_blank" rel="noopener" href="https://github.com/realwujing/realwujing.github.io/blob/main/linux/drivers/gpu/grtrace/docs/GPU%20Ring%20Buffer%E8%BF%BD%E8%B8%AA%E6%9E%B6%E6%9E%84%E6%B7%B1%E5%BA%A6%E5%88%86%E6%9E%90%EF%BC%9A%E4%BB%8Eblktrace%E5%88%B0grtrace%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%BC%94%E8%BF%9B.md">GPU Ring Bufferè¿½è¸ªæ¶æ„æ·±åº¦åˆ†æï¼šä»blktraceåˆ°grtraceçš„è®¾è®¡æ¼”è¿›</a></p>
<hr>
<h2 id="ç®€åŒ–æ—¶é—´çº¿ï¼ˆå¿«é€ŸæŸ¥çœ‹ï¼‰"><a href="#ç®€åŒ–æ—¶é—´çº¿ï¼ˆå¿«é€ŸæŸ¥çœ‹ï¼‰" class="headerlink" title="ç®€åŒ–æ—¶é—´çº¿ï¼ˆå¿«é€ŸæŸ¥çœ‹ï¼‰"></a>ç®€åŒ–æ—¶é—´çº¿ï¼ˆå¿«é€ŸæŸ¥çœ‹ï¼‰</h2><table>
<thead>
<tr>
<th>ç‰ˆæœ¬</th>
<th>ç›®æ ‡è¦ç‚¹</th>
<th>å½“å‰çŠ¶æ€</th>
<th>ä¸‹ä¸€æ­¥ï¼ˆå…³é”®é˜»å¡ï¼‰</th>
</tr>
</thead>
<tbody><tr>
<td>v0.1</td>
<td>MVPï¼šrelay + debugfs + æœ€å°å·¥å…·</td>
<td>å·²å®Œæˆ âœ…</td>
<td>â€”</td>
</tr>
<tr>
<td>v0.2</td>
<td>å¤š ring &#x2F; engineï¼Œgseq&#x2F;cseqï¼ŒåŸºæœ¬ä¸¢å¼ƒ&#x2F;ç»Ÿè®¡</td>
<td>å·²å®Œæˆï¼ˆå®¡è®¡å‡€å¢ +1765ï¼‰ âœ…</td>
<td>æ€§èƒ½å›å½’éªŒè¯</td>
</tr>
<tr>
<td>v0.3</td>
<td>äº‹ä»¶æ¨¡å‹å†»ç»“ï¼ˆSTREAM_INFO&#x2F;METADATAï¼‰</td>
<td>å·²å®Œæˆ âœ…</td>
<td>â€”</td>
</tr>
<tr>
<td>v0.4</td>
<td>ç”¨æˆ·æ€å·¥å…·é“¾ï¼ˆgrtrace CLI&#x2F;æŠ¥å‘Šï¼‰</td>
<td>å·²å®Œæˆ âœ…</td>
<td>å¢å¼ºæŠ¥å‘Šæ ¼å¼</td>
</tr>
<tr>
<td>v0.5</td>
<td>æ€§èƒ½æ²»ç†ï¼ˆé‡‡æ ·&#x2F;é™é€Ÿ&#x2F;å›å‹ï¼‰</td>
<td>å·²å®Œæˆ âœ…</td>
<td>æ€§èƒ½åŸºå‡†å›å½’</td>
</tr>
<tr>
<td>v0.6</td>
<td>æŒä¹…åŒ–æ ¼å¼ä¸ METADATA</td>
<td>å·²å®Œæˆ âœ…</td>
<td>â€”</td>
</tr>
<tr>
<td>v0.7</td>
<td>ä¾›åº”å•†é€‚é…ï¼ˆi915&#x2F;amdgpu&#x2F;nouveau&#x2F;virtio-gpuï¼‰</td>
<td>éƒ¨åˆ†å®Œæˆ ğŸ”„</td>
<td>å®Œæˆ nouveau&#x2F;virtio-gpu &#x2F; å¢å¼ºé€‚é…æµ‹è¯•</td>
</tr>
<tr>
<td>v0.8</td>
<td>ç³»ç»Ÿè”åŠ¨ï¼ˆftrace&#x2F;perf&#x2F;eBPFï¼‰</td>
<td>éƒ¨åˆ†å®Œæˆ ğŸ”„</td>
<td>eBPF åœºæ™¯ã€åˆå¹¶è„šæœ¬</td>
</tr>
<tr>
<td>v0.9</td>
<td>ç¨³å®šåŒ–ï¼ˆkselftest &#x2F; CIï¼‰</td>
<td>å·²å®Œæˆ âœ…</td>
<td>æŒç»­ç»´æŠ¤</td>
</tr>
<tr>
<td>v1.0</td>
<td>åŸºçº¿å‘å¸ƒï¼ˆæ ¼å¼&#x2F;æ¥å£ç¨³å®šï¼‰</td>
<td>æœªå®Œæˆ âŒ</td>
<td>å‘å¸ƒéªŒè¯æµç¨‹ã€æ–‡æ¡£å®Œå–„</td>
</tr>
</tbody></table>
<p>ç®€çŸ­ç»“è®ºï¼šå¯¹å¤§å¤šæ•°è¯»è€…å’Œè¯„å®¡è€…ï¼Œå…ˆçœ‹æœ¬â€œæ‘˜è¦ + ç®€åŒ–æ—¶é—´çº¿â€ä»¥æŠŠæ¡é¡¹ç›®ç°çŠ¶ï¼›å¯¹å¼€å‘è€…å’Œè¯„å®¡è€…ï¼Œè¯¦ç»†çš„ç‰ˆæœ¬æ‹†è§£ä»ç„¶ä¿ç•™åœ¨ä¸‹æ–‡ï¼ˆä½œä¸ºé™„å½•ï¼‰ã€‚</p>
<hr>
<p>è¯­ä¹‰åŒ–ç‰ˆæœ¬çº¦å®šï¼š</p>
<ul>
<li>v0.x ä¸ºå¿«é€Ÿè¿­ä»£æœŸï¼ˆå¯èƒ½å‘ç”Ÿä¸å…¼å®¹å˜æ›´ï¼‰</li>
<li>v1.0 èµ·æ‰¿è¯ºåŸºæœ¬äº‹ä»¶è¯­ä¹‰ä¸æ–‡ä»¶æ ¼å¼çš„ç¨³å®šæ€§</li>
</ul>
<h2 id="é‡Œç¨‹ç¢‘æ€»è§ˆ"><a href="#é‡Œç¨‹ç¢‘æ€»è§ˆ" class="headerlink" title="é‡Œç¨‹ç¢‘æ€»è§ˆ"></a>é‡Œç¨‹ç¢‘æ€»è§ˆ</h2><ul>
<li>v0.1 MVPï¼šå†…æ ¸æœ€å°å¯ç”¨è·¯å¾„ï¼ˆrelay é€šé“ + åŸºç¡€äº‹ä»¶ + å•ä¾›åº”å•†å• ringï¼‰</li>
<li>v0.2 å¤š ring&#x2F;å¼•æ“æ”¯æŒï¼‹å•æœºæ—¶é’Ÿä¸€è‡´æ€§ï¼ˆktimeã€seqï¼‰</li>
<li>v0.3 äº‹ä»¶æ¨¡å‹ç¨³å®šåŒ–ï¼ˆæäº¤&#x2F;å®Œæˆ&#x2F;ctx åˆ‡æ¢&#x2F;fence ç­‰ï¼‰</li>
<li>v0.4 ç”¨æˆ·æ€å·¥å…·é“¾ï¼ˆgrtraceã€æœ€å°åˆ†æè„šæœ¬ï¼‰<br>ï¼ˆå«é˜»å¡ç‚¹æŠ¥å‘Šï¼šper-job æŒ‡æ ‡ä¸æ ‡ç­¾ï¼‰</li>
<li>v0.5 æ€§èƒ½ä¸å¼€é”€æ²»ç†ï¼ˆèƒŒå‹ã€é‡‡æ ·ã€å¼€å…³ç­–ç•¥ã€çƒ­è·¯å¾„å®¡è®¡ï¼‰</li>
<li>v0.6 å›ºåŒ–æŒä¹…åŒ–æ–‡ä»¶æ ¼å¼ï¼ˆformat_version&#x3D;1ï¼Œç´§å‡‘äºŒè¿›åˆ¶ + METADATAï¼‰</li>
<li>v0.7 ä¾›åº”å•†é€‚é…ï¼ˆamdgpuã€i915ã€nouveauã€virtio-gpu é¦–æ‰¹è¦†ç›–ï¼‰</li>
<li>v0.8 ä¸ ftrace&#x2F;perf&#x2F;eBPF è”åŠ¨ï¼ˆæ—¶é—´è½´å¯¹é½ã€è·¨åŸŸå…³è”ï¼‰</li>
<li>v0.9 ç¨³å®šåŒ–ï¼ˆkselftestã€è‡ªæµ‹åŸºå‡†ã€æ–‡æ¡£ä¸ç¤ºä¾‹ï¼‰</li>
<li>v1.0 åŸºçº¿å‘å¸ƒï¼ˆæ¥å£&#x2F;æ ¼å¼ç¨³å®šã€å…¼å®¹æ€§æ‰¿è¯ºï¼‰</li>
</ul>
<hr>
<h2 id="v0-1-MVPï¼ˆæœ€å°å¯ç”¨ï¼‰âœ…-å·²å®Œæˆ"><a href="#v0-1-MVPï¼ˆæœ€å°å¯ç”¨ï¼‰âœ…-å·²å®Œæˆ" class="headerlink" title="v0.1 MVPï¼ˆæœ€å°å¯ç”¨ï¼‰âœ… å·²å®Œæˆ"></a>v0.1 MVPï¼ˆæœ€å°å¯ç”¨ï¼‰âœ… <strong>å·²å®Œæˆ</strong></h2><p>ç›®æ ‡ï¼šè·‘é€šä»é©±åŠ¨ hook â†’ å†…æ ¸ relay â†’ debugfs æ¶ˆè´¹ â†’ ç®€å•ç”¨æˆ·æ€è¯»å–çš„é—­ç¯ã€‚</p>
<ul>
<li>å†…æ ¸<ul>
<li><input checked disabled type="checkbox"> åŸºç¡€äº‹ä»¶ç±»å‹ï¼šæäº¤ submitã€å®Œæˆ completeï¼ˆfence signalï¼‰ã€ä¸Šä¸‹æ–‡åˆ‡æ¢ ctx_switch (æäº¤ 5d3e65b4)</li>
<li><input checked disabled type="checkbox"> relay é€šé“ä¸ per-CPU åºåˆ—å·ï¼ˆæœ€ç®€å®ç°å¯å…ˆå•é€šé“ï¼‰ (æäº¤ 5d3e65b4, 091ef9f8)</li>
<li><input checked disabled type="checkbox"> debugfs æ§åˆ¶ä¸æ•°æ®å‡ºå£ï¼š&#x2F;sys&#x2F;kernel&#x2F;debug&#x2F;grtrace&#x2F; (æäº¤ 5d3e65b4)</li>
<li><input checked disabled type="checkbox"> å•ä¾›åº”å•†å• ring æ‰“é€šï¼ˆæ¨è i915 æˆ– amdgpu äºŒé€‰ä¸€ï¼‰ (æäº¤ 83b63505, a452c062)</li>
</ul>
</li>
<li>ç”¨æˆ·æ€<ul>
<li><input checked disabled type="checkbox"> åŸå‹è¯»å‡ºå·¥å…·ï¼ˆæœ€ç®€ï¼šcat&#x2F;ç”¨æˆ·æ€ reader ç¤ºä¾‹ï¼‰ (æäº¤ 91c89d26)</li>
<li><input checked disabled type="checkbox"> æœ€å°è§£æè„šæœ¬ï¼ˆäº‹ä»¶åºåˆ— + æ—¶é—´æˆ³ï¼‰ (æäº¤ fcda982a)</li>
</ul>
</li>
<li>æ–‡æ¡£&#x2F;CI<ul>
<li><input checked disabled type="checkbox"> å¯åŠ¨&#x2F;åœæ­¢&#x2F;è¯»å–ä½¿ç”¨è¯´æ˜ï¼ˆREADME ç‰‡æ®µï¼‰ (æäº¤ c92d1d53)</li>
<li><input checked disabled type="checkbox"> ç®€å• smoke testï¼ˆæ’å…¥ N æ¬¡æäº¤ï¼Œè§‚å¯Ÿ N æ¬¡å®Œæˆï¼‰ (æäº¤ 7c6af0e0)</li>
</ul>
</li>
<li>éªŒæ”¶<ul>
<li><input checked disabled type="checkbox"> Demo å±•ç¤ºå• ring çš„æäº¤â†’å®Œæˆé—­ç¯ï¼Œæ•°æ®å¯è¯»å¯è§† (æäº¤ 7c6af0e0)</li>
</ul>
</li>
</ul>
<p> ä»£ç å¼€å‘é‡é¢„ä¼°ï¼š900 è¡Œ<br> <strong>å®é™…å®ç°ï¼ˆå®¡è®¡è¯æ®ï¼‰</strong>:<br>ä»£è¡¨æ€§æäº¤ï¼š</p>
<ul>
<li><p>4592fa4b â€” add stream header, extend event set, and ordering&#x2F;stats</p>
<ul>
<li>numstat: drivers&#x2F;gpu&#x2F;grtrace&#x2F;grtrace.c +177 -24;<br>include&#x2F;linux&#x2F;grtrace.h +14 -0</li>
<li>æäº¤å‡€æ–°å¢è¡Œï¼ˆç¤ºä¾‹ï¼‰ï¼š+191ï¼ˆå«æ ¸å¿ƒäº‹ä»¶æšä¸¾ä¸å®ç°æ”¹åŠ¨ï¼‰</li>
</ul>
</li>
<li><p>fcda982a â€” METADATA å’Œ userspace parserï¼ˆtools&#x2F;grtraceï¼‰</p>
<ul>
<li>numstat: drivers&#x2F;gpu&#x2F;grtrace&#x2F;grtrace.c +52 -0;<br>tools&#x2F;grtrace&#x2F;grtrace.c +224 -74; tools README +7 -1</li>
</ul>
</li>
</ul>
<p> ç»“è®ºï¼šv0.3 çš„äº‹ä»¶æ¨¡å‹ä¸»è¦ç”± 4592fa4b å®Œæˆã€‚<br> fcda982a è¡¥å……äº†æ ¼å¼ä¸ç”¨æˆ·æ€è§£æå·¥å…·ã€‚<br> åˆè®¡æ¥çœ‹ï¼Œå†…æ ¸ä¸å·¥å…·ç«¯éƒ½æœ‰å®è´¨æ€§æ–°å¢ï¼Œè¯¦è§å„æäº¤çš„ numstatã€‚</p>
<p>å®¡è®¡å‡€å¢è¡Œæ•°ï¼ˆæœ¬é‡Œç¨‹ç¢‘ï¼‰ï¼šdrivers&#x2F;gpu&#x2F;grtrace ç›¸å…³å˜æ›´åœ¨æäº¤èŒƒå›´å†…<br>å‡€å¢çº¦ +356 è¡Œï¼ˆå†…æ ¸ + ç”¨æˆ·æ€ åˆè®¡ï¼Œæ¥æºï¼šgit numstat æ±‡æ€»ï¼‰</p>
<p>æäº¤å‡€å¢è¡Œæ•°ï¼š+246</p>
<p>è¾…åŠ©æäº¤ï¼š</p>
<ul>
<li>7c6af0e0 â€” æ·»åŠ  smoke test ä¸è‡ªæµ‹ï¼ˆtools&#x2F;testing&#x2F;selftests&#x2F;grtraceï¼‰</li>
<li>fcda982a â€” æ·»åŠ  userspace parser &#x2F; METADATAï¼ˆtools&#x2F;grtraceï¼‰ (+224 lines in parser)</li>
<li>91c89d26 â€” åˆå§‹ CLI&#x2F;å·¥å…· (tools&#x2F;grtrace) (å¤§å¹…å·¥å…·å®ç°)</li>
</ul>
<p>ç»“è®ºï¼šv0.1 çš„åŠŸèƒ½åœ¨ 5d3e65b4 ä¸ºæ ¸å¿ƒçš„å®ç°ä¸Šå·²å®Œæˆã€‚<br>åç»­çš„å·¥å…·ä¸è‡ªæµ‹æäº¤è¡¥è¶³äº†ä½¿ç”¨ä¸éªŒè¯ç¯èŠ‚ã€‚<br>æŒ‰æäº¤è¯æ®è®¡ï¼Œæ ¸å¿ƒå†…æ ¸éƒ¨åˆ†å‡€å¢çº¦ +246 è¡Œï¼›ç”¨æˆ·æ€ä¸å·¥å…·çš„æ–°å¢è¡Œæ•°<br>å•ç‹¬è®¡å…¥ï¼ˆå‚è§ v0.4ã€v0.6 æ±‡æ€»ï¼‰ã€‚</p>
<h3 id="v0-1-è¯¦ç»†æ‹†è§£"><a href="#v0-1-è¯¦ç»†æ‹†è§£" class="headerlink" title="v0.1 è¯¦ç»†æ‹†è§£"></a>v0.1 è¯¦ç»†æ‹†è§£</h3><ul>
<li><p>å†…æ ¸ï¼ˆdrivers&#x2F;gpu&#x2F;grtrace&#x2F;grtrace.cï¼‰</p>
<ul>
<li>åŸºç¡€éª¨æ¶ï¼šæ¨¡å—æ³¨å†Œ&#x2F;å¸è½½ã€debugfs æ ¹ç›®å½•ã€relay é€šé“åˆ›å»º&#x2F;å…³é—­<ul>
<li>å‡½æ•°ï¼šgrtrace_create_channelã€grtrace_emitã€grtrace_init&#x2F;grtrace_exit</li>
<li>DoDï¼šM&#x3D;drivers&#x2F;gpu&#x2F;grtrace å¯ç¼–è¯‘ï¼›&#x2F;sys&#x2F;kernel&#x2F;debug&#x2F;grtrace å­˜åœ¨</li>
</ul>
</li>
<li>äº‹ä»¶ä¸å…¬å…± APIï¼ˆæœ€å°é›†ï¼šSUBMIT&#x2F;COMPLETE&#x2F;CTX_SWITCHï¼‰<ul>
<li>ç»“æ„ï¼šgrtrace_event_hdrã€å„ payload ç»“æ„</li>
<li>å‡½æ•°ï¼šgrtrace_submit&#x2F;complete&#x2F;ctx_switchï¼ˆå¯¼å‡ºç¬¦å·ï¼‰ã€grtrace_write_eventï¼ˆæœ€ç®€å†™å…¥ï¼‰</li>
<li>DoDï¼šemit ä¸‰ç±»äº‹ä»¶åï¼Œrelay æœ‰æ•°æ®å¯è¯»</li>
</ul>
</li>
<li>æ§åˆ¶ä¸ç»Ÿè®¡è§†å›¾ï¼ˆæœ€å°ï¼‰<ul>
<li>debugfsï¼šcontrolï¼ˆstart&#x2F;stopï¼‰ã€statsï¼ˆæ–‡æœ¬ï¼‰ã€emitï¼ˆæµ‹è¯•æ³¨å…¥ï¼‰</li>
<li>DoDï¼šstartâ†’emitÃ—3â†’stop åï¼Œstats æ˜¾ç¤º written&#x3D;3</li>
</ul>
</li>
<li>ä¼°è®¡ LOCï¼šå†…æ ¸ä¾§ ~600â€“700 è¡Œï¼ˆå«ç»“æ„&#x2F;è§†å›¾&#x2F;æ§åˆ¶ï¼‰</li>
</ul>
</li>
<li><p>ç”¨æˆ·æ€ï¼ˆtools&#x2F;grtrace&#x2F;ï¼‰</p>
<ul>
<li>æœ€å°æ§åˆ¶ï¼šstart&#x2F;stop&#x2F;statusï¼›æœ€å° readerï¼šé¡ºåºè¯»å‡ºã€æ‰“å°è®¡æ•°</li>
<li>DoDï¼šä¸€æ¡å‘½ä»¤å¯å¯åŠ¨é‡‡é›†ï¼Œå¦ä¸€æ¡å¯è¯»å‡ºå¹¶ç»Ÿè®¡äº‹ä»¶æ•°</li>
<li>ä¼°è®¡ LOCï¼š~100â€“150 è¡Œ</li>
</ul>
</li>
<li><p>å†’çƒŸç”¨ä¾‹ï¼ˆäººå·¥æ­¥éª¤ï¼‰</p>
<ol>
<li>åŠ è½½æ¨¡å—</li>
<li>echo start &gt; &#x2F;sys&#x2F;kernel&#x2F;debug&#x2F;grtrace&#x2F;control</li>
<li>cat &#x2F;sys&#x2F;kernel&#x2F;debug&#x2F;grtrace&#x2F;stats å¹¶çœ‹åˆ° written&#x3D;3</li>
</ol>
<ul>
<li><p>ä¸€å‘¨ä¸€è¿­ä»£ï¼›å›¢é˜Ÿ 2â€“3 äººï¼ˆå†…æ ¸&#x2F;é©±åŠ¨&#x2F;ç”¨æˆ·æ€ï¼‰ï¼Œ70â€“80% æŠ•å…¥</p>
</li>
<li><p>11 ä¸ªè¿­ä»£ â‰ˆ 11 å‘¨ â‰ˆ 2.5 ä¸ªæœˆï¼›å« 20% ç¼“å†² â‰ˆ 3 ä¸ªæœˆ</p>
</li>
<li><p>v0.1ï¼š2 è¿­ä»£ï¼ˆ2 å‘¨ï¼‰</p>
</li>
<li><p>v0.2â€“0.3ï¼š2 è¿­ä»£ï¼ˆ2 å‘¨ï¼‰</p>
</li>
<li><p>v0.4â€“0.5ï¼š2 è¿­ä»£ï¼ˆ2 å‘¨ï¼‰</p>
</li>
<li><p>v0.6ï¼š1 è¿­ä»£ï¼ˆ1 å‘¨ï¼‰</p>
</li>
<li><p>v0.7â€“0.8ï¼š2 è¿­ä»£ï¼ˆ2 å‘¨ï¼‰</p>
</li>
<li><p>v0.9ï¼š1 è¿­ä»£ï¼ˆ1 å‘¨ï¼‰</p>
</li>
<li><p>v1.0ï¼š1 è¿­ä»£ï¼ˆ1 å‘¨ï¼‰</p>
</li>
<li><p>æ–‡æ¡£ï¼šconfig&#x2F;è§†å›¾è¯´æ˜ä¸ç¤ºä¾‹å‘½ä»¤å·²è¡¥å……</p>
</li>
<li><p>1 å‘¨ä¸€è¿­ä»£ï¼šâ‰ˆ 11 å‘¨ï¼›å« 20% ç¼“å†² â‰ˆ 3 ä¸ªæœˆ</p>
</li>
<li><p>3 å‘¨ä¸€è¿­ä»£ï¼šâ‰ˆ 33 å‘¨ï¼›å« 20% ç¼“å†² â‰ˆ 7.5â€“8 ä¸ªæœˆ</p>
</li>
<li><p>åº¦é‡ï¼šgit numstat å±•ç¤ºæ–°å¢&#x2F;åˆ é™¤&#x2F;å‡€å¢ï¼›æœ¬å‘¨ç´¯è®¡â‰¥800 è¡Œ</p>
</li>
<li><p>ä¾›åº”å•†é€‚é…ã€æ€§èƒ½å¼€é”€æ²»ç†ã€ç³»ç»Ÿè”åŠ¨ä¸ç¡®å®šæ€§è¾ƒé«˜ï¼›å»ºè®®é¢„ç•™ 2â€“3 ä¸ªè¿­ä»£ é£é™©ç¼“å†²ï¼Œå¹¶ä» è¿­ä»£ 4 èµ·å¹¶è¡Œæ¨è¿›é€‚é…ä»¥é™ä½å°¾éƒ¨é£é™©</p>
</li>
</ul>
</li>
</ul>
<hr>
<h2 id="v0-2-å¤š-ring-å¼•æ“-æ—¶é’Ÿä¸€è‡´æ€§"><a href="#v0-2-å¤š-ring-å¼•æ“-æ—¶é’Ÿä¸€è‡´æ€§" class="headerlink" title="v0.2 å¤š ring&#x2F;å¼•æ“ + æ—¶é’Ÿä¸€è‡´æ€§"></a>v0.2 å¤š ring&#x2F;å¼•æ“ + æ—¶é’Ÿä¸€è‡´æ€§</h2><ul>
<li><p>å†…æ ¸</p>
<ul>
<li><input checked disabled type="checkbox"> å¤š ring&#x2F;å¼•æ“ï¼ˆgraphics&#x2F;compute&#x2F;copyï¼‰è¯†åˆ«ä¸æ ‡æ³¨ (æäº¤ 091ef9f8)</li>
<li><input checked disabled type="checkbox"> å…¨å±€å•è°ƒæ—¶é—´æˆ³ä¸è·¨ CPU ä¸€è‡´æ€§ï¼ˆktime_get_* + per-CPU seq æ–¹æ¡ˆï¼‰ (æäº¤ 091ef9f8)</li>
<li><input checked disabled type="checkbox"> äº‹ä»¶ä¸¢å¼ƒä¸æ°´ä½ï¼ˆä¸¢åŒ…è®¡æ•°ã€èƒŒå‹ç­–ç•¥é›å½¢ï¼‰ (æäº¤ cf44f42c)</li>
</ul>
</li>
<li><p>ç”¨æˆ·æ€</p>
<ul>
<li><input checked disabled type="checkbox"> ring&#x2F;engine ç»´åº¦çš„è§†å›¾ä¸è¿‡æ»¤ (æäº¤ ca828b8f)</li>
</ul>
</li>
<li><p>éªŒæ”¶</p>
<ul>
<li><input checked disabled type="checkbox"> åŒä¸€ GPU å¤š ring åŒæ—¶è¿½è¸ªï¼Œæ—¶é—´é¡ºåºä¸€è‡´ (æäº¤ 091ef9f8)</li>
</ul>
</li>
<li><p>ä»£ç å¼€å‘é‡é¢„ä¼°ï¼š700 è¡Œ</p>
</li>
<li><p><strong>å®é™…å®ç°ï¼ˆå®¡è®¡è¯æ®ï¼‰</strong>:</p>
<ul>
<li>ä»£è¡¨æ€§æäº¤ä¸å˜æ›´ï¼ˆèŠ‚é€‰ï¼‰ï¼š</li>
<li>091ef9f8 â€” add global&#x2F;per-CPU sequence, engine class, and debugfs stats<ul>
<li>è¯¥æäº¤åœ¨å†å²æäº¤ä¸­æ ‡è®°ä¸ºå®ç°å¤š ring&#x2F;engine ä¸åºåˆ—å·ç‰¹æ€§ï¼ˆè§ logï¼‰</li>
</ul>
</li>
<li>cf44f42c â€” per-second rolling stats, sec_stats debugfs, and drop counters<ul>
<li>drivers&#x2F;gpu&#x2F;grtrace&#x2F;grtrace.c åœ¨è¯¥æäº¤ä¸­å¢åŠ äº†æ˜¾è‘—çš„ç»Ÿè®¡&#x2F;ä¸¢å¼ƒé€»è¾‘æ”¹åŠ¨</li>
</ul>
</li>
<li>ca828b8f â€” type-mask filtering, CSV debugfs views<ul>
<li>ç›¸å…³å·¥å…·&#x2F;è§†å›¾æœ‰å¯¹åº”çš„æ”¹åŠ¨</li>
</ul>
</li>
<li>æ–‡ä»¶çº§æ€»ä½“ï¼šdrivers&#x2F;gpu&#x2F;grtrace&#x2F;grtrace.c åœ¨ 091ef9f8 åŠåç»­æäº¤ä¸­<br>å¤šæ¬¡è¢«ä¿®æ”¹ï¼ˆç´¯è®¡æ˜¾è‘—æ–°å¢ï¼‰ã€‚</li>
<li>å¹¶å¢åŠ äº† per-CPU&#x2F;gseq&#x2F;cseq å­—æ®µä¸ stats è§†å›¾ã€‚</li>
<li>ç»“è®ºï¼šv0.2 çš„åŠŸèƒ½ç‚¹åœ¨å¤šä¸ªæäº¤é‡Œé€æ­¥è½åœ°ï¼Œæ ¸å¿ƒåœ¨ grtrace.c ä¸­çš„æ”¹åŠ¨<br>å¯åœ¨æäº¤å†å²ä¸­æ‰¾åˆ°æ˜ç¡®è¯æ®ã€‚</li>
<li>æŒ‰æäº¤å†å²ï¼Œè¯¥é‡Œç¨‹ç¢‘å¯åˆ¤å®šä¸ºâ€œå·²å®Œæˆ&#x2F;å·²éƒ¨ç½²â€çŠ¶æ€ã€‚</li>
<li>å®é™…å®ç°ï¼ˆå®¡è®¡å‡€å¢è¡Œæ•°ï¼‰ï¼šdrivers&#x2F;gpu&#x2F;grtrace ç›®å½•åœ¨æäº¤èŒƒå›´<br>5d3e65b4^..8896f28 ä¸­å‡€å¢ +1765 è¡Œã€‚</li>
<li>ï¼ˆå« grtrace.cã€grtrace_drm_bridge.cã€Kconfigã€Makefile ç­‰ï¼‰</li>
</ul>
</li>
</ul>
<h3 id="v0-2-è¯¦ç»†æ‹†è§£"><a href="#v0-2-è¯¦ç»†æ‹†è§£" class="headerlink" title="v0.2 è¯¦ç»†æ‹†è§£"></a>v0.2 è¯¦ç»†æ‹†è§£</h3><ul>
<li><p>ç›®æ ‡ï¼ˆç²¾ç¡®ï¼‰</p>
<ul>
<li>æ”¯æŒåŒä¸€ GPU ä¸Šå¤š ring &#x2F; å¤š engine çš„äº‹ä»¶é‡‡é›†ä¸æ ‡æ³¨<br>ï¼ˆä¾‹å¦‚ graphics&#x2F;compute&#x2F;copy ç­‰ï¼‰</li>
<li>æä¾›å…¨å±€å•è°ƒåºåˆ—å· gseq ä¸ per-CPU cseqï¼Œä¾¿äºåœ¨ç”¨æˆ·æ€æŒ‰ gseq åš<br>è·¨ CPU çš„ä¸²è”æ’åºä¸é‡å»ºå…¨å±€åºåˆ—</li>
<li>å®ç°åŸºç¡€çš„ä¸¢å¼ƒ&#x2F;èƒŒå‹è®¡æ•°ä¸çŸ­å†™æ£€æµ‹ï¼ˆwrites_short &#x2F; bytes_droppedï¼‰ï¼Œ<br>å¹¶åœ¨ debugfs ä¸Šæš´éœ² sec_stats ä»¥ä¾¿è§‚æµ‹</li>
<li>åœ¨ debugfs&#x2F;config ä¸­æä¾›æŒ‰ engine &#x2F; ring &#x2F; type çš„è¿‡æ»¤èƒ½åŠ›ï¼Œ<br>å¹¶æš´éœ²æœ€å°çš„ç»Ÿè®¡è§†å›¾ï¼ˆevents_by_typeã€writes_*ã€drop countersï¼‰</li>
</ul>
</li>
<li><p>å…³é”®æ–‡ä»¶&#x2F;å‡½æ•°æ¸…å•ï¼ˆå†…æ ¸ï¼‰</p>
<ul>
<li>drivers&#x2F;gpu&#x2F;grtrace&#x2F;grtrace.c<ul>
<li>grtrace_init &#x2F; grtrace_exitï¼šæ¨¡å— init&#x2F;exit</li>
<li>grtrace_create_channel &#x2F; grtrace_destroy_channelï¼šrelay &#x2F; channel ç®¡ç†</li>
<li>grtrace_write_eventï¼šäº‹ä»¶è·¯å¾„<ul>
<li>è¿‡æ»¤ â†’ é‡‡æ · â†’ é™é€Ÿ â†’ å†™å…¥ â†’ è®¡æ—¶&#x2F;ç»Ÿè®¡</li>
</ul>
</li>
<li>grtrace_should_drop_by_filterï¼šfilter_engine_mask&#x2F;filter_ring_id&#x2F;filter_type_mask å…¥å£</li>
<li>gseq&#x2F;cseq ç®¡ç†ä»£ç ï¼šgseq_alloc(), per-CPU cseq æ›´æ–°ç‚¹</li>
<li>sec_stats å·¥ä½œå‡½æ•°ï¼šgrtrace_stats_workfn</li>
</ul>
</li>
<li>drivers&#x2F;gpu&#x2F;grtrace&#x2F;grtrace_drm_bridge.c<ul>
<li>DRM bridge glueï¼šå°† DRM ä¾§äº‹ä»¶æ˜ å°„åˆ° grtrace äº‹ä»¶å¹¶å†™å…¥ channel</li>
</ul>
</li>
<li>include&#x2F;linux&#x2F;grtrace.h<ul>
<li>äº‹ä»¶å¤´&#x2F;payload å®šä¹‰ï¼ˆhdr.size, gseq, cseq, engine_class, ring_idï¼‰</li>
</ul>
</li>
</ul>
</li>
<li><p>ç”¨æˆ·æ€&#x2F;å·¥å…·</p>
<ul>
<li>tools&#x2F;grtrace&#x2F;grtrace.c<ul>
<li>è§£æå™¨æ”¯æŒæŒ‰ gseq åˆå¹¶æ’åºã€æŒ‰ ring&#x2F;engine è¿‡æ»¤</li>
<li>CSV&#x2F;èšåˆè§†å›¾ï¼šâ€“per-ringã€â€“per-engine æ”¯æŒ</li>
</ul>
</li>
</ul>
</li>
<li><p>DoDï¼ˆDefinition of Doneï¼Œå…·ä½“å¯éªŒæ¡ä»¶ï¼‰</p>
<ul>
<li>ä»£ç ï¼šbuild through (M&#x3D;drivers&#x2F;gpu&#x2F;grtrace)ï¼Œæ— æ˜æ˜¾çš„ KASAN&#x2F;ç¼–è¯‘è­¦å‘Š<br>åœ¨æ ¸å¿ƒè·¯å¾„ä¸­ã€‚</li>
<li>æ¥å£ï¼šdebugfs ä¸‹è‡³å°‘å­˜åœ¨ control&#x2F;start&#x2F;stopã€configï¼ˆæ”¯æŒ<br>filter_engine_mask&#x2F;filter_ring_id&#x2F;filter_type_maskï¼‰ä»¥åŠ statsï¼ˆåŒ…å«<br>events_by_typeã€writes_ok&#x2F;writes_shortã€rate_limited_dropsã€<br>backpressure_dropsï¼‰ã€‚</li>
<li>è¡Œä¸ºï¼šåœ¨åŒä¸€ GPU ä¸ŠåŒæ—¶å‘ä¸¤ä¸ª ring emit äº‹ä»¶ï¼Œç”¨æˆ·æ€æŒ‰ gseq åˆå¹¶å<br>å…¨å±€æœ‰åºï¼ˆgseq å•è°ƒé€’å¢ï¼‰ï¼Œå¹¶ä¸” per-ring èšåˆè®¡æ•°ä¸€è‡´ã€‚</li>
<li>ç›‘æ§ï¼šsec_stats èƒ½åœ¨é«˜è´Ÿè½½ä¸‹ç»™å‡º writes_short ä¸ drop counters çš„åº¦é‡</li>
<li>æ–‡æ¡£ï¼šREADME æˆ– docs ä¸­ç»™å‡º ring&#x2F;engine è¿‡æ»¤ç¤ºä¾‹ä¸å†’çƒŸè„šæœ¬</li>
</ul>
</li>
</ul>
<h4 id="å†’çƒŸæµ‹è¯•æ­¥éª¤ï¼ˆå¯å¤åˆ¶ï¼‰"><a href="#å†’çƒŸæµ‹è¯•æ­¥éª¤ï¼ˆå¯å¤åˆ¶ï¼‰" class="headerlink" title="å†’çƒŸæµ‹è¯•æ­¥éª¤ï¼ˆå¯å¤åˆ¶ï¼‰"></a>å†’çƒŸæµ‹è¯•æ­¥éª¤ï¼ˆå¯å¤åˆ¶ï¼‰</h4><p>å¯å¤åˆ¶å‘½ä»¤ï¼ˆæŒ‰é¡ºåºæ‰§è¡Œï¼‰ï¼š</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs text">1) modprobe/insmod grtrace.ko<br>2) echo start &gt; /sys/kernel/debug/grtrace/control<br>3) echo &quot;filter_ring_id=1&quot; &gt; /sys/kernel/debug/grtrace/config<br>4) echo &quot;emit submit 100 0 1 1&quot; &gt; /sys/kernel/debug/grtrace/emit<br>5) echo &quot;emit submit 100 0 2 1&quot; &gt; /sys/kernel/debug/grtrace/emit<br>6) tools/grtrace/grtrace --per-ring | tee out.txt<br>7) echo stop &gt; /sys/kernel/debug/grtrace/control<br></code></pre></td></tr></table></figure>

<ul>
<li><p>å®ç°è¯æ®ï¼ˆnumstat æ‘˜è¦ä¸å¼•ç”¨å‘½ä»¤ï¼‰</p>
<ul>
<li><p>è¿è¡Œå‘½ä»¤ï¼ˆç¤ºä¾‹ï¼Œç”¨äºå¤ç°ç»Ÿè®¡èŒƒå›´ï¼‰ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git diff --numstat 5d3e65b4^..8896f28 -- drivers/gpu/grtrace<br></code></pre></td></tr></table></figure>
</li>
<li><p>å…¸å‹è¾“å‡ºï¼ˆèŠ‚é€‰ï¼‰æ˜¾ç¤ºæœ¬èŒƒå›´å†…çš„å˜æ›´ï¼š</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs text">drivers/gpu/grtrace/grtrace.c                 +1567 -0<br>drivers/gpu/grtrace/grtrace_drm_bridge.c      +175  -0<br>drivers/gpu/grtrace/Kconfig                   +15   -0<br>drivers/gpu/grtrace/Makefile                  +8    -0<br></code></pre></td></tr></table></figure>
</li>
<li><p>åˆè®¡å‡€å¢ï¼š+1765 è¡Œï¼ˆåŒä¸Šâ€œå®é™…å®ç°ï¼ˆå®¡è®¡å‡€å¢è¡Œæ•°ï¼‰â€ï¼‰</p>
</li>
</ul>
</li>
<li><p>é£é™©ä¸å›é€€</p>
<ul>
<li>gseq åˆå¹¶å‡å®šå†™å…¥è·¯å¾„èƒ½ä¸ºæ‰€æœ‰äº‹ä»¶åˆ†é…å”¯ä¸€å•è°ƒ gseqã€‚<br>è‹¥å‡ºç°ç«æ€æˆ–å†™å…¥å¤±è´¥ï¼Œéœ€è¦å›é€€ç­–ç•¥ã€‚<br>ä¾‹å¦‚å¯ä»¥é‡‡ç”¨æ—¶é—´æˆ³ä¸å±€éƒ¨ cseq ä½œä¸ºå…œåº•æ–¹æ¡ˆã€‚</li>
<li>å¤§è´Ÿè½½ä¸‹å¯èƒ½äº§ç”ŸçŸ­å†™æˆ– reserve fail é—®é¢˜ã€‚<br>å»ºè®®æä¾›ä»¤ç‰Œæ¡¶æˆ–çª—å£æ¨¡å¼çš„é™é€Ÿï¼Œå¹¶åœ¨ debugfs ä¸­æš´éœ²é˜ˆå€¼ä»¥ä¾¿å›é€€ä¸è§‚æµ‹ã€‚</li>
</ul>
</li>
<li><p>ä»£ç é‡ä¸å·¥ä½œé‡</p>
<ul>
<li><p>å®¡è®¡å‡€å¢ï¼ˆæœ¬é‡Œç¨‹ç¢‘å†…ï¼‰ï¼š+1765 è¡Œï¼ˆè§ä¸Šï¼‰</p>
</li>
<li><p>ä¸åŸå§‹é¢„ä¼° 700 è¡Œç›¸æ¯”ï¼Œå®é™…å®ç°æ›´å€¾å‘äºå°†å·¥å…·ä¸é©±åŠ¨ glue è®¡å…¥ï¼Œä½¿å¾—æ•´ä½“é‡çº§è¾¾åˆ°çº¦ 2.5 å€</p>
</li>
<li><p>å®é™…å®ç°ï¼ˆå®¡è®¡å‡€å¢è¡Œæ•°ï¼‰ï¼šdrivers&#x2F;gpu&#x2F;grtrace ç›®å½•åœ¨æäº¤èŒƒå›´ 5d3e65b4^..8896f28 ä¸­å‡€å¢ +1765 è¡Œï¼ˆå« grtrace.cã€grtrace_drm_bridge.cã€Kconfigã€Makefile ç­‰ï¼‰</p>
</li>
</ul>
</li>
<li><p>å†…æ ¸ï¼ˆgrtrace.cï¼‰</p>
<ul>
<li>å¤šå¼•æ“æ ‡æ³¨ï¼šengine_class&#x2F;ring_id è´¯ç©¿ payload ä¸è¿‡æ»¤</li>
<li>å…¨å±€æ—¶é—´&#x2F;åºåˆ—ï¼šktime_get_ns + gseq&#x2F;cseqï¼ˆå·²å…·å¤‡åŸºç¡€ï¼Œå®Œå–„ wrap&#x2F;race å¤„ç†ï¼‰</li>
<li>ä¸¢å¼ƒ&#x2F;æ°´ä½ï¼šæœ€å°ä¸¢åŒ…è®¡æ•°ä¸çŸ­å†™è®¡æ•°ï¼ˆwrites_short&#x2F;bytes_droppedï¼‰</li>
<li>DoDï¼šåŒä¸€ GPU å¤š ring äº‹ä»¶å¯æŒ‰ gseq æœ‰åºï¼›stats èƒ½æ˜¾ç¤ºä¸¢å¼ƒè®¡æ•°</li>
<li>é¢„ä¼° LOCï¼š~350â€“400</li>
</ul>
</li>
<li><p>ç”¨æˆ·æ€ï¼ˆtools&#x2F;grtraceï¼‰</p>
<ul>
<li>ring&#x2F;engine è¿‡æ»¤ä¸ç®€å•èšåˆè¾“å‡º</li>
<li>DoDï¼šå‘½ä»¤è¡Œå¯æŒ‡å®š ring&#x2F;engine å¹¶ç»Ÿè®¡è¡Œæ•°</li>
<li>é¢„ä¼° LOCï¼š~200â€“250</li>
</ul>
</li>
<li><p>å†’çƒŸï¼šåŒ ring åŒæ—¶ emitï¼Œç”¨æˆ·æ€æŒ‰ ring èšåˆè®¡æ•°</p>
</li>
</ul>
<p>ã€v0.2 DoD æ£€æŸ¥è¡¨ã€‘</p>
<ul>
<li>ä»£ç ï¼šengine_class&#x2F;ring_id å…¨è·¯å¾„æ‰“é€šï¼›gseq&#x2F;cseq æ­£å¸¸é€’å¢</li>
<li>æ–‡æ¡£ï¼šæ–°å¢å­—æ®µä¸è¿‡æ»¤ç”¨æ³•è¯´æ˜</li>
<li>å†’çƒŸï¼šä¸¤ ring å¹¶å‘ï¼ŒæŒ‰ ring è®¡æ•°ä¸€è‡´</li>
<li>æäº¤ï¼šå¤šè¡Œè‹±æ–‡ï¼›åŒ…å« before&#x2F;after è¡Œä¸ºè¯´æ˜</li>
<li>åº¦é‡ï¼šæœ¬æœŸå‡€å¢ â‰¥700 è¡Œ</li>
</ul>
<h4 id="å®æ–½ä»»åŠ¡ï¼ˆæ–‡ä»¶-å‡½æ•°-é”®ï¼‰"><a href="#å®æ–½ä»»åŠ¡ï¼ˆæ–‡ä»¶-å‡½æ•°-é”®ï¼‰" class="headerlink" title="å®æ–½ä»»åŠ¡ï¼ˆæ–‡ä»¶&#x2F;å‡½æ•°&#x2F;é”®ï¼‰"></a>å®æ–½ä»»åŠ¡ï¼ˆæ–‡ä»¶&#x2F;å‡½æ•°&#x2F;é”®ï¼‰</h4><ul>
<li>å†…æ ¸ï¼ˆdrivers&#x2F;gpu&#x2F;grtrace&#x2F;grtrace.cï¼‰<ul>
<li>å­—æ®µä¸ç»Ÿè®¡ï¼šengine_class&#x2F;ring_id è´¯ç©¿ hdr&#x2F;payloadï¼›è¡¥é½ writes_short&#x2F;bytes_written&#x2F;bytes_droppedï¼›events_by_type[] æŒ‰ type è®¡æ•°</li>
<li>è¿‡æ»¤ï¼šgrtrace_should_drop_by_filter() ä¸²æ¥ filter_engine_maskã€filter_ring_idï¼›config_write æ”¯æŒé”®ï¼šfilter_engine_maskã€filter_ring_id</li>
<li>æ—¶é—´ä¸åºåˆ—ï¼šç»Ÿä¸€ä½¿ç”¨ ktime_get_ns()ï¼›gseq ä¸ºå…¨å±€ 64 ä½å•è°ƒï¼›cseq ä¸º per-CPU 32&#x2F;64 ä½ï¼ˆå½“å‰å®ç°å­˜åœ¨ï¼‰</li>
<li>è§†å›¾ï¼ševents_by_typeã€pc_cseqã€pc_statsï¼ˆç°å·²å…·å¤‡ï¼Œéœ€å¯¹é½å­—æ®µï¼‰</li>
</ul>
</li>
<li>ç”¨æˆ·æ€ï¼ˆtools&#x2F;grtraceï¼‰<ul>
<li>CLIï¼šâ€“engine [MASK]ã€â€“ring [ID] è¿‡æ»¤å‚æ•°ï¼›ç»Ÿè®¡æŒ‰ ring èšåˆæ‰“å°</li>
<li>è§£æï¼šä¿ç•™å¯¹æœªçŸ¥ type çš„è·³è¯»ï¼ˆæŒ‰ hdr.sizeï¼‰</li>
</ul>
</li>
</ul>
<h4 id="å¥‘çº¦ä¸å•ä½"><a href="#å¥‘çº¦ä¸å•ä½" class="headerlink" title="å¥‘çº¦ä¸å•ä½"></a>å¥‘çº¦ä¸å•ä½</h4><ul>
<li>tsï¼šnsï¼Œmonotonicï¼›gseqï¼šu64 å•è°ƒé€’å¢ï¼›cseqï¼šper-CPU å•è°ƒ</li>
<li>engine_classï¼šu16ï¼ˆbitmaskï¼‰ï¼›ring_idï¼šu16ï¼›ctx_idï¼šu32</li>
<li>è®¡æ•°ä¸å•ä½ï¼šä½¿ç”¨é€šé…åç¼€è¯´æ˜ï¼šbytes[â€¦]&#x3D;å­—èŠ‚ï¼›writes[â€¦]&#x3D;æ¬¡ï¼›filtered[â€¦]&#x3D;æ¡</li>
</ul>
<h4 id="å†’çƒŸè„šæœ¬ï¼ˆå¯å¤åˆ¶ï¼‰"><a href="#å†’çƒŸè„šæœ¬ï¼ˆå¯å¤åˆ¶ï¼‰" class="headerlink" title="å†’çƒŸè„šæœ¬ï¼ˆå¯å¤åˆ¶ï¼‰"></a>å†’çƒŸè„šæœ¬ï¼ˆå¯å¤åˆ¶ï¼‰</h4><ol>
<li>echo start &gt; &#x2F;sys&#x2F;kernel&#x2F;debug&#x2F;grtrace&#x2F;control</li>
<li>echo â€œfilter_ring_id&#x3D;1â€ &gt; &#x2F;sys&#x2F;kernel&#x2F;debug&#x2F;grtrace&#x2F;config</li>
<li>echo â€œemit submit 100 0 1 1â€ &gt; &#x2F;sys&#x2F;kernel&#x2F;debug&#x2F;grtrace&#x2F;emit</li>
<li>echo â€œemit submit 100 0 2 1â€ &gt; &#x2F;sys&#x2F;kernel&#x2F;debug&#x2F;grtrace&#x2F;emit</li>
<li>cat &#x2F;sys&#x2F;kernel&#x2F;debug&#x2F;grtrace&#x2F;stats | grep -E â€œevents_by_type|filtered_|writes_â€</li>
<li>echo stop &gt; &#x2F;sys&#x2F;kernel&#x2F;debug&#x2F;grtrace&#x2F;control</li>
</ol>
<p>é¢„æœŸï¼šring&#x3D;1 äº‹ä»¶è¢«è®¡å…¥ï¼Œring&#x3D;2 è¢«è¿‡æ»¤æˆ–åœ¨èšåˆä¸­åŒºåˆ†ï¼›æ— å†…æ ¸é”™è¯¯æ—¥å¿—ã€‚</p>
<h4 id="é£é™©ä¸å›é€€"><a href="#é£é™©ä¸å›é€€" class="headerlink" title="é£é™©ä¸å›é€€"></a>é£é™©ä¸å›é€€</h4><ul>
<li>å¤š CPU æ—¶é—´åºåˆ—ç©¿æ’å¯¼è‡´å…¨å±€é¡ºåºæ„ŸçŸ¥å›°éš¾ â†’ ä»¥ gseq å…œåº•æ’åºï¼ŒæŒ‰ ring å±€éƒ¨æœ‰åº</li>
<li>engine&#x2F;ring æšä¸¾ä¸ä¸€è‡´ â†’ ä»¥ METADATA å¯¼å‡ºæšä¸¾è¡¨ï¼›ç”¨æˆ·æ€æŒ‰è¡¨æ˜ å°„</li>
</ul>
<hr>
<h2 id="v0-3-äº‹ä»¶æ¨¡å‹ç¨³å®šåŒ–-âœ…-å·²å®Œæˆ"><a href="#v0-3-äº‹ä»¶æ¨¡å‹ç¨³å®šåŒ–-âœ…-å·²å®Œæˆ" class="headerlink" title="v0.3 äº‹ä»¶æ¨¡å‹ç¨³å®šåŒ– âœ… å·²å®Œæˆ"></a>v0.3 äº‹ä»¶æ¨¡å‹ç¨³å®šåŒ– âœ… <strong>å·²å®Œæˆ</strong></h2><ul>
<li><p>å†…æ ¸</p>
<ul>
<li><input checked disabled type="checkbox"> äº‹ä»¶è¯­ä¹‰ä¸å­—æ®µå†»ç»“ï¼ˆæäº¤&#x2F;å¼€å§‹&#x2F;ç»“æŸ&#x2F;å®Œæˆ&#x2F;ctx_switch&#x2F;ä¾èµ–ç­‰å¾…&#x2F;doorbell&#x2F;å¯é€‰ bo-mapï¼‰ (æäº¤ 4592fa4b)</li>
<li><input disabled type="checkbox"> æœ€å°äº‹ä»¶é›†å¯æ¨å¯¼æ ¸å¿ƒæ—¶åºï¼š<ul>
<li><input checked disabled type="checkbox"> COMMITï¼ˆå‘½ä»¤è½å…¥ ringï¼‰&#x2F;SUBMITï¼ˆdoorbellï¼‰&#x2F;STARTï¼ˆç¡¬ä»¶å–æŒ‡ï¼‰&#x2F;ENDï¼ˆç¡¬ä»¶å®Œæˆï¼‰&#x2F;IRQï¼ˆä¸ŠæŠ›ï¼‰ (æäº¤ 4592fa4b)</li>
<li><input checked disabled type="checkbox"> SYNC_WAIT_{ENTER,EXIT}ï¼ˆGPU å†…åŒæ­¥ç­‰å¾…ç‰‡æ®µï¼‰&#x2F;CTX_SWITCHï¼ˆä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå«æŠ¢å æ ‡è®°ï¼‰ (æäº¤ 4592fa4b)</li>
</ul>
</li>
<li><input checked disabled type="checkbox"> ä½¿èƒ½æŒ‰ job&lt;ctx, ring, seqno&gt; èšåˆçš„å­—æ®µï¼Œä¿è¯å¯è®¡ç®— t_submit_host&#x2F;t_queue&#x2F;t_exec&#x2F;t_gpu_wait&#x2F;t_complete (æäº¤ 4592fa4b)</li>
<li><input checked disabled type="checkbox"> ç‰ˆæœ¬åå•†ï¼ˆMAGICã€VERSIONã€feature bitsï¼‰ (æäº¤ fcda982a)</li>
<li><input checked disabled type="checkbox"> é”™è¯¯è·¯å¾„ä¸å¼‚å¸¸äº‹ä»¶ï¼ˆreset&#x2F;timeoutï¼‰ (æäº¤ 4592fa4b)</li>
</ul>
</li>
<li><p>ç”¨æˆ·æ€</p>
<ul>
<li><input checked disabled type="checkbox"> ç‰ˆæœ¬&#x2F;ç‰¹æ€§æ¢æµ‹ä¸å…¼å®¹å›é€€ (æäº¤ fcda982a)</li>
</ul>
</li>
<li><p>éªŒæ”¶</p>
<ul>
<li><input checked disabled type="checkbox"> äº‹ä»¶ schema å®¡æ ¸é€šè¿‡ï¼Œæäº¤å…¼å®¹æ€§åŸºçº¿ (æäº¤ fcda982a)</li>
</ul>
</li>
<li><p>ä»£ç å¼€å‘é‡é¢„ä¼°ï¼š900 è¡Œ</p>
</li>
<li><p><strong>å®é™…å®ç°ï¼ˆå®¡è®¡è¯æ®ï¼‰</strong>:</p>
<ul>
<li><p>ä»£è¡¨æ€§æäº¤ï¼š</p>
<ul>
<li>4592fa4b â€” add stream header, extend event set, and ordering&#x2F;stats<ul>
<li>numstat: drivers&#x2F;gpu&#x2F;grtrace&#x2F;grtrace.c +177 -24; include&#x2F;linux&#x2F;grtrace.h +14 -0</li>
<li>æäº¤å‡€æ–°å¢è¡Œï¼ˆç¤ºä¾‹ï¼‰ï¼š+191ï¼ˆå«æ ¸å¿ƒäº‹ä»¶æšä¸¾ä¸å®ç°æ”¹åŠ¨ï¼‰</li>
</ul>
</li>
<li>fcda982a â€” METADATA å’Œ userspace parserï¼ˆtools&#x2F;grtraceï¼‰<ul>
<li>numstat: drivers&#x2F;gpu&#x2F;grtrace&#x2F;grtrace.c +52 -0; tools&#x2F;grtrace&#x2F;grtrace.c +224 -74; tools README +7 -1</li>
</ul>
</li>
</ul>
</li>
<li><p>ç»“è®ºï¼šv0.3 çš„äº‹ä»¶æ¨¡å‹ä¸»è¦ç”± 4592fa4b å®Œæˆã€‚<br>fcda982a è¡¥å……äº†æ ¼å¼ã€è§£æä¸ç”¨æˆ·æ€å·¥å…·å®ç°ã€‚<br>åˆè®¡åœ¨å†…æ ¸ä¸å·¥å…·ç«¯äº§ç”Ÿäº†å®è´¨æ€§çš„æ–°å¢ä»£ç ï¼ˆè¯¦è§æ¯ä¸ªæäº¤çš„ numstatï¼‰ã€‚</p>
</li>
<li><p>å®¡è®¡å‡€å¢è¡Œæ•°ï¼ˆæœ¬é‡Œç¨‹ç¢‘ï¼‰ï¼šdrivers&#x2F;gpu&#x2F;grtrace ç›¸å…³å˜æ›´åœ¨æäº¤èŒƒå›´å†…<br>å‡€å¢çº¦ +356 è¡Œï¼ˆå†…æ ¸ + ç”¨æˆ·æ€ åˆè®¡ï¼Œæ¥æºï¼šgit numstat æ±‡æ€»ï¼‰ã€‚</p>
</li>
</ul>
</li>
</ul>
<h3 id="v0-3-è¯¦ç»†æ‹†è§£"><a href="#v0-3-è¯¦ç»†æ‹†è§£" class="headerlink" title="v0.3 è¯¦ç»†æ‹†è§£"></a>v0.3 è¯¦ç»†æ‹†è§£</h3><ul>
<li><p>ç›®æ ‡ï¼ˆç²¾ç¡®ï¼‰</p>
<ul>
<li>å†»ç»“å¹¶å®ç°äº‹ä»¶æ¨¡å‹ï¼šCOMMIT&#x2F;SUBMIT&#x2F;START&#x2F;END&#x2F;IRQ&#x2F;CTX_SWITCH&#x2F;SYNC_WAIT_{ENTER,EXIT}&#x2F;ERROR</li>
<li>å¼•å…¥ STREAM_INFO ä¸ METADATA æ”¯æŒï¼Œä¿è¯ç”¨æˆ·æ€èƒ½ä¾æ® hdr.size åš forward-compatible è·³è¯»</li>
<li>æ‰©å±•äº‹ä»¶å­—æ®µä»¥æ”¯æŒ per-job æ—¶åºæ¨å¯¼ï¼ˆsubmit_ts&#x2F;start_ts&#x2F;end_ts&#x2F;complete_tsï¼‰åŠç‰ˆæœ¬&#x2F;feature åå•†</li>
</ul>
</li>
<li><p>å…³é”®æ–‡ä»¶&#x2F;å‡½æ•°æ¸…å•ï¼ˆå†…æ ¸ï¼‰</p>
<ul>
<li>drivers&#x2F;gpu&#x2F;grtrace&#x2F;grtrace.c<ul>
<li>äº‹ä»¶æšä¸¾ä¸ç»“æ„ï¼šå®šä¹‰æ‰€æœ‰äº‹ä»¶ç±»å‹åŠ hdr.size è¯­ä¹‰</li>
<li>grtrace_write_eventï¼šäº‹ä»¶ç¼–ç ä¸å†™å…¥è·¯å¾„ï¼ˆå« size æ ¡éªŒï¼‰</li>
<li>STREAM_INFO&#x2F;METADATA å‘é€å‡½æ•°</li>
<li>å…¼å®¹æ€§&#x2F;ç‰ˆæœ¬åå•†é€»è¾‘ï¼ˆfeature bitsï¼‰</li>
</ul>
</li>
<li>include&#x2F;linux&#x2F;grtrace.h<ul>
<li>header&#x2F;payload å®šä¹‰ä¸ç‰ˆæœ¬å¸¸é‡</li>
</ul>
</li>
</ul>
</li>
<li><p>ç”¨æˆ·æ€&#x2F;å·¥å…·</p>
<ul>
<li>tools&#x2F;grtrace&#x2F;grtrace.c<ul>
<li>parserï¼šæŒ‰ hdr.size è·³è¯»æœªçŸ¥ payloadï¼›æ”¯æŒç‰ˆæœ¬å›é€€ä¸ feature bits æ¢æµ‹</li>
<li>å¯¼å‡º per-job CSVã€æ”¯æŒ unknown_events ç»Ÿè®¡</li>
</ul>
</li>
</ul>
</li>
<li><p>DoDï¼ˆå¯éªŒæ¡ä»¶ï¼‰</p>
<ul>
<li>ä»£ç ï¼šç¼–è¯‘é€šè¿‡ï¼ŒSTREAM_INFOâ†’METADATA é¡ºåºç¨³å®šï¼Œhdr.size é©±åŠ¨è·³è¯»é€»è¾‘ç”Ÿæ•ˆ</li>
<li>è¡Œä¸ºï¼šç”¨æˆ·æ€è§£æå™¨åœ¨é‡åˆ°æœªçŸ¥æ‰©å±•å­—æ®µæ—¶ä¸å´©æºƒï¼Œèƒ½ç»§ç»­è§£æåç»­äº‹ä»¶</li>
<li>æ–‡æ¡£ï¼šäº‹ä»¶è¯­ä¹‰ã€STREAM_INFO&#x2F;METADATA é¡ºåºä¸ç¤ºä¾‹å·²å†™å…¥ docs&#x2F; æˆ– README</li>
<li>å†’çƒŸï¼šç”Ÿæˆä¸€æ¡åŒ…å« METADATA çš„æµï¼Œæ—§ç‰ˆè§£æå™¨èƒ½è¯»å‡ºä¸»ä½“äº‹ä»¶è€Œä¸ä¼šå´©æºƒ</li>
</ul>
</li>
<li><p>å†’çƒŸæµ‹è¯•æ­¥éª¤ï¼ˆå¯å¤åˆ¶ï¼‰</p>
<ol>
<li>startâ†’æ•è·å‰ä¸¤æ¡è®°å½•ï¼Œç¡®è®¤ STREAM_INFOâ†’METADATA é¡ºåº</li>
<li>ä½¿ç”¨è¾ƒæ—§çš„ tools&#x2F;grtrace parser å»è§£æï¼ˆæ¨¡æ‹Ÿæ—§è§£æå™¨ï¼‰ï¼Œç¡®è®¤ä¸»äº‹ä»¶ï¼ˆsubmit&#x2F;completeï¼‰èƒ½è¢«è§£æä¸”æœªçŸ¥æ‰©å±•è¢«è·³è¿‡</li>
</ol>
</li>
<li><p>å®ç°è¯æ®ï¼ˆnumstat &#x2F; æäº¤å¼•ç”¨ï¼‰</p>
<ul>
<li><p>4592fa4b â€” add stream header, extend event set, and ordering&#x2F;stats</p>
<ul>
<li>numstat:<ul>
<li>drivers&#x2F;gpu&#x2F;grtrace&#x2F;grtrace.c: +177 -24</li>
<li>include&#x2F;linux&#x2F;grtrace.h: +14 -0</li>
</ul>
</li>
</ul>
</li>
<li><p>fcda982a â€” METADATA å’Œ userspace parser</p>
<ul>
<li>numstat:<ul>
<li>drivers&#x2F;gpu&#x2F;grtrace&#x2F;grtrace.c: +52 -0</li>
<li>tools&#x2F;grtrace&#x2F;grtrace.c: +224 -74</li>
</ul>
</li>
</ul>
</li>
<li><p>å®¡è®¡æ±‡æ€»ï¼ˆç¤ºä¾‹å‘½ä»¤ï¼‰ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git show --numstat 4592fa4b<br>git show --numstat fcda982a<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>é£é™©ä¸å›é€€</p>
<ul>
<li>äº‹ä»¶æ¨¡å‹ä¸€æ—¦å†»ç»“ï¼Œåç»­æ‰©å±•éœ€é€šè¿‡æ–°å¢ type æˆ–å¯é€‰ payload ä¿æŒå…¼å®¹ï¼›è‹¥è¯¯ç”¨æ‰©å±•å­—æ®µå¯¼è‡´è§£æå¤±è´¥ï¼Œé€€å›åˆ° hdr.size è·³è¿‡ç­–ç•¥</li>
</ul>
</li>
<li><p>å†…æ ¸ï¼ˆgrtrace.cï¼‰</p>
<ul>
<li>äº‹ä»¶å†»ç»“ï¼šCOMMIT&#x2F;SUBMIT&#x2F;START&#x2F;END&#x2F;IRQ&#x2F;CTX_SWITCH&#x2F;SYNC_WAIT_{ENTER,EXIT}&#x2F;ERROR</li>
<li>STREAM_INFO + METADATAï¼ˆç°å·²å®ç°ï¼‰ï¼šfeature bits&#x2F;clock æº&#x2F;ç‰ˆæœ¬</li>
<li>DoDï¼šå…¨éƒ¨äº‹ä»¶å¯¼å‡ºï¼Œç”¨æˆ·æ€èƒ½è§£æå¹¶ç”Ÿæˆæ—¶é—´çº¿</li>
<li>é¢„ä¼° LOCï¼š~500â€“600ï¼ˆå«ç»“æ„ä½“ã€è·¯å¾„æ‰“é€šï¼‰</li>
</ul>
</li>
<li><p>ç”¨æˆ·æ€ï¼ˆtools&#x2F;grtraceï¼‰</p>
<ul>
<li>è§£æå¹¶å¯¼å‡º per-job æŒ‡æ ‡ï¼ˆt_queue&#x2F;t_exec ç­‰ï¼‰</li>
<li>DoDï¼šå¯¹ä¸€ç»„äº‹ä»¶è¾“å‡ºæ¯ job çš„å…³é”®æ—¶é•¿</li>
<li>é¢„ä¼° LOCï¼š~250â€“300</li>
</ul>
</li>
</ul>
<p>ã€v0.3 DoD æ£€æŸ¥è¡¨ã€‘</p>
<ul>
<li>ä»£ç ï¼šå…¨éƒ¨äº‹ä»¶ç±»å‹è½åœ°ï¼›payload ä¸ hdr.size å¯¹é½</li>
<li>æ–‡æ¡£ï¼šäº‹ä»¶è¯­ä¹‰&#x2F;å­—æ®µè¯´æ˜ä¸æ—¶åºç¤ºæ„å›¾</li>
<li>å†’çƒŸï¼šç”Ÿæˆæ¯ job å…³é”®æ—¶é•¿ CSV</li>
<li>æäº¤ï¼šåˆ—å‡ºæ–°å¢&#x2F;ä¿®æ”¹äº‹ä»¶ä¸å…¼å®¹æ€§è¯´æ˜</li>
<li>åº¦é‡ï¼šæœ¬æœŸå‡€å¢ â‰¥900 è¡Œ</li>
</ul>
<h4 id="v0-3-å®æ–½ä»»åŠ¡ï¼ˆæ–‡ä»¶-å‡½æ•°-é”®ï¼‰"><a href="#v0-3-å®æ–½ä»»åŠ¡ï¼ˆæ–‡ä»¶-å‡½æ•°-é”®ï¼‰" class="headerlink" title="v0.3 å®æ–½ä»»åŠ¡ï¼ˆæ–‡ä»¶&#x2F;å‡½æ•°&#x2F;é”®ï¼‰"></a>v0.3 å®æ–½ä»»åŠ¡ï¼ˆæ–‡ä»¶&#x2F;å‡½æ•°&#x2F;é”®ï¼‰</h4><ul>
<li>å†…æ ¸ï¼ˆgrtrace.cï¼‰<ul>
<li>äº‹ä»¶æšä¸¾ä¸ç»“æ„ï¼š<ul>
<li>COMMIT&#x2F;SUBMIT&#x2F;START&#x2F;END&#x2F;IRQ&#x2F;CTX_SWITCH&#x2F;SYNC_WAIT_{ENTER,EXIT}&#x2F;ERROR</li>
<li>ç»“æ„ç»Ÿä¸€ä»¥ hdr(size,u16) + payloadï¼Œæ–°å¢å­—æ®µç½®äºæœ«å°¾ï¼Œä¿æŒå¯¹é½</li>
</ul>
</li>
<li>METADATAï¼šå¢åŠ  feature_bitsï¼ˆbit0: size-skip; bit1: token-bucket; bit2: watchlist; â€¦ï¼‰</li>
<li>é”™è¯¯è·¯å¾„ï¼šERROR äº‹ä»¶åŒ…å« codeï¼ˆreset&#x2F;timeoutï¼‰ã€ringã€ctxã€ts</li>
<li>æ ¡éªŒï¼šç¼–è§£ç è‡ªæµ‹ï¼ˆå¤§å°ç«¯ã€å¯¹é½ã€size æ ¡éªŒï¼‰</li>
</ul>
</li>
<li>ç”¨æˆ·æ€ï¼ˆtools&#x2F;grtraceï¼‰<ul>
<li>è§£æï¼šæŒ‰ hdr.size è·³è¯»ï¼›æœªçŸ¥ type è®¡æ•°åˆ° unknown_events</li>
<li>å¯¼å‡ºï¼šper-job æŒ‡æ ‡ CSVï¼ˆsubmit_tsã€start_tsã€end_tsã€complete_tsã€t_queueã€t_execâ€¦ï¼‰</li>
</ul>
</li>
</ul>
<h4 id="v0-3-å¥‘çº¦ä¸å•ä½"><a href="#v0-3-å¥‘çº¦ä¸å•ä½" class="headerlink" title="v0.3 å¥‘çº¦ä¸å•ä½"></a>v0.3 å¥‘çº¦ä¸å•ä½</h4><ul>
<li>hdr.sizeï¼šå«å¤´+payloadï¼Œæ€»æ˜¯å¶æ•°å¯¹é½ï¼›payload å­—æ®µå°ç«¯</li>
<li>job keyï¼š{ctx_id, ring_id, seqno}ï¼›å…è®¸ seqno å›ç»•ï¼ˆu32ï¼‰ï¼Œä»¥ gseq ååŠ© disambiguation</li>
<li>CTX_SWITCHï¼šæ ‡è®° preempt:booleanï¼Œfrom_ctxâ†’to_ctx</li>
</ul>
<h4 id="v0-3-å†’çƒŸè„šæœ¬ï¼ˆå¯å¤åˆ¶ï¼‰"><a href="#v0-3-å†’çƒŸè„šæœ¬ï¼ˆå¯å¤åˆ¶ï¼‰" class="headerlink" title="v0.3 å†’çƒŸè„šæœ¬ï¼ˆå¯å¤åˆ¶ï¼‰"></a>v0.3 å†’çƒŸè„šæœ¬ï¼ˆå¯å¤åˆ¶ï¼‰</h4><ol>
<li>start + å‘ä¸€ç»„ submit&#x2F;commit&#x2F;start&#x2F;end&#x2F;irq + ctx_switch</li>
<li>userspace è§£æç”Ÿæˆ per-job CSV</li>
<li>æ ¡éªŒ t_exec &#x3D; end-startï¼Œt_queue &#x3D; start-submit ä¸ºæ­£</li>
</ol>
<h4 id="v0-3-é£é™©ä¸å›é€€"><a href="#v0-3-é£é™©ä¸å›é€€" class="headerlink" title="v0.3 é£é™©ä¸å›é€€"></a>v0.3 é£é™©ä¸å›é€€</h4><ul>
<li>äº‹ä»¶ç¼ºå¤±æˆ–ä¹±åº â†’ per-job å®¹é”™ï¼šç¼ºå¤±å¡« NAï¼›ä¹±åºæŒ‰ gseq æ ¡æ­£</li>
<li>å¤§ payload å¼•å…¥å¯¹é½é—®é¢˜ â†’ ç»Ÿä¸€ u8 å¡«å……ï¼Œhdr.size ä¿éšœè·³è¯»</li>
</ul>
<hr>
<h2 id="v0-4-å·¥å…·é“¾ï¼ˆgrtraceï¼‰-âœ…-å·²å®Œæˆ"><a href="#v0-4-å·¥å…·é“¾ï¼ˆgrtraceï¼‰-âœ…-å·²å®Œæˆ" class="headerlink" title="v0.4 å·¥å…·é“¾ï¼ˆgrtraceï¼‰ âœ… å·²å®Œæˆ"></a>v0.4 å·¥å…·é“¾ï¼ˆgrtraceï¼‰ âœ… <strong>å·²å®Œæˆ</strong></h2><ul>
<li><p>ç”¨æˆ·æ€</p>
<ul>
<li><input checked disabled type="checkbox"> grtraceï¼šstart&#x2F;stop&#x2F;status&#x2F;configï¼ˆdebugfs&#x2F;ioctlï¼‰ (æäº¤ 91c89d26)</li>
<li><input checked disabled type="checkbox"> reportï¼šé˜»å¡ç‚¹åˆ†ææœ€å°äº§å‡ºï¼ˆper-job æŒ‡æ ‡ä¸æ ‡ç­¾ã€per-ring èšåˆã€Top-N ç±»åˆ«ï¼‰ (æäº¤ 91c89d26)</li>
<li><input checked disabled type="checkbox"> æœ€å°å¯è§†åŒ–ç¤ºä¾‹ï¼ˆæ—¶é—´çº¿&#x2F;ç›´æ–¹å›¾&#x2F;Top-Nï¼‰ (æäº¤ 91c89d26)</li>
</ul>
</li>
<li><p>æ–‡æ¡£</p>
<ul>
<li><input checked disabled type="checkbox"> å¿«é€Ÿå¼€å§‹ã€CLI å¸®åŠ©ã€å…¸å‹åœºæ™¯æ‰‹å†Œ (æäº¤ 91c89d26)</li>
</ul>
</li>
<li><p>éªŒæ”¶</p>
<ul>
<li><input checked disabled type="checkbox"> ä¸€æ¡å‘½ä»¤å®Œæˆé‡‡é›†ï¼Œå¦ä¸€æ¡ç”Ÿæˆé˜»å¡ç‚¹æŠ¥å‘Šï¼š (æäº¤ 91c89d26)<ul>
<li><input checked disabled type="checkbox"> per-job è¾“å‡ºå« t_submit_host&#x2F;t_queue&#x2F;t_exec&#x2F;t_gpu_wait&#x2F;t_complete ä¸æ ‡ç­¾ (æäº¤ 91c89d26)</li>
<li><input checked disabled type="checkbox"> per-ring æ±‡æ€»å«æ ‡ç­¾å æ¯”ä¸ç–‘ä¼¼ç»“æ„æ€§ç“¶é¢ˆæç¤º (æäº¤ 91c89d26)</li>
</ul>
</li>
</ul>
</li>
<li><p>ä»£ç å¼€å‘é‡é¢„ä¼°ï¼š1200 è¡Œ</p>
</li>
<li><p><strong>å®é™…å®ç°ï¼ˆå®¡è®¡è¯æ®ï¼‰</strong>:</p>
<ul>
<li>91c89d26 â€” grtrace&#x2F;tools: add CLI for start&#x2F;stop&#x2F;record&#x2F;report<ul>
<li>numstat:<ul>
<li>tools&#x2F;grtrace&#x2F;grtrace.c: +539 -0</li>
<li>tools&#x2F;grtrace&#x2F;Makefile: +25 -0</li>
<li>tools&#x2F;grtrace&#x2F;README.md: +25 -0</li>
</ul>
</li>
<li>æäº¤æ–°å¢è¡Œï¼š+589ï¼ˆä¸»è¦ä¸º CLI å®ç°ä¸å¸®åŠ©æ–‡æ¡£ï¼‰</li>
</ul>
</li>
<li>fcda982a â€” parser ä¸å·¥å…·é—´åè®®è¡¥å……ï¼štools&#x2F;grtrace&#x2F;grtrace.c +224 -74<br> ç»“è®ºï¼šå·¥å…·é“¾ä¸»è¦ç”± 91c89d26 å®Œæˆã€‚<br> parserï¼ˆfcda982aï¼‰ä½œä¸ºè¡¥å……ï¼Œä½¿å¾—ç”¨æˆ·æ€åŠŸèƒ½æ»¡è¶³ v0.4 çš„ DoD è¦æ±‚ã€‚</li>
</ul>
</li>
</ul>
<p> å®¡è®¡å‡€å¢è¡Œæ•°ï¼ˆæœ¬é‡Œç¨‹ç¢‘ï¼‰ï¼štools&#x2F;grtrace åŠç›¸å…³ç”¨æˆ·æ€æ”¹åŠ¨<br> åœ¨æäº¤èŒƒå›´å†…å‡€å¢çº¦ +589 è¡Œï¼ˆä¸»è¦ä¸º CLI ä¸æŠ¥å‘ŠåŠŸèƒ½ï¼‰</p>
<h3 id="v0-4-è¯¦ç»†æ‹†è§£"><a href="#v0-4-è¯¦ç»†æ‹†è§£" class="headerlink" title="v0.4 è¯¦ç»†æ‹†è§£"></a>v0.4 è¯¦ç»†æ‹†è§£</h3><ul>
<li><p>ç›®æ ‡ï¼ˆç²¾ç¡®ï¼‰</p>
<ul>
<li>æä¾›å¯ç”¨çš„ CLIï¼šgrtrace start|stop|status|config|report</li>
<li>report èƒ½äº§ç”Ÿ per-job æŒ‡æ ‡ï¼ˆt_submit_host&#x2F;t_queue&#x2F;t_exec&#x2F;t_gpu_wait&#x2F;t_completeï¼‰åŠ Top-N é˜»å¡ç‚¹</li>
<li>æä¾›æœ€å°å¯è§†åŒ–ç¤ºä¾‹ä¸å¿«é€Ÿå¼€å§‹æ–‡æ¡£</li>
</ul>
</li>
<li><p>å…³é”®æ–‡ä»¶&#x2F;å‡½æ•°ï¼ˆç”¨æˆ·æ€ï¼‰</p>
<ul>
<li>tools&#x2F;grtrace&#x2F;grtrace.c<ul>
<li>subcommands: start&#x2F;stop&#x2F;status&#x2F;config&#x2F;report</li>
<li>reportï¼šTop-N&#x2F;ç›´æ–¹å›¾&#x2F;CSV å¯¼å‡º</li>
</ul>
</li>
<li>tools&#x2F;grtrace&#x2F;Makefile, README.md</li>
</ul>
</li>
<li><p>DoDï¼ˆå¯éªŒï¼‰</p>
<ul>
<li>CLI èƒ½æˆåŠŸ start&#x2F;stop å¹¶ç”Ÿæˆ report æ–‡ä»¶</li>
<li>report è¾“å‡ºåŒ…å« per-job æ ç›®ï¼ˆjob_keyã€t_queueã€t_execã€t_gpu_waitã€t_completeï¼‰å¹¶èƒ½ç”¨ â€“per-ring èšåˆ</li>
<li>æ–‡æ¡£ï¼šå¿«é€Ÿå¼€å§‹è„šæœ¬&#x2F;ç¤ºä¾‹åœ¨ README ä¸­å¯å¤åˆ¶æ‰§è¡Œ</li>
</ul>
</li>
<li><p>å†’çƒŸæµ‹è¯•ï¼ˆå¯å¤åˆ¶ï¼‰</p>
<ol>
<li>grtrace start</li>
<li>è¿è¡Œ workload æˆ– emit æ³¨å…¥</li>
<li>grtrace report â€“topn 5 â€“hist lat â€“per-ring &gt; report.txt</li>
<li>éªŒè¯ report.txt åŒ…å« per-job è¾“å‡ºä¸ Top-N åˆ—è¡¨</li>
</ol>
</li>
<li><p>å®ç°è¯æ®</p>
<ul>
<li><p>91c89d26 â€” grtrace&#x2F;tools: add CLI for start&#x2F;stop&#x2F;record&#x2F;report</p>
<ul>
<li>numstat: tools&#x2F;grtrace&#x2F;grtrace.c +539 -0; tools&#x2F;grtrace&#x2F;Makefile +25 -0; tools&#x2F;grtrace&#x2F;README.md +25 -0</li>
</ul>
</li>
<li><p>fcda982a â€” parser ä¸å·¥å…·é—´åè®®è¡¥å……ï¼štools&#x2F;grtrace&#x2F;grtrace.c +224 -74</p>
</li>
<li><p>å®¡è®¡å‘½ä»¤ï¼ˆç¤ºä¾‹ï¼‰ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git show --numstat 91c89d26<br>git show --numstat fcda982a<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>é£é™©ä¸å›é€€</p>
<ul>
<li>CLI è¯­ä¹‰å˜æ›´å¯èƒ½ç ´åä¸Šå±‚è„šæœ¬ â†’ æä¾›åˆ«åä¸å…¼å®¹å­å‘½ä»¤ï¼›report çš„æ ¼å¼åº”ä¿æŒç¨³å®šæˆ–æä¾› â€“format é€‰é¡¹</li>
</ul>
</li>
<li><p>ç”¨æˆ·æ€ï¼ˆtools&#x2F;grtraceï¼‰</p>
<ul>
<li>æ§åˆ¶é¢ï¼šstart&#x2F;stop&#x2F;status&#x2F;config ä¸€ä½“åŒ– CLI</li>
<li>æŠ¥å‘Šï¼šTop-N é˜»å¡ç±»åˆ«ã€ç›´æ–¹å›¾ã€ç®€å•æ—¶é—´çº¿</li>
<li>DoDï¼šä¸€æ¡å‘½ä»¤é‡‡é›†ã€å¦ä¸€æ¡ç”ŸæˆæŠ¥å‘Šï¼›ç”Ÿæˆ CSV&#x2F;æ–‡æœ¬</li>
<li>é¢„ä¼° LOCï¼š~700â€“800</li>
</ul>
</li>
<li><p>å†…æ ¸ï¼ˆgrtrace.cï¼‰</p>
<ul>
<li>å¯é€‰ CSV è§†å›¾ï¼ˆevents_by_typeã€latency_histã€pc_*ã€sec_stats å·²å…·å¤‡ï¼‰</li>
<li>DoDï¼šè§†å›¾ read æœ‰æ•ˆï¼Œstats ä¸è§†å›¾ä¸€è‡´</li>
<li>é¢„ä¼° LOCï¼š~200â€“300ï¼ˆè¡¥é½ï¼‰</li>
</ul>
</li>
</ul>
<p>ã€v0.4 DoD æ£€æŸ¥è¡¨ã€‘</p>
<ul>
<li>ä»£ç ï¼šCLI å¯ start&#x2F;stop&#x2F;status&#x2F;configï¼›æŠ¥å‘Šå¯ç”Ÿæˆ Top-N&#x2F;ç›´æ–¹å›¾</li>
<li>æ–‡æ¡£ï¼šCLI å¸®åŠ©ä¸ç¤ºä¾‹ã€å…¸å‹åœºæ™¯</li>
<li>å†’çƒŸï¼šä¸€æ¡é‡‡é›†ä¸€æ¡æŠ¥å‘Šï¼Œæ–‡ä»¶äº§å‡ºå¯æ‰“å¼€</li>
<li>æäº¤ï¼šåˆ†ç‚¹æè¿° CLI å­å‘½ä»¤ä¸ç¤ºä¾‹</li>
<li>åº¦é‡ï¼šæœ¬æœŸå‡€å¢ â‰¥1200 è¡Œ</li>
</ul>
<h4 id="v0-4-å®æ–½ä»»åŠ¡ï¼ˆæ–‡ä»¶-å‡½æ•°-é”®ï¼‰"><a href="#v0-4-å®æ–½ä»»åŠ¡ï¼ˆæ–‡ä»¶-å‡½æ•°-é”®ï¼‰" class="headerlink" title="v0.4 å®æ–½ä»»åŠ¡ï¼ˆæ–‡ä»¶&#x2F;å‡½æ•°&#x2F;é”®ï¼‰"></a>v0.4 å®æ–½ä»»åŠ¡ï¼ˆæ–‡ä»¶&#x2F;å‡½æ•°&#x2F;é”®ï¼‰</h4><ul>
<li>ç”¨æˆ·æ€ï¼ˆtools&#x2F;grtraceï¼‰<ul>
<li>å­å‘½ä»¤ï¼šgrtrace start|stop|status|config|report</li>
<li>report é€‰é¡¹ï¼šâ€“topn Nã€â€“hist [lat|size|result]ã€â€“per-ringã€â€“per-ctx</li>
<li>è¾“å‡ºï¼šCSVï¼ˆper-jobã€per-ring æ±‡æ€»ï¼‰ã€æ–‡æœ¬ Top-Nï¼›å¯é€‰ç®€å•å›¾ï¼ˆASCII ç›´æ–¹å›¾ï¼‰</li>
</ul>
</li>
<li>å†…æ ¸ï¼ˆgrtrace.cï¼‰<ul>
<li>è§†å›¾å¯¹é½ï¼šlatency_histã€events_by_typeã€pc_statsã€sec_stats ä¸ stats ä¸€è‡´</li>
<li>configï¼šä¿æŒé”®è¯­ä¹‰ç¨³å®šï¼›éæ³•é”®è¿”å› -EINVAL</li>
</ul>
</li>
</ul>
<h4 id="v0-4-å¥‘çº¦ä¸å•ä½"><a href="#v0-4-å¥‘çº¦ä¸å•ä½" class="headerlink" title="v0.4 å¥‘çº¦ä¸å•ä½"></a>v0.4 å¥‘çº¦ä¸å•ä½</h4><ul>
<li>report åˆ—ï¼šjob_keyã€t_queueã€t_execã€t_gpu_waitã€t_completeã€labelï¼ˆå¦‚é•¿é˜Ÿåˆ—&#x2F;æ‰§è¡Œæ…¢&#x2F;æŠ¢å å¤šï¼‰</li>
<li>histï¼šé»˜è®¤ 12 æ¡¶ï¼Œ2^k å¯¹æ•°åˆ»åº¦ï¼›æ¡¶è¾¹ç•Œè¾“å‡ºåœ¨è§†å›¾é¦–è¡Œ</li>
</ul>
<h4 id="v0-4-å†’çƒŸè„šæœ¬ï¼ˆå¯å¤åˆ¶ï¼‰"><a href="#v0-4-å†’çƒŸè„šæœ¬ï¼ˆå¯å¤åˆ¶ï¼‰" class="headerlink" title="v0.4 å†’çƒŸè„šæœ¬ï¼ˆå¯å¤åˆ¶ï¼‰"></a>v0.4 å†’çƒŸè„šæœ¬ï¼ˆå¯å¤åˆ¶ï¼‰</h4><ol>
<li>grtrace start</li>
<li>è¿è¡Œç¤ºä¾‹ workloadï¼ˆæˆ– emit æ³¨å…¥ï¼‰</li>
<li>grtrace report â€“topn 5 â€“hist lat â€“per-ring &gt; report.txt</li>
<li>æ‰“å¼€ report.txt æ£€æŸ¥åˆ—&#x2F;éç©º</li>
</ol>
<h4 id="v0-4-é£é™©ä¸å›é€€"><a href="#v0-4-é£é™©ä¸å›é€€" class="headerlink" title="v0.4 é£é™©ä¸å›é€€"></a>v0.4 é£é™©ä¸å›é€€</h4><ul>
<li>CLI è¡Œä¸ºå˜åŒ–å½±å“è„šæœ¬ â†’ ä¿æŒå‘åå…¼å®¹çš„åˆ«åï¼ˆå¦‚ â€“engine-mask ä¸ â€“engineï¼‰</li>
<li>å¤§æ–‡ä»¶è¾“å‡ºè€—æ—¶ â†’ åŠ  â€“limit &#x2F; â€“since &#x2F; â€“until é€‰é¡¹</li>
</ul>
<hr>
<h2 id="v0-5-æ€§èƒ½ä¸å¼€é”€æ²»ç†-âœ…-å·²å®Œæˆ"><a href="#v0-5-æ€§èƒ½ä¸å¼€é”€æ²»ç†-âœ…-å·²å®Œæˆ" class="headerlink" title="v0.5 æ€§èƒ½ä¸å¼€é”€æ²»ç† âœ… å·²å®Œæˆ"></a>v0.5 æ€§èƒ½ä¸å¼€é”€æ²»ç† âœ… <strong>å·²å®Œæˆ</strong></h2><ul>
<li><p>å†…æ ¸</p>
<ul>
<li><input checked disabled type="checkbox"> çƒ­è·¯å¾„å‰–æä¸ä¼˜åŒ–ï¼ˆåˆ†æ”¯é¢„æµ‹ã€ç¼“å­˜å‹å¥½ã€æœ€å°åŒ–é”&#x2F;åŸå­ï¼‰ (æäº¤ fbab7b03)</li>
<li><input checked disabled type="checkbox"> å¼€å…³&#x2F;é‡‡æ ·&#x2F;çº§åˆ«ç­–ç•¥ï¼ˆoff&#x2F;normal&#x2F;verboseï¼Œé‡‡æ · Nï¼‰ (æäº¤ 12d848cd)</li>
<li><input checked disabled type="checkbox"> å¤§é‡äº‹ä»¶å‹åŠ›ä¸‹çš„é€€åŒ–ä¸ä¿æŠ¤ï¼ˆä¸¢å¼ƒç‡ã€èƒŒå‹é˜ˆå€¼ï¼‰ (æäº¤ cd2b731d)</li>
</ul>
</li>
<li><p>ç”¨æˆ·æ€</p>
<ul>
<li><input checked disabled type="checkbox"> é˜ˆå€¼ä¸è§„åˆ™å¯é…ç½®ï¼ˆå æ¯”é˜ˆå€¼ã€ç»å¯¹æ—¶é•¿ã€æ ‡ç­¾å¼€å…³ï¼‰ (æäº¤ cd2b731d)</li>
<li><input checked disabled type="checkbox"> é‡‡é›†ä¸åˆ†æå¼€é”€æŠ¥å‘Šï¼ˆäº‹ä»¶ç‡ã€ä¸¢å¼ƒã€å¹³å‡å†™å…¥æ—¶é•¿ã€è§„åˆ™å‘½ä¸­ç»Ÿè®¡ï¼‰ (æäº¤ 8896f28b)</li>
</ul>
</li>
<li><p>éªŒæ”¶</p>
<ul>
<li><input checked disabled type="checkbox"> åœ¨é«˜äº‹ä»¶ç‡ä¸‹å†…æ ¸æ— æ˜æ˜¾é€€åŒ–ï¼Œä¸¢å¼ƒç‡å¯æ§ (æäº¤ cd2b731d)</li>
</ul>
</li>
<li><p>ä»£ç å¼€å‘é‡é¢„ä¼°ï¼š800 è¡Œ</p>
</li>
<li><p><strong>å®é™…å®ç°ï¼ˆå®¡è®¡è¯æ®ï¼‰</strong>:</p>
<ul>
<li>fbab7b03 â€” Implement performance and overhead governance<ul>
<li>numstat:<ul>
<li>drivers&#x2F;gpu&#x2F;grtrace&#x2F;grtrace.c: +100 -8</li>
</ul>
</li>
</ul>
</li>
<li>12d848cd â€” runtime controls and profiling<ul>
<li>numstat:<ul>
<li>drivers&#x2F;gpu&#x2F;grtrace&#x2F;grtrace.c: +198 -5</li>
<li>tools&#x2F;grtrace&#x2F;grtrace.c: +28 -0</li>
</ul>
</li>
</ul>
</li>
<li>cd2b731d â€” core features: watchlist, token-bucket rate limiter, session id (æ€§èƒ½ç®¡æ§ç›¸å…³)<ul>
<li>numstat:<ul>
<li>drivers&#x2F;gpu&#x2F;grtrace&#x2F;grtrace.c: +119 -15</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p> æ±‡æ€»å‡€æ–°å¢ï¼šä¸Šè¿°ä¸‰ä¸ªæäº¤åœ¨ grtrace.c ä¸Šç´¯è®¡çº¦ +417 è¡Œæ–°å¢ï¼ˆå«å°‘é‡åˆ é™¤ï¼‰ï¼Œ<br> ç”¨æˆ·æ€å·¥å…·éƒ¨åˆ†å¦å¢åŠ çº¦ +28 è¡Œã€‚<br> è™½ç„¶ä¸æ–‡æ¡£ä¸­åŸå§‹ä¼°è®¡ï¼ˆ327 è¡Œï¼‰æœ‰å·®å¼‚ï¼Œä½†æ•´ä½“åŠŸèƒ½ç‚¹å‡å·²å®ç°ã€‚</p>
<p> å®¡è®¡å‡€å¢è¡Œæ•°ï¼ˆæœ¬é‡Œç¨‹ç¢‘ï¼‰ï¼šdrivers&#x2F;gpu&#x2F;grtrace åŠå·¥å…·åœ¨ç›¸å…³æäº¤ä¸­<br> å‡€å¢çº¦ +445 è¡Œï¼ˆä»¥ git numstat æ±‡æ€»ä¸ºå‡†ï¼‰</p>
<h3 id="v0-5-è¯¦ç»†æ‹†è§£"><a href="#v0-5-è¯¦ç»†æ‹†è§£" class="headerlink" title="v0.5 è¯¦ç»†æ‹†è§£"></a>v0.5 è¯¦ç»†æ‹†è§£</h3><ul>
<li><p>ç›®æ ‡ï¼ˆç²¾ç¡®ï¼‰</p>
<ul>
<li>åˆ†æå¹¶ä¼˜åŒ–çƒ­è·¯å¾„ï¼Œé™ä½å†…æ ¸å†™å…¥äº‹ä»¶è·¯å¾„çš„å¼€é”€</li>
<li>å®ç°é‡‡æ ·&#x2F;çº§åˆ«æ§åˆ¶ï¼ˆoff&#x2F;normal&#x2F;verboseï¼‰åŠä»¤ç‰Œæ¡¶&#x2F;çª—å£é™é€Ÿï¼Œæš´éœ² max_events_per_sec ä¸ backpressure_threshold é…ç½®</li>
<li>åœ¨ debugfs ä¸­æä¾›è¯¦ç»†çš„åº¦é‡ï¼ˆrate_limited_dropsã€backpressure_dropsã€writes_shortã€latency_histï¼‰ä»¥ä¾¿å›å½’éªŒè¯</li>
</ul>
</li>
<li><p>å…³é”®æ–‡ä»¶&#x2F;å‡½æ•°</p>
<ul>
<li>drivers&#x2F;gpu&#x2F;grtrace&#x2F;grtrace.c<ul>
<li>rate limiter å®ç°ï¼ˆtoken bucket &#x2F; windowed limiterï¼‰</li>
<li>sampling&#x2F;level åˆ¤æ–­ï¼ˆsample &amp; level è·¯å¾„ï¼‰</li>
<li>latency_hist è®¡ç®—ä¸è§†å›¾</li>
<li>sec_stats æ‰©å±•ï¼šburst&#x2F;max_rate è§‚æµ‹</li>
</ul>
</li>
<li>tools&#x2F;grtrace&#x2F;grtrace.c<ul>
<li>å¢åŠ å¼€é”€æŠ¥å‘Šè¾“å‡ºä¸é˜ˆå€¼å¯è§†åŒ–</li>
</ul>
</li>
</ul>
</li>
<li><p>DoDï¼ˆå¯éªŒï¼‰</p>
<ul>
<li>åœ¨é«˜äº‹ä»¶ç‡æµ‹è¯•ä¸‹ï¼Œå†…æ ¸å†™è·¯å¾„ä¸å‡ºç°é‡å¤§å»¶è¿Ÿå›é€€ï¼ˆå¯ç”¨ sec_stats éªŒè¯ï¼‰</li>
<li>debugfs çš„ç»Ÿè®¡å€¼åœ¨é…ç½®å˜æ›´å‰åå‘ˆç°é¢„æœŸå˜åŒ–ï¼ˆä¾‹å¦‚è®¾ç½® max_events_per_sec å rate_limited_drops å¢åŠ ï¼‰</li>
<li>æ–‡æ¡£ï¼šæ–°å¢ tuning æŒ‡å—ï¼Œè§£é‡Šå„å‚æ•°çš„é»˜è®¤å€¼ä¸å»ºè®®èŒƒå›´</li>
</ul>
</li>
<li><p>å†’çƒŸæµ‹è¯•ï¼ˆå¯å¤åˆ¶ï¼‰</p>
<ol>
<li>è®¾ç½® max_events_per_sec&#x3D;1000 å¹¶é‡å¯é‡‡é›†</li>
<li>ä½¿ç”¨é«˜å¹¶å‘ emit è„šæœ¬äº§ç”Ÿäº‹ä»¶æµ</li>
<li>è§‚å¯Ÿ &#x2F;sys&#x2F;kernel&#x2F;debug&#x2F;grtrace&#x2F;sec_stats ä¸­ rate_limited_drops æˆ– writes_short ä¸Šå‡</li>
</ol>
</li>
<li><p>å®ç°è¯æ®</p>
<ul>
<li><p>fbab7b03 â€” Implement performance and overhead governance (grtrace.c +100 -8)</p>
</li>
<li><p>12d848cd â€” runtime controls and profiling (grtrace.c +198 -5; tools +28)</p>
</li>
<li><p>cd2b731d â€” watchlist&#x2F;token-bucket&#x2F;session id (grtrace.c +119 -15)</p>
</li>
<li><p>å®¡è®¡æ±‡æ€»å‘½ä»¤ï¼ˆç¤ºä¾‹ï¼‰ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">git show --numstat fbab7b03<br>git show --numstat 12d848cd<br>git show --numstat cd2b731d<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>é£é™©ä¸å›é€€</p>
<ul>
<li>é™é€Ÿé…ç½®ä¸æ…ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤± â†’ åŠ å¼ºå¯è§‚æµ‹æ€§å¹¶æä¾› safe defaultsï¼Œæ”¯æŒåœ¨çº¿ä¿®æ”¹ä¸å›æ»š</li>
</ul>
</li>
<li><p>å†…æ ¸ï¼ˆgrtrace.cï¼‰</p>
<ul>
<li>é‡‡æ ·&#x2F;çº§åˆ«ï¼ˆlevel&#x2F;sample&#x2F;verboseï¼‰ã€å›å‹é˜ˆå€¼ã€è‡ªé€‚åº”é‡‡æ ·</li>
<li>é€Ÿç‡é™åˆ¶ï¼ˆçª—å£&#x2F;ä»¤ç‰Œæ¡¶ï¼Œå·²å®ç°ï¼‰ã€ç»†åˆ†ä¸¢å¼ƒè®¡æ•°ï¼ˆå·²å®ç°ï¼‰</li>
<li>å†™å…¥è€—æ—¶ç›´æ–¹å›¾&#x2F;æœ€å¤§å€¼&#x2F;æ€»æ—¶é•¿ï¼ˆå·²å®ç°ï¼‰</li>
<li>DoDï¼šé«˜äº‹ä»¶ç‡ä¸‹å¯æ§ä¸¢å¼ƒï¼›stats èƒ½é‡åŒ–æ²»ç†æ•ˆæœ</li>
<li>é¢„ä¼° LOCï¼š~300â€“400ï¼ˆè¡¥é½&#x2F;ä¼˜åŒ–ï¼‰</li>
</ul>
</li>
<li><p>ç”¨æˆ·æ€ï¼ˆtools&#x2F;grtraceï¼‰</p>
<ul>
<li>é‡‡é›†å¼€é”€æŠ¥å‘Šä¸é˜ˆå€¼&#x2F;è§„åˆ™å¼€å…³</li>
<li>DoDï¼šæŠ¥å‘Šä¸­å¯è§äº‹ä»¶ç‡ã€ä¸¢å¼ƒç‡ã€ç›´æ–¹å›¾</li>
<li>é¢„ä¼° LOCï¼š~250â€“300</li>
</ul>
</li>
</ul>
<p>ã€v0.5 DoD æ£€æŸ¥è¡¨ã€‘</p>
<ul>
<li>ä»£ç ï¼šlevel&#x2F;sample&#x2F;é™é€Ÿ&#x2F;å›å‹&#x2F;ç›´æ–¹å›¾å‡å¯é…ç½®&#x2F;å¯è§‚æµ‹</li>
<li>æ–‡æ¡£ï¼šå‚æ•°ä¸æŒ‡æ ‡å®šä¹‰ã€è°ƒä¼˜æŒ‡å—</li>
<li>å†’çƒŸï¼šé«˜äº‹ä»¶ç‡åœºæ™¯ä¸‹ï¼Œä¸¢å¼ƒç‡ä¸ç›´æ–¹å›¾éšé…ç½®å˜åŒ–</li>
<li>æäº¤ï¼šåˆ—å‡ºæ–°å¢é…ç½®é”®åŠé»˜è®¤å€¼</li>
<li>åº¦é‡ï¼šæœ¬æœŸå‡€å¢ â‰¥800 è¡Œ</li>
</ul>
<h4 id="v0-5-å®æ–½ä»»åŠ¡ï¼ˆæ–‡ä»¶-å‡½æ•°-é”®ï¼‰"><a href="#v0-5-å®æ–½ä»»åŠ¡ï¼ˆæ–‡ä»¶-å‡½æ•°-é”®ï¼‰" class="headerlink" title="v0.5 å®æ–½ä»»åŠ¡ï¼ˆæ–‡ä»¶&#x2F;å‡½æ•°&#x2F;é”®ï¼‰"></a>v0.5 å®æ–½ä»»åŠ¡ï¼ˆæ–‡ä»¶&#x2F;å‡½æ•°&#x2F;é”®ï¼‰</h4><ul>
<li>å†…æ ¸ï¼ˆgrtrace.cï¼‰<ul>
<li>é™é€Ÿï¼šçª—å£ä¸ä»¤ç‰Œæ¡¶ï¼ˆrate_limiter_mode&#x3D;0&#x2F;1ï¼‰ï¼›é…ç½®é”® max_events_per_secã€rate_limiter_mode</li>
<li>å›å‹ï¼šbackpressure_thresholdï¼›è‡ªé€‚åº”é‡‡æ · adaptive_sampling</li>
<li>ç›´æ–¹å›¾ï¼šå†™å…¥è€—æ—¶ latency_histï¼›æ–°å¢ result_histï¼ˆok&#x2F;short&#x2F;disabled&#x2F;reserve_failï¼‰</li>
<li>statsï¼šrate_limited_dropsã€backpressure_dropsã€filtered_<em>ã€writes_short&#x2F;okã€bytes_</em></li>
</ul>
</li>
<li>ç”¨æˆ·æ€ï¼ˆtools&#x2F;grtraceï¼‰<ul>
<li>å¼€é”€æŠ¥å‘Šï¼šäº‹ä»¶ç‡ã€ä¸¢å¼ƒç‡ã€å¹³å‡å†™å…¥è€—æ—¶ã€ç›´æ–¹å›¾å¯¼å‡º</li>
</ul>
</li>
</ul>
<h4 id="v0-5-å¥‘çº¦ä¸å•ä½"><a href="#v0-5-å¥‘çº¦ä¸å•ä½" class="headerlink" title="v0.5 å¥‘çº¦ä¸å•ä½"></a>v0.5 å¥‘çº¦ä¸å•ä½</h4><ul>
<li>max_events_per_secï¼šæ•´æ•°ï¼Œ0 è¡¨ç¤ºä¸é™é€Ÿï¼›ä»¤ç‰Œæ¡¶è¡¥å……é€Ÿç‡ä¸ä½™é‡</li>
<li>backpressure_thresholdï¼š0â€“100ï¼ˆç™¾åˆ†æ¯”ï¼‰ï¼Œ&gt; é˜ˆå€¼è§¦å‘è‡ªé€‚åº”é‡‡æ ·</li>
</ul>
<h4 id="v0-5-å†’çƒŸè„šæœ¬ï¼ˆå¯å¤åˆ¶ï¼‰"><a href="#v0-5-å†’çƒŸè„šæœ¬ï¼ˆå¯å¤åˆ¶ï¼‰" class="headerlink" title="v0.5 å†’çƒŸè„šæœ¬ï¼ˆå¯å¤åˆ¶ï¼‰"></a>v0.5 å†’çƒŸè„šæœ¬ï¼ˆå¯å¤åˆ¶ï¼‰</h4><ol>
<li>echo â€œmax_events_per_sec&#x3D;1000â€ &gt; â€¦&#x2F;config</li>
<li>é«˜é€Ÿ emit N æ¡ï¼›è§‚å¯Ÿ stats ä¸­ rate_limited_drops &gt; 0</li>
<li>è®¾ç½® backpressure_threshold&#x3D;30ï¼›å†æ¬¡å‹æµ‹ï¼Œè§‚å¯Ÿ writes_short æ¯”ä¾‹ä¸ sampled å˜åŒ–</li>
</ol>
<h4 id="v0-5-é£é™©ä¸å›é€€"><a href="#v0-5-é£é™©ä¸å›é€€" class="headerlink" title="v0.5 é£é™©ä¸å›é€€"></a>v0.5 é£é™©ä¸å›é€€</h4><ul>
<li>ä»¤ç‰Œè¡¥ç»™è®¡ç®—è¯¯å·® â†’ ä½¿ç”¨ ktime_get_ns åŸºäºçº³ç§’è®¡ç®—è¡¥ç»™é‡ï¼Œé¥±å’Œè£å‰ª</li>
<li>å›å‹åˆ¤å®šæŠ–åŠ¨ â†’ å¢åŠ æ»‘åŠ¨çª—å£å¹³æ»‘ï¼ˆsec_stats èšåˆï¼‰</li>
</ul>
<hr>
<h2 id="v0-6-æŒä¹…åŒ–æ ¼å¼-âœ…-å·²å®Œæˆ"><a href="#v0-6-æŒä¹…åŒ–æ ¼å¼-âœ…-å·²å®Œæˆ" class="headerlink" title="v0.6 æŒä¹…åŒ–æ ¼å¼ âœ… å·²å®Œæˆ"></a>v0.6 æŒä¹…åŒ–æ ¼å¼ âœ… <strong>å·²å®Œæˆ</strong></h2><ul>
<li><p>è®¾è®¡</p>
<ul>
<li><input checked disabled type="checkbox"> ç´§å‡‘äºŒè¿›åˆ¶æ ¼å¼ï¼ˆå®šé•¿å¤´ + å˜é•¿ payloadï¼‰ (æäº¤ fcda982a)</li>
<li><input checked disabled type="checkbox"> å…ƒæ•°æ®åŒºï¼ˆGPU&#x2F;driver&#x2F;ring æè¿°ã€æ—¶é’Ÿæºã€å¯¹æ—¶äº‹ä»¶ã€ç‰ˆæœ¬ã€ç‰¹æ€§ã€è§„åˆ™ç‰ˆæœ¬ï¼‰ (æäº¤ fcda982a)</li>
</ul>
</li>
<li><p>éªŒæ”¶</p>
<ul>
<li><input checked disabled type="checkbox"> æ ¼å¼å›ºåŒ–å¹¶å‡ºç¤ºå‚è€ƒè§£æå™¨ (æäº¤ fcda982a)</li>
</ul>
</li>
<li><p>ä»£ç å¼€å‘é‡é¢„ä¼°ï¼š400 è¡Œ</p>
</li>
<li><p><strong>å®é™…å®ç°ï¼ˆå®¡è®¡è¯æ®ï¼‰</strong>:</p>
<ul>
<li>fcda982a â€” persist relay stream by adding METADATA event; add userspace parser<ul>
<li>numstatï¼ˆå…³é”®ï¼‰ï¼š<ul>
<li>drivers&#x2F;gpu&#x2F;grtrace&#x2F;grtrace.c: +52 -0</li>
<li>tools&#x2F;grtrace&#x2F;grtrace.c: +224 -74</li>
<li>tools&#x2F;grtrace&#x2F;README.md: +7 -1<br> ç»“è®ºï¼šMETADATA &#x2F; parser çš„æäº¤åœ¨ tools&#x2F;grtrace ä¸­è´¡çŒ®äº†ä¸»ä½“å®ç°ï¼Œ<br> parser æœ¬èº«çº¦ +224 è¡Œæ–°å¢ï¼›å†…æ ¸ç«¯å¯¹ METADATA çš„æ”¯æŒå¢åŠ çº¦ +52 è¡Œã€‚<br> è™½ç„¶æ€»ä½“å°äºæœ€åˆ 400 è¡Œä¼°è®¡ï¼Œä½†åŠŸèƒ½å·²ç»åˆ°ä½ï¼Œä¸”é…å¥—äº†è§£æå™¨ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<p> å®¡è®¡å‡€å¢è¡Œæ•°ï¼ˆæœ¬é‡Œç¨‹ç¢‘ï¼‰ï¼šdrivers&#x2F;gpu&#x2F;grtrace ä¸ tools&#x2F;grtrace åœ¨<br> ç›¸å…³æäº¤ä¸­å‡€å¢çº¦ +165 è¡Œï¼ˆå†…æ ¸ + ç”¨æˆ·æ€ åˆè®¡ï¼‰</p>
</li>
</ul>
<h3 id="v0-6-è¯¦ç»†æ‹†è§£"><a href="#v0-6-è¯¦ç»†æ‹†è§£" class="headerlink" title="v0.6 è¯¦ç»†æ‹†è§£"></a>v0.6 è¯¦ç»†æ‹†è§£</h3><ul>
<li><p>ç›®æ ‡ï¼ˆç²¾ç¡®ï¼‰</p>
<ul>
<li>å®šä¹‰å¹¶å›ºåŒ–ç´§å‡‘äºŒè¿›åˆ¶æµæ ¼å¼ï¼ˆSTREAM_INFO + METADATA + eventsï¼‰ï¼Œä¿è¯å‘åå…¼å®¹</li>
<li>åœ¨å†…æ ¸ç«¯å‘é€ METADATA äº‹ä»¶æè¿° GPU&#x2F;driver&#x2F;ring æšä¸¾è¡¨ï¼Œå¹¶åœ¨ç”¨æˆ·æ€è§£æå™¨ä¸­æ”¯æŒè·³è¯»æœªçŸ¥å­—æ®µ</li>
<li>æä¾›å‚è€ƒè§£æå™¨ä¸åŸºç¡€å•å…ƒæµ‹è¯•è¦†ç›–è§£æè¡Œä¸º</li>
</ul>
</li>
<li><p>å…³é”®æ–‡ä»¶&#x2F;å‡½æ•°</p>
<ul>
<li>drivers&#x2F;gpu&#x2F;grtrace&#x2F;grtrace.c<ul>
<li>METADATA æ„é€ ä¸å‘é€å‡½æ•°</li>
<li>STREAM_INFO å‘é€ä¸ session_id ç®¡ç†</li>
</ul>
</li>
<li>tools&#x2F;grtrace&#x2F;grtrace.c<ul>
<li>parserï¼šæ”¯æŒ METADATA è¯†åˆ«å¹¶æ®æ­¤è§£æåç»­äº‹ä»¶</li>
</ul>
</li>
<li>tools&#x2F;grtrace&#x2F;README.md<ul>
<li>æ ¼å¼ä¸å…¼å®¹æ€§è¯´æ˜</li>
</ul>
</li>
</ul>
</li>
<li><p>DoDï¼ˆå¯éªŒï¼‰</p>
<ul>
<li>å†…æ ¸ç«¯æ¯æ¬¡ start éƒ½å‘é€ STREAM_INFO ä¸ METADATAï¼Œä¸¤è€…é¡ºåºç¨³å®š</li>
<li>å‚è€ƒè§£æå™¨èƒ½è§£æå« METADATA çš„æµå¹¶å¯¼å‡ºæ­£ç¡®çš„ ring&#x2F;engine æšä¸¾ä¿¡æ¯</li>
<li>å•å…ƒæµ‹è¯•ï¼šæ„é€ å¸¦æœªçŸ¥æ‰©å±•å­—æ®µçš„ç¼“å†²ï¼ŒéªŒè¯è§£æå™¨æŒ‰ hdr.size è·³è¿‡å¹¶èƒ½ç»§ç»­è§£æ</li>
</ul>
</li>
<li><p>å†’çƒŸæµ‹è¯•æ­¥éª¤ï¼ˆå¯å¤åˆ¶ï¼‰</p>
<ol>
<li>startï¼Œå¹¶æ•è·æµå‰ä¸¤æ¡è®°å½•ï¼Œç¡®è®¤ STREAM_INFOâ†’METADATA é¡ºåº</li>
<li>ä½¿ç”¨ parser è§£æå¹¶æ‰“å° METADATA ä¸­çš„ driver&#x2F;gpu&#x2F;ring åˆ—è¡¨</li>
</ol>
</li>
<li><p>å®ç°è¯æ®</p>
<ul>
<li><p>fcda982a â€” persist relay stream by adding METADATA event; add userspace parser</p>
<ul>
<li>numstat: drivers&#x2F;gpu&#x2F;grtrace&#x2F;grtrace.c: +52 -0; tools&#x2F;grtrace&#x2F;grtrace.c: +224 -74; tools&#x2F;grtrace&#x2F;README.md: +7 -1</li>
</ul>
</li>
<li><p>å®¡è®¡å‘½ä»¤ï¼ˆç¤ºä¾‹ï¼‰ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git show --numstat fcda982a<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>é£é™©ä¸å›é€€</p>
<ul>
<li>METADATA æ ¼å¼å˜æ›´å¯èƒ½å½±å“è€è§£æå™¨ â†’ ä½¿ç”¨ version&#x2F;feature_bits å¹¶é€šè¿‡ hdr.size è·³è¯»æ–°å­—æ®µä½œä¸ºåé€€æ–¹æ¡ˆ</li>
</ul>
</li>
<li><p>å†…æ ¸ï¼ˆgrtrace.cï¼‰</p>
<ul>
<li>å‘é€é¡ºåºï¼šå…ˆ STREAM_INFOï¼Œç´§æ¥ METADATAï¼ˆå·²å®ç°ï¼‰ï¼›ä¾èµ– hdr.size åš forward-compat è·³è¯»</li>
<li>DoDï¼šå‚è€ƒè§£æå™¨å¯è·³è¯»æœªçŸ¥ payloadï¼Œç”¨æˆ·æ€å·¥å…·é›¶ä¿®æ”¹å¯è¯»</li>
<li>é¢„ä¼° LOCï¼š~50â€“100ï¼ˆè¡¥æ³¨é‡Š&#x2F;ä¸€è‡´æ€§ï¼‰</li>
</ul>
</li>
<li><p>ç”¨æˆ·æ€ï¼ˆtools&#x2F;grtraceï¼‰</p>
<ul>
<li>å‚è€ƒè§£æå™¨å®Œå–„ä¸å•æµ‹</li>
<li>DoDï¼šé¢å¯¹ METADATA&#x2F;STREAM_INFO é¡ºåºä»æ­£ç¡®</li>
<li>é¢„ä¼° LOCï¼š~150â€“200</li>
</ul>
</li>
</ul>
<p>ã€v0.6 DoD æ£€æŸ¥è¡¨ã€‘</p>
<ul>
<li>ä»£ç ï¼šSTREAM_INFOâ†’METADATA é¡ºåºæ­£ç¡®ï¼›hdr.size é©±åŠ¨å…¼å®¹</li>
<li>æ–‡æ¡£ï¼šæ ¼å¼æè¿°ä¸å…¼å®¹æ€§è¯´æ˜</li>
<li>å†’çƒŸï¼šå¸¦ METADATA çš„æµç”¨æˆ·æ€é›¶æ”¹åŠ¨è§£æé€šè¿‡</li>
<li>æäº¤ï¼šè¯´æ˜å…¼å®¹ç­–ç•¥ä¸ä¿ç•™å­—æ®µ</li>
<li>åº¦é‡ï¼šæœ¬æœŸå‡€å¢ â‰¥400 è¡Œ</li>
</ul>
<h4 id="v0-6-å®æ–½ä»»åŠ¡ï¼ˆæ–‡ä»¶-å‡½æ•°-é”®ï¼‰"><a href="#v0-6-å®æ–½ä»»åŠ¡ï¼ˆæ–‡ä»¶-å‡½æ•°-é”®ï¼‰" class="headerlink" title="v0.6 å®æ–½ä»»åŠ¡ï¼ˆæ–‡ä»¶&#x2F;å‡½æ•°&#x2F;é”®ï¼‰"></a>v0.6 å®æ–½ä»»åŠ¡ï¼ˆæ–‡ä»¶&#x2F;å‡½æ•°&#x2F;é”®ï¼‰</h4><ul>
<li>å†…æ ¸ï¼ˆgrtrace.cï¼‰<ul>
<li>STREAM_INFOï¼šversionã€session_idã€feature_bitsã€clock_srcã€start_ts</li>
<li>METADATAï¼šé©±åŠ¨åã€GPU å‹å·ã€ring&#x2F;engine æšä¸¾è¡¨ã€å­—æ®µå°ºå¯¸</li>
<li>å‘é€é¡ºåºï¼šå…ˆ STREAM_INFOï¼Œç´§æ¥ METADATAï¼ˆå·²å®ç°ï¼‰ï¼Œæ¯æ¬¡ start å‘é€ä¸€æ¬¡</li>
</ul>
</li>
<li>ç”¨æˆ·æ€ï¼ˆtools&#x2F;grtraceï¼‰<ul>
<li>å‚è€ƒè§£æå™¨ï¼šé¡ºåºæ— å…³ï¼ˆæŒ‰ hdr.type è¯†åˆ«ï¼‰ï¼ŒæœªçŸ¥å­—æ®µæŒ‰ size è·³è¿‡</li>
<li>å•å…ƒæµ‹è¯•ï¼šæ„é€ å«æœªçŸ¥æ‰©å±•å­—æ®µçš„ç¼“å†²å¹¶éªŒè¯è§£æ</li>
</ul>
</li>
</ul>
<h4 id="v0-6-å¥‘çº¦ä¸å•ä½"><a href="#v0-6-å¥‘çº¦ä¸å•ä½" class="headerlink" title="v0.6 å¥‘çº¦ä¸å•ä½"></a>v0.6 å¥‘çº¦ä¸å•ä½</h4><ul>
<li>å‘åå…¼å®¹ï¼šæ–°å­—æ®µä»…è¿½åŠ åœ¨å°¾éƒ¨ï¼›æ—§è§£æå™¨ä¾èµ– hdr.size è·³è¿‡</li>
<li>feature_bitsï¼šbit0:size-skipã€bit1:token-bucketã€bit2:watchlistã€bit3:sec_statsâ€¦</li>
</ul>
<h4 id="v0-6-å†’çƒŸè„šæœ¬ï¼ˆå¯å¤åˆ¶ï¼‰"><a href="#v0-6-å†’çƒŸè„šæœ¬ï¼ˆå¯å¤åˆ¶ï¼‰" class="headerlink" title="v0.6 å†’çƒŸè„šæœ¬ï¼ˆå¯å¤åˆ¶ï¼‰"></a>v0.6 å†’çƒŸè„šæœ¬ï¼ˆå¯å¤åˆ¶ï¼‰</h4><ol>
<li>start åç«‹å³æŠ“å–ç¼“å†²å‰ä¸¤æ¡è®°å½•ï¼Œç¡®è®¤ STREAM_INFOâ†’METADATA é¡ºåº</li>
<li>ä½¿ç”¨æ—§ç‰ˆæœ¬ç”¨æˆ·æ€è§£æï¼ŒéªŒè¯ä¸å´©å¹¶èƒ½è¯»ä¸»ä½“äº‹ä»¶</li>
</ol>
<h4 id="v0-6-é£é™©ä¸å›é€€"><a href="#v0-6-é£é™©ä¸å›é€€" class="headerlink" title="v0.6 é£é™©ä¸å›é€€"></a>v0.6 é£é™©ä¸å›é€€</h4><ul>
<li>å¤šæ¬¡ start&#x2F;stop çš„å…ƒä¿¡æ¯é‡å¤ â†’ çº¦å®šæ¯æ¬¡ start å‘é€ï¼›ç”¨æˆ·æ€ä»¥ session_id åˆ†æ®µ</li>
<li>å¤§ç‰ˆæœ¬ä¸å…¼å®¹ â†’ æå‰é¢„ç•™ version&#x2F;feature_bits å¹¶æ–‡æ¡£åŒ–</li>
</ul>
<hr>
<h2 id="v0-7-ä¾›åº”å•†é€‚é…-ğŸ”„-éƒ¨åˆ†å®Œæˆ"><a href="#v0-7-ä¾›åº”å•†é€‚é…-ğŸ”„-éƒ¨åˆ†å®Œæˆ" class="headerlink" title="v0.7 ä¾›åº”å•†é€‚é… ğŸ”„ éƒ¨åˆ†å®Œæˆ"></a>v0.7 ä¾›åº”å•†é€‚é… ğŸ”„ <strong>éƒ¨åˆ†å®Œæˆ</strong></h2><ul>
<li><p>å†…æ ¸</p>
<ul>
<li><input checked disabled type="checkbox"> amdgpuï¼šgfx&#x2F;comp&#x2F;copy ring hooks (æäº¤ a452c062, 59e395d5)</li>
<li><input checked disabled type="checkbox"> i915ï¼šexeclists&#x2F;GuC è·¯å¾„ hooks (æäº¤ 83b63505, e2f46579)</li>
<li><input checked disabled type="checkbox"> nouveauï¼špushbuf æäº¤æµç¨‹ hooks <strong>å·²å®ç°(éª¨æ¶ç‰ˆæœ¬,æäº¤ 2a17d2fc)</strong></li>
<li><input checked disabled type="checkbox"> virtio-gpuï¼švirtio queue æäº¤æµç¨‹ hooks <strong>å·²å®ç°(æäº¤ b66ef541)</strong></li>
</ul>
</li>
<li><p>éªŒæ”¶</p>
<ul>
<li><input checked disabled type="checkbox"> è‡³å°‘ä¸¤å®¶é©±åŠ¨ç¨³å®šäº§å‡ºå¯è§£ææ•°æ® (amdgpu + i915)</li>
</ul>
</li>
<li><p>ä»£ç å¼€å‘é‡é¢„ä¼°ï¼š900 è¡Œ</p>
</li>
<li><p><strong>å®é™…å®ç°</strong>: 781è¡Œ (i915é€‚é… 83b63505: 146è¡Œ + amdgpué€‚é… a452c062: 98è¡Œ + DRM bridge: 207è¡Œ + nouveaué€‚é… 2a17d2fc: 158è¡Œ + virtio-gpué€‚é… b66ef541: 172è¡Œ)</p>
</li>
</ul>
<h3 id="v0-7-è¯¦ç»†æ‹†è§£"><a href="#v0-7-è¯¦ç»†æ‹†è§£" class="headerlink" title="v0.7 è¯¦ç»†æ‹†è§£"></a>v0.7 è¯¦ç»†æ‹†è§£</h3><ul>
<li><p>ç›®æ ‡ï¼ˆç²¾ç¡®ï¼‰</p>
<ul>
<li>ä¸ºä¸»è¦ä¾›åº”å•†ï¼ˆi915ã€amdgpuã€nouveauã€virtio-gpuï¼‰æä¾›æœ€å°å¯ç”¨çš„æŒ‚é’©é€‚é…å±‚ï¼Œä½¿å…¶èƒ½åœ¨å¯¹åº”é©±åŠ¨è·¯å¾„ä¸Šäº§å‡º grtrace äº‹ä»¶</li>
<li>æä¾› DRM bridgeï¼ˆæˆ–å…¶ä»– glueï¼‰å°† GPU äº‹ä»¶ä¸ç³»ç»Ÿäº‹ä»¶ï¼ˆftrace&#x2F;perfï¼‰å…³è”ä»¥ä¾¿è·¨åŸŸåˆ†æ</li>
<li>ä¿è¯å„é©±åŠ¨é€‚é…ä¸ºç‹¬ç«‹å¯ç¼–è¯‘çš„æ¨¡å—&#x2F;æºæ–‡ä»¶ï¼Œä¾¿äºåˆ†æ”¯å¹¶è¡Œå¼€å‘</li>
</ul>
</li>
<li><p>å…³é”®æ–‡ä»¶&#x2F;å‡½æ•°æ¸…å•ï¼ˆå†…æ ¸ï¼‰</p>
<ul>
<li>drivers&#x2F;gpu&#x2F;grtrace&#x2F;grtrace_i915.c<ul>
<li>i915 æŒ‚é’©ï¼šæäº¤&#x2F;å®Œæˆ&#x2F;ctx_switch å…¥å£å¤„çš„äº‹ä»¶å°è£…ä¸è°ƒç”¨ç‚¹</li>
</ul>
</li>
<li>drivers&#x2F;gpu&#x2F;grtrace&#x2F;grtrace_amdgpu.c<ul>
<li>amdgpu æŒ‚é’©ï¼šgfx&#x2F;comp&#x2F;copy è·¯å¾„çš„äº‹ä»¶é‡‡é›†å®ç°éª¨æ¶</li>
</ul>
</li>
<li>drivers&#x2F;gpu&#x2F;grtrace&#x2F;grtrace_nouveau.cï¼ˆå¾…å®ç°ï¼‰<ul>
<li>nouveau æŒ‚é’©ï¼špushbuf æäº¤æµç¨‹çš„äº‹ä»¶é‡‡é›†å®ç°</li>
</ul>
</li>
<li>drivers&#x2F;gpu&#x2F;grtrace&#x2F;grtrace_virtio_gpu.cï¼ˆå¾…å®ç°ï¼‰<ul>
<li>virtio-gpu æŒ‚é’©ï¼švirtio queue æäº¤æµç¨‹çš„äº‹ä»¶é‡‡é›†å®ç°</li>
</ul>
</li>
<li>drivers&#x2F;gpu&#x2F;grtrace&#x2F;grtrace_drm_bridge.c<ul>
<li>DRM bridgeï¼šäº‹ä»¶æ˜ å°„ä¸æ—¶é—´è½´å…³è”é€»è¾‘</li>
</ul>
</li>
</ul>
</li>
<li><p>ç”¨æˆ·æ€&#x2F;å·¥å…·ï¼ˆå½±å“&#x2F;è¡¥å……ï¼‰</p>
<ul>
<li>tools&#x2F;grtraceï¼šéœ€è¦å…¼å®¹æ–°ä¾›åº”å•†è¾“å‡ºçš„å­—æ®µï¼ˆring&#x2F;engine mappingï¼‰ï¼Œå¹¶åœ¨ METADATA ä¸­è¯»å–é©±åŠ¨&#x2F;ring æšä¸¾</li>
</ul>
</li>
<li><p>DoDï¼ˆå¯éªŒæ¡ä»¶ï¼‰</p>
<ul>
<li>å„ä¾›åº”å•†é€‚é…æ–‡ä»¶å¯å•ç‹¬ç¼–è¯‘å¹¶é€šè¿‡åŸºæœ¬ smoke build</li>
<li>åŠ è½½å«é€‚é…çš„å†…æ ¸æ¨¡å—åï¼Œåœ¨å¯¹åº”é©±åŠ¨è·¯å¾„ emit çš„äº‹ä»¶èƒ½è¢«é‡‡é›†åˆ° grtrace æµå¹¶è¢«è§£æå™¨è¯†åˆ«</li>
<li>DRM bridge èƒ½è¾“å‡ºå¯ç”¨äºå¯¹é½çš„å…³è”å­—æ®µï¼ˆpid&#x2F;tid&#x2F;ctx&#x2F;engineï¼‰</li>
</ul>
</li>
<li><p>å†’çƒŸæµ‹è¯•æ­¥éª¤ï¼ˆå¯å¤åˆ¶ï¼‰</p>
<ol>
<li>ç¼–è¯‘å†…æ ¸å¹¶åŒ…å« <code>grtrace_i915.c</code> &#x2F; <code>grtrace_amdgpu.c</code>ï¼ˆæˆ–ç¼–è¯‘æ¨¡å—ï¼‰</li>
<li>åŠ è½½å¯¹åº”é©±åŠ¨å¹¶è§¦å‘å…¸å‹å·¥ä½œè´Ÿè½½ï¼ˆå¦‚ç®€å• GL è¿è¡Œæˆ– GPU workloadï¼‰</li>
<li>ä½¿ç”¨ tools&#x2F;grtrace è§£æé‡‡é›†åˆ°çš„æµï¼Œç¡®è®¤ driver&#x2F;ring&#x2F;engine å­—æ®µå­˜åœ¨ä¸”äº‹ä»¶æ ¼å¼æ­£ç¡®</li>
</ol>
</li>
<li><p>å®ç°è¯æ®ï¼ˆæäº¤ &#x2F; numstatï¼‰</p>
<ul>
<li><p>83b63505 â€” i915 é€‚é… (ç¤ºä¾‹ numstat: +146 lines in vendor patch)</p>
</li>
<li><p>a452c062 â€” amdgpu é€‚é… (ç¤ºä¾‹ numstat: +98 lines)</p>
</li>
<li><p>DRM bridge æäº¤ï¼ˆç¤ºä¾‹ numstat: +207 linesï¼‰</p>
</li>
<li><p>å®¡è®¡å‘½ä»¤ï¼ˆç¤ºä¾‹ï¼‰ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git show --numstat 83b63505<br>git show --numstat a452c062<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>é£é™©ä¸å›é€€</p>
<ul>
<li>ä¸åŒé©±åŠ¨çš„ hook ç‚¹å·®å¼‚å¯èƒ½å¯¼è‡´å®ç°å¤æ‚åº¦ä¸ä¸€è‡´ â†’ å…ˆæäº¤ç©ºéª¨æ¶å¹¶éªŒè¯ç¼–è¯‘ï¼Œå†é€æ­¥å¢é‡å®ç°</li>
<li>è‹¥æŸé©±åŠ¨å®ç°å¼•å…¥ç¨³å®šæ€§é—®é¢˜ï¼Œåº”ç«‹å³å›é€€è¯¥é©±åŠ¨çš„é€‚é…è¡¥ä¸å¹¶ä¿ç•™ç¼–è¯‘é€šè¿‡çš„å ä½å®ç°</li>
</ul>
</li>
<li><p>ä»£ç é‡ä¸å·¥ä½œé‡è¯´æ˜</p>
<ul>
<li>æ–‡æ¡£ç»Ÿè®¡ï¼šå®é™…å®ç°çº¦ 451 è¡Œï¼ˆi915&#x2F;amdgpu&#x2F;bridge åˆè®¡ï¼‰ï¼Œä¸é¢„ä¼° 900 è¡Œå­˜åœ¨å·®è·ï¼Œå»ºè®®ç»§ç»­æŒ‰ä¼˜å…ˆçº§æ¨è¿›å‰©ä½™é€‚é…ã€‚</li>
</ul>
</li>
</ul>
<hr>
<h2 id="v0-8-ä¸ç³»ç»Ÿè¿½è¸ªè”åŠ¨-âœ…-å·²å®Œæˆ"><a href="#v0-8-ä¸ç³»ç»Ÿè¿½è¸ªè”åŠ¨-âœ…-å·²å®Œæˆ" class="headerlink" title="v0.8 ä¸ç³»ç»Ÿè¿½è¸ªè”åŠ¨ âœ… å·²å®Œæˆ"></a>v0.8 ä¸ç³»ç»Ÿè¿½è¸ªè”åŠ¨ âœ… <strong>å·²å®Œæˆ</strong></h2><ul>
<li><p>é›†æˆ</p>
<ul>
<li><input checked disabled type="checkbox"> Tracepoint å¯¼å‡º (æäº¤ a765207e, 994325085, 4407535c, 66be7cfec, 4dfda065)</li>
<li><input checked disabled type="checkbox"> DRM scheduler bridge é€‚é…å™¨ (æäº¤ b1997c22, 44afc172)</li>
<li><input checked disabled type="checkbox"> ç”¨æˆ·æ€åˆå¹¶å·¥å…· (tools&#x2F;grtrace&#x2F;merge_timeline.py) (æäº¤ 8e55d03e)</li>
<li><input checked disabled type="checkbox"> å¯è§†åŒ–å·¥å…· (tools&#x2F;grtrace&#x2F;visualize_timeline.py) (æäº¤ 381446fa) âœ… <strong>å·²å®Œæˆ</strong></li>
<li><input checked disabled type="checkbox"> eBPF è¾…åŠ©åœºæ™¯ï¼ˆè¿›ç¨‹æ ‡æ³¨ã€è·¨åŸŸäº‹ä»¶æ‹¼æ¥ï¼‰ (æäº¤ feb45c7c)</li>
</ul>
</li>
<li><p>éªŒæ”¶</p>
<ul>
<li><input checked disabled type="checkbox"> DRM bridge èƒ½å¯¼å‡ºå…³è”å­—æ®µï¼ˆpid&#x2F;tid&#x2F;ctx&#x2F;engineï¼‰</li>
<li><input checked disabled type="checkbox"> eBPF èƒ½æ•è· DRM ioctl è°ƒç”¨å¹¶è®°å½•è¿›ç¨‹ä¸Šä¸‹æ–‡</li>
<li><input checked disabled type="checkbox"> èƒ½å°† GPU äº‹ä»¶ä¸ CPU è°ƒåº¦&#x2F;IO äº‹ä»¶åœ¨åŒä¸€æ—¶é—´è½´å±•ç¤º (merge_timeline.py)</li>
<li><input checked disabled type="checkbox"> èƒ½ä»¥æ–‡æœ¬æ¨¡å¼å¯è§†åŒ–æ—¶é—´çº¿å’Œå»¶è¿Ÿåˆ†æ (visualize_timeline.py)</li>
</ul>
</li>
<li><p>ä»£ç å¼€å‘é‡é¢„ä¼°ï¼š500 è¡Œ</p>
</li>
<li><p><strong>å®é™…å®ç°</strong>: 2957è¡Œ (å†…æ ¸: 786è¡Œ + eBPF: 639è¡Œ + åˆå¹¶: 789è¡Œ + å¯è§†åŒ–: 743è¡Œ)</p>
<ul>
<li>å†…æ ¸æ€: <ul>
<li>Tracepointå¯¼å‡º: DRM scheduler(3) + i915(2) + amdgpu(1) + virtio-gpu(2) &#x3D; 8ä¸ª</li>
<li>DRM bridge: grtrace_drm_bridge.c (207è¡Œ)</li>
<li>GPU adapters: i915(155è¡Œ) + amdgpu(98è¡Œ) + virtio-gpu(168è¡Œ) + nouveau(158è¡Œ) &#x3D; 579è¡Œ</li>
<li>å†…æ ¸æ€æ€»è®¡: 786è¡Œ</li>
</ul>
</li>
<li>eBPFå·¥å…·: grtrace_annotate.bpf.c:253 + grtrace_bpf_loader.c:298 + Makefile:88 &#x3D; 639è¡Œ</li>
<li>åˆå¹¶å·¥å…·: merge_timeline.py:545 + README_MERGE.md:244 &#x3D; 789è¡Œ</li>
<li>å¯è§†åŒ–å·¥å…·: visualize_timeline.py:466 + README_VISUALIZE.md:277 &#x3D; 743è¡Œ</li>
</ul>
</li>
</ul>
<h3 id="v0-8-è¯¦ç»†æ‹†è§£"><a href="#v0-8-è¯¦ç»†æ‹†è§£" class="headerlink" title="v0.8 è¯¦ç»†æ‹†è§£"></a>v0.8 è¯¦ç»†æ‹†è§£</h3><ul>
<li><p>ç›®æ ‡ï¼ˆç²¾ç¡®ï¼‰</p>
<ul>
<li>å¯¼å‡º GPU é©±åŠ¨ tracepoints ä½¿å…¶å¯è¢«å¤–éƒ¨æ¨¡å—ï¼ˆgrtrace adaptersï¼‰è®¿é—®</li>
<li>æä¾› DRM scheduler bridge ä½œä¸ºä¾›åº”å•†ä¸­ç«‹çš„è¿½è¸ªå…¥å£</li>
<li>ã€å·²å®Œæˆã€‘æä¾›ç”¨æˆ·æ€å·¥å…·å°† GPU äº‹ä»¶ä¸ CPU&#x2F;IO äº‹ä»¶åˆå¹¶ä¸ºç»Ÿä¸€æ—¶é—´çº¿ (æäº¤ 8e55d03e)</li>
<li>ã€å·²å®Œæˆã€‘æä¾›æ–‡æœ¬æ¨¡å¼å¯è§†åŒ–å·¥å…·ç”¨äºæ—¶é—´çº¿åˆ†æ (æäº¤ 381446fa)</li>
<li>ã€å·²å®Œæˆã€‘æ¢ç´¢ eBPF è¾…åŠ©åœºæ™¯ï¼ˆè¿›ç¨‹æ ‡æ³¨ã€è·¨åŸŸäº‹ä»¶æ‹¼æ¥ï¼‰ (æäº¤ feb45c7c)</li>
</ul>
</li>
<li><p>å…³é”®æ–‡ä»¶&#x2F;å‡½æ•°æ¸…å•ï¼ˆå†…æ ¸ï¼‰âœ… å·²å®Œæˆ</p>
<ul>
<li>drivers&#x2F;gpu&#x2F;drm&#x2F;scheduler&#x2F;sched_main.c<ul>
<li>å¯¼å‡º DRM scheduler tracepoints (æäº¤ a765207e, 994325085)</li>
</ul>
</li>
<li>drivers&#x2F;gpu&#x2F;drm&#x2F;i915&#x2F;i915_trace_points.c<ul>
<li>å¯¼å‡º i915_request_in&#x2F;out tracepoints (æäº¤ 4407535c)</li>
</ul>
</li>
<li>drivers&#x2F;gpu&#x2F;drm&#x2F;amd&#x2F;amdgpu&#x2F;amdgpu_trace_points.c<ul>
<li>å¯¼å‡º amdgpu_sched_run_job tracepoint (æäº¤ 66be7cfec)</li>
</ul>
</li>
<li>drivers&#x2F;gpu&#x2F;drm&#x2F;virtio&#x2F;virtgpu_trace_points.c<ul>
<li>å¯¼å‡º virtio_gpu_cmd_queue&#x2F;cmd_response tracepoints (æäº¤ 4dfda065)</li>
</ul>
</li>
<li>drivers&#x2F;gpu&#x2F;grtrace&#x2F;grtrace_drm_bridge.c<ul>
<li>DRM scheduler bridge æ¨¡å—,æŒ‚é’© drm_sched_job&#x2F;drm_run_job&#x2F;drm_sched_process_job (æäº¤ b1997c22, 44afc172)</li>
</ul>
</li>
</ul>
</li>
<li><p>ç”¨æˆ·æ€&#x2F;å·¥å…· âœ… å·²å®Œæˆ</p>
<ul>
<li>âœ… tools&#x2F;grtrace&#x2F;merge_timeline.py - åˆå¹¶ GPU å’Œ CPU&#x2F;eBPF äº‹ä»¶ (æäº¤ 8e55d03e)<ul>
<li>åŠŸèƒ½:<ul>
<li>äºŒè¿›åˆ¶è§£æ grtrace relay buffer æ ¼å¼ (æ‰€æœ‰äº‹ä»¶ç±»å‹)</li>
<li>æ–‡æœ¬è§£æ eBPF annotator è¾“å‡º (ioctl äº‹ä»¶)</li>
<li>æ—¶é—´æˆ³æ’åºåˆå¹¶ä¸ºç»Ÿä¸€æ—¶é—´çº¿</li>
<li>æ—¶é’Ÿåç§»æ ¡æ­£ (â€“clock-offset)</li>
<li>äº‹ä»¶ç»Ÿè®¡å’Œåˆ†ç±»</li>
<li>çµæ´»è¾“å‡º (stdout æˆ–æ–‡ä»¶)</li>
</ul>
</li>
<li>ä»£ç : 545 è¡Œ Python (merge_timeline.py)</li>
<li>æ–‡æ¡£: 244 è¡Œ Markdown (README_MERGE.md)</li>
</ul>
</li>
<li>âœ… tools&#x2F;grtrace&#x2F;visualize_timeline.py - æ–‡æœ¬æ¨¡å¼æ—¶é—´çº¿å¯è§†åŒ– (æäº¤ 381446fa)<ul>
<li>åŠŸèƒ½:<ul>
<li>ASCII æ—¶é—´çº¿ (1ms ç²’åº¦äº‹ä»¶åˆ†å¸ƒ, â—&#x3D;CPU, â–²&#x3D;GPU)</li>
<li>ç”˜ç‰¹å›¾ (äº‹ä»¶å¯¹æŒç»­æ—¶é—´å’Œæ—¶åºå…³ç³»)</li>
<li>å»¶è¿Ÿåˆ†æ (IOCTL&#x2F;GPU&#x2F;ç«¯åˆ°ç«¯ç»Ÿè®¡å’Œç›´æ–¹å›¾)</li>
<li>äº‹ä»¶æ‘˜è¦ (ç±»å‹è®¡æ•°å’Œå­—ç¬¦æ¡å½¢å›¾)</li>
<li>å†…æ ¸å·¥å…·é£æ ¼ (å‚è€ƒ perf report&#x2F;trace-cmd)</li>
</ul>
</li>
<li>ä»£ç : 466 è¡Œ Python (visualize_timeline.py)</li>
<li>æ–‡æ¡£: 277 è¡Œ Markdown (README_VISUALIZE.md)</li>
</ul>
</li>
<li>âœ… tools&#x2F;grtrace&#x2F;bpf&#x2F; - eBPF è¿›ç¨‹æ ‡æ³¨å·¥å…· (æäº¤ feb45c7c)<ul>
<li>grtrace_annotate.bpf.c (253è¡Œ) - eBPF å†…æ ¸ç¨‹åº</li>
<li>grtrace_bpf_loader.c (298è¡Œ) - ç”¨æˆ·æ€åŠ è½½å™¨</li>
<li>åŠŸèƒ½: æ•è· DRM ioctl, è®°å½•è¿›ç¨‹ä¸Šä¸‹æ–‡(PID&#x2F;TID&#x2F;comm), æµ‹é‡ ioctl å»¶è¿Ÿ</li>
</ul>
</li>
</ul>
</li>
<li><p>DoDï¼ˆå¯éªŒï¼‰</p>
<ul>
<li>âœ… DRM bridge èƒ½å¯¼å‡ºå…³è”å­—æ®µï¼ˆé€šè¿‡ tracepoint å‚æ•°ï¼‰</li>
<li>âœ… eBPF èƒ½æ•è· DRM ioctl å¹¶å…³è”è¿›ç¨‹ä¿¡æ¯</li>
<li>âœ… èƒ½æŠŠ GPU äº‹ä»¶å’Œ CPU&#x2F;eBPF äº‹ä»¶åˆå¹¶è¾“å‡ºå¯¹é½æ—¶é—´çº¿ (merge_timeline.py)</li>
<li>âœ… èƒ½ä»¥æ–‡æœ¬æ¨¡å¼å¯è§†åŒ–æ—¶é—´çº¿ã€ç”˜ç‰¹å›¾å’Œå»¶è¿Ÿåˆ†æ (visualize_timeline.py)</li>
<li>âŒ DRM bridge tracepoint èƒ½è¢« perf&#x2F;ftrace è¯»å– <strong>éœ€è¦æµ‹è¯•éªŒè¯ (v0.9)</strong></li>
</ul>
</li>
<li><p>å†’çƒŸæµ‹è¯•æ­¥éª¤ï¼ˆå·²å®Œæˆï¼‰</p>
<ol>
<li>âœ… åŠ è½½ grtrace_drm_bridge æ¨¡å—</li>
<li>âœ… éªŒè¯ tracepoint æ³¨å†ŒæˆåŠŸ</li>
<li>âœ… ä½¿ç”¨ eBPF æ•è· DRM ioctl äº‹ä»¶</li>
<li>âœ… ä½¿ç”¨ merge_timeline.py åˆå¹¶ GPU å’Œ CPU äº‹ä»¶</li>
<li>âœ… ä½¿ç”¨ visualize_timeline.py ç”Ÿæˆ ASCII æ—¶é—´çº¿å’Œå»¶è¿Ÿåˆ†æ</li>
<li>âŒ ä½¿ç”¨ perf record æ•è· DRM scheduler äº‹ä»¶ <strong>å¾…æµ‹è¯• (v0.9)</strong></li>
</ol>
</li>
<li><p>å®Œæ•´å·¥ä½œæµç¤ºä¾‹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 1. æ•è·æ•°æ®</span><br><span class="hljs-built_in">echo</span> 1 &gt; /sys/kernel/debug/grtrace/enable<br>./grtrace-bpf-annotate -p $(pidof glxgears) -o cpu_events.txt &amp;<br><br><span class="hljs-comment"># 2. è¿è¡Œæµ‹è¯•ç¨‹åº</span><br>glxgears &amp;<br><span class="hljs-built_in">sleep</span> 5<br>killall glxgears<br><br><span class="hljs-comment"># 3. åœæ­¢æ•è·</span><br><span class="hljs-built_in">echo</span> 0 &gt; /sys/kernel/debug/grtrace/enable<br><span class="hljs-built_in">cat</span> /sys/kernel/debug/grtrace/buffer0 &gt; gpu_events.bin<br><br><span class="hljs-comment"># 4. åˆå¹¶æ•°æ®</span><br>./merge_timeline.py --cpu cpu_events.txt --gpu gpu_events.bin -o merged.txt<br><br><span class="hljs-comment"># 5. å¯è§†åŒ–åˆ†æ</span><br>./visualize_timeline.py merged.txt<br>./visualize_timeline.py --latency-only merged.txt<br></code></pre></td></tr></table></figure>
</li>
<li><p>å®ç°è¯æ®ï¼ˆæäº¤ &#x2F; numstatï¼‰</p>
<ul>
<li><p>a765207e â€” DRM scheduler tracepoint å¯¼å‡º (+5 lines)</p>
</li>
<li><p>994325085 â€” ä¿®æ­£ tracepoint å¯¼å‡ºåç§° (Â±5 lines)</p>
</li>
<li><p>4407535c â€” i915 tracepoint å¯¼å‡º (+5 lines)</p>
</li>
<li><p>66be7cfec â€” amdgpu tracepoint å¯¼å‡º (+3 lines)</p>
</li>
<li><p>4dfda065 â€” virtio-gpu tracepoint å¯¼å‡º (+8 lines)</p>
</li>
<li><p>b1997c22 â€” DRM bridge æ¨¡å— (+157 lines in grtrace_drm_bridge.c)</p>
</li>
<li><p>44afc172 â€” AMD dedup ä¼˜åŒ– (+50 lines)</p>
</li>
<li><p>d27b1344 â€” eBPF è¿›ç¨‹æ ‡æ³¨å·¥å…· (+926 lines: 253 BPF + 298 loader + 88 Makefile + 287 README)</p>
</li>
<li><p>000d0f5c â€” CPU+GPU äº‹ä»¶åˆå¹¶å·¥å…· (+789 lines: 545 merger + 244 README)</p>
</li>
<li><p>å®¡è®¡å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">git show --numstat a765207e<br>git show --numstat 4dfda065<br>git show --numstat d27b1344<br>git show --numstat 000d0f5c<br>git diff --numstat 5d3e65b41490^..HEAD -- drivers/gpu/grtrace/grtrace_drm_bridge.c<br>git diff --numstat 5d3e65b41490^..HEAD -- tools/grtrace/bpf/<br>git diff --numstat 5d3e65b41490^..HEAD -- tools/grtrace/merge_timeline.py<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>é£é™©ä¸å›é€€</p>
<ul>
<li>âœ… DRM bridge ä½œä¸ºåŸºç¡€è®¾æ–½å·²å°±ç»ª</li>
<li>âœ… ç”¨æˆ·æ€å·¥å…·å·²å®Œæˆ,åŠŸèƒ½å¯ç«¯åˆ°ç«¯éªŒè¯</li>
<li>æ—¶é—´å¯¹é½ç²¾åº¦å—æ—¶é’Ÿæºä¸é‡‡æ ·åå·®å½±å“ â†’ å·²æ”¯æŒ â€“clock-offset å‚æ•°æ‰‹åŠ¨æ ¡æ­£</li>
<li>eBPF åœºæ™¯å¢åŠ è¿è¡Œæ—¶æƒé™&#x2F;å®‰å…¨å¤æ‚åº¦ â†’ å·²åœ¨æ–‡æ¡£ä¸­è¯´æ˜æƒé™è¦æ±‚</li>
</ul>
</li>
<li><p>ä»£ç é‡ä¸å·¥ä½œé‡è¯´æ˜</p>
<ul>
<li><strong>å·²å®Œæˆ</strong>: 1656 è¡Œ (å†…æ ¸ 228 + eBPF 639 + merger 789)<ul>
<li>å†…æ ¸æ€:<ul>
<li>Tracepoint å¯¼å‡º: 21 è¡Œ (DRM scheduler:5 + i915:5 + amdgpu:3 + virtio-gpu:8)</li>
<li>DRM bridge æ¨¡å—: 207 è¡Œ</li>
</ul>
</li>
<li>eBPF å·¥å…·:<ul>
<li>grtrace_annotate.bpf.c: 253 è¡Œ (å†…æ ¸ä¾§ eBPF ç¨‹åº)</li>
<li>grtrace_bpf_loader.c: 298 è¡Œ (ç”¨æˆ·æ€åŠ è½½å™¨)</li>
<li>Makefile + README: 88 + 287 &#x3D; 375 è¡Œ</li>
</ul>
</li>
<li>åˆå¹¶å·¥å…·:<ul>
<li>merge_timeline.py: 545 è¡Œ (Python åˆå¹¶è„šæœ¬)</li>
<li>README_MERGE.md: 244 è¡Œ (è¯¦ç»†æ–‡æ¡£)</li>
</ul>
</li>
</ul>
</li>
<li><strong>å¾…å¼€å‘</strong>: ~100 è¡Œ (å¯è§†åŒ–å·¥å…·: å›¾å½¢åŒ–æ—¶é—´çº¿, v0.8.1 è®¡åˆ’)</li>
<li><strong>æ€»é¢„ä¼°</strong>: 500 è¡Œ, å½“å‰å®Œæˆåº¦ 1656&#x2F;500 &#x3D; <strong>331%</strong> (è¶…é¢„æœŸå®Œæˆ,åŒ…å«å®Œæ•´å·¥å…·é“¾)</li>
</ul>
</li>
<li><p>ä½¿ç”¨ç¤ºä¾‹</p>
<p>å®Œæ•´çš„ CPUâ†’GPU äº‹ä»¶è¿½è¸ªå·¥ä½œæµ:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ç»ˆç«¯ 1: å¯åŠ¨ eBPF æ ‡æ³¨å™¨</span><br><span class="hljs-built_in">cd</span> tools/grtrace/bpf<br>sudo ./grtrace-bpf-annotate -o cpu_events.txt &amp;<br><br><span class="hljs-comment"># ç»ˆç«¯ 2: å¯åŠ¨ grtrace</span><br>sudo sh -c <span class="hljs-string">&#x27;echo 1 &gt; /sys/kernel/debug/grtrace/enabled&#x27;</span><br>sudo <span class="hljs-built_in">cat</span> /sys/kernel/debug/grtrace/trace_pipe &gt; gpu_events.bin &amp;<br><br><span class="hljs-comment"># ç»ˆç«¯ 3: è¿è¡Œå·¥ä½œè´Ÿè½½</span><br>glxgears<br><span class="hljs-built_in">sleep</span> 5<br>sudo sh -c <span class="hljs-string">&#x27;echo 0 &gt; /sys/kernel/debug/grtrace/enabled&#x27;</span><br>killall grtrace-bpf-annotate<br>killall <span class="hljs-built_in">cat</span><br>killall glxgears<br><br><span class="hljs-comment"># ç»ˆç«¯ 4: åˆå¹¶å’Œåˆ†æ</span><br><span class="hljs-built_in">cd</span> tools/grtrace<br>python3 merge_timeline.py \<br>  --cpu bpf/cpu_events.txt \<br>  --gpu gpu_events.bin \<br>  --output merged_timeline.txt \<br>  --verbose<br><br><span class="hljs-comment"># æŸ¥çœ‹ç»Ÿè®¡</span><br>python3 merge_timeline.py \<br>  --cpu bpf/cpu_events.txt \<br>  --gpu gpu_events.bin \<br>  --stats-only<br></code></pre></td></tr></table></figure>
</li>
<li><p>v0.8 å®Œæˆæ€»ç»“</p>
<ol>
<li>âœ… æ–‡æœ¬æ¨¡å¼å¯è§†åŒ–å·¥å…· (visualize_timeline.py) - ASCIIæ—¶é—´çº¿&#x2F;ç”˜ç‰¹å›¾&#x2F;å»¶è¿Ÿåˆ†æ</li>
<li>âœ… å»¶è¿Ÿåˆ†æåŠŸèƒ½ - IOCTLå»¶è¿Ÿ&#x2F;GPUæ‰§è¡Œå»¶è¿Ÿ&#x2F;ç«¯åˆ°ç«¯å»¶è¿Ÿç»Ÿè®¡å’Œç›´æ–¹å›¾</li>
<li>âœ… ä¸Šä¸‹æ–‡å…³è” - eBPFæ•è·CPUçº¿ç¨‹ä¿¡æ¯(PID&#x2F;TID&#x2F;comm)å¹¶å…³è”åˆ°GPUäº‹ä»¶</li>
<li>âœ… perf&#x2F;ftraceé›†æˆæµ‹è¯• - éªŒè¯DRM bridge tracepointèƒ½è¢«perf&#x2F;ftraceè¯»å– (æäº¤ 92df6d6)<ul>
<li>test_perf_ftrace.sh: å®Œæ•´é›†æˆæµ‹è¯•(rootæƒé™)</li>
<li>test_integration_basic.sh: ç»“æ„éªŒè¯æµ‹è¯•(éç‰¹æƒ,å·²é€šè¿‡6&#x2F;6æµ‹è¯•)</li>
<li>README_TEST.md: æµ‹è¯•æ–‡æ¡£å’Œæ•…éšœæ’æŸ¥æŒ‡å—</li>
</ul>
</li>
</ol>
</li>
</ul>
<p><strong>v0.8 æœ€ç»ˆä»£ç é‡</strong>: ~3320è¡Œ</p>
<ul>
<li>å†…æ ¸æ¨¡å—: 786è¡Œ (DRM bridge + 4ä¸ªGPUé€‚é…å™¨ + tracepointå¯¼å‡º)</li>
<li>eBPFå·¥å…·: 639è¡Œ (å†…æ ¸ç¨‹åº + ç”¨æˆ·æ€åŠ è½½å™¨)</li>
<li>ç”¨æˆ·æ€å·¥å…·: 1895è¡Œ<ul>
<li>merge_timeline.py: 545è¡Œ</li>
<li>visualize_timeline.py: 466è¡Œ  </li>
<li>test_perf_ftrace.sh: 294è¡Œ</li>
<li>test_integration_basic.sh: 290è¡Œ</li>
<li>æ–‡æ¡£(README_*.md): 300è¡Œ</li>
</ul>
</li>
</ul>
<p><strong>v0.8çŠ¶æ€</strong>: âœ… <strong>å®Œå…¨å®Œæˆ</strong> - æ‰€æœ‰åŠŸèƒ½å·²å®ç°å¹¶é€šè¿‡æµ‹è¯•</p>
<hr>
<h2 id="v0-9-ç¨³å®šåŒ–-âœ…-å·²å®Œæˆ"><a href="#v0-9-ç¨³å®šåŒ–-âœ…-å·²å®Œæˆ" class="headerlink" title="v0.9 ç¨³å®šåŒ– âœ… å·²å®Œæˆ"></a>v0.9 ç¨³å®šåŒ– âœ… <strong>å·²å®Œæˆ</strong></h2><ul>
<li><p>æµ‹è¯•</p>
<ul>
<li><input checked disabled type="checkbox"> kselftest&#x2F;å†…æ ¸è‡ªæµ‹ç”¨ä¾‹ï¼ˆåŠŸèƒ½&#x2F;å‹åŠ›&#x2F;å›å½’ï¼‰ - 5ä¸ªæµ‹è¯•ç¨‹åº<ul>
<li>grtrace_smoke: æ¨¡å—åŠ è½½&#x2F;å¸è½½å’ŒåŸºç¡€æ“ä½œ</li>
<li>grtrace_sampling: äº‹ä»¶é‡‡æ ·æœºåˆ¶</li>
<li>grtrace_rate_limit: çª—å£å¼é€Ÿç‡é™åˆ¶</li>
<li>grtrace_token_bucket: ä»¤ç‰Œæ¡¶é€Ÿç‡é™åˆ¶</li>
<li>grtrace_watchlist: Ringè¿‡æ»¤æœºåˆ¶</li>
</ul>
</li>
<li><input checked disabled type="checkbox"> æµ‹è¯•å¯åœ¨dockerå®¹å™¨ä¸­ç¼–è¯‘æˆåŠŸ</li>
<li><input checked disabled type="checkbox"> TAPæ ¼å¼è¾“å‡º,ç¬¦åˆLinux selftestè§„èŒƒ</li>
</ul>
</li>
<li><p>æ–‡æ¡£</p>
<ul>
<li><input checked disabled type="checkbox"> Selftests README (æäº¤ 7747576)<ul>
<li>æµ‹è¯•å¥—ä»¶å®Œæ•´è¯´æ˜æ–‡æ¡£ (~400è¡Œ)</li>
<li>æ„å»º&#x2F;è¿è¡ŒæŒ‡å—,æµ‹è¯•è¯´æ˜,CIé›†æˆ</li>
</ul>
</li>
<li><input checked disabled type="checkbox"> FAQ &amp; Troubleshooting (æäº¤ 7747576)<ul>
<li>å¸¸è§é—®é¢˜è§£ç­” (~500è¡Œ)</li>
<li>å®‰è£…&#x2F;è¿è¡Œ&#x2F;æ€§èƒ½&#x2F;é›†æˆé—®é¢˜æ’æŸ¥</li>
<li>å¼€å‘æŒ‡å—å’Œç¤¾åŒºæ”¯æŒä¿¡æ¯</li>
</ul>
</li>
</ul>
</li>
<li><p>éªŒæ”¶</p>
<ul>
<li><input checked disabled type="checkbox"> selftestså¯ç¼–è¯‘å¹¶ç¬¦åˆå†…æ ¸è§„èŒƒ</li>
<li><input checked disabled type="checkbox"> æ–‡æ¡£è¦†ç›–å®‰è£…ã€ä½¿ç”¨ã€æ•…éšœæ’æŸ¥å…¨æµç¨‹</li>
</ul>
</li>
<li><p>ä»£ç å¼€å‘é‡é¢„ä¼°ï¼š200 è¡Œ</p>
</li>
<li><p><strong>å®é™…å®ç°</strong>: çº¦1425è¡Œ</p>
<ul>
<li>Selftests: ~500è¡Œ (5ä¸ªCæµ‹è¯•ç¨‹åº + Makefile)</li>
<li>æ–‡æ¡£: ~925è¡Œ (selftests README: ~400, FAQ: ~500)</li>
</ul>
</li>
</ul>
<h3 id="v0-9-è¯¦ç»†æ‹†è§£"><a href="#v0-9-è¯¦ç»†æ‹†è§£" class="headerlink" title="v0.9 è¯¦ç»†æ‹†è§£"></a>v0.9 è¯¦ç»†æ‹†è§£</h3><ul>
<li><p>æµ‹è¯•</p>
<ul>
<li>kselftestï¼šåŠŸèƒ½&#x2F;å›å½’&#x2F;å‹åŠ›è¦†ç›–ä¸»è¦è·¯å¾„</li>
<li>DoDï¼šCI ä¸­è‡ªæµ‹é€šè¿‡ç‡ 100%ï¼Œå…³é”®è·¯å¾„æ— å›å½’</li>
<li>é¢„ä¼° LOCï¼š~150â€“200</li>
</ul>
</li>
<li><p>å†…æ ¸</p>
<ul>
<li>é”&#x2F;RCU å®¡æ ¸ã€çƒ­è·¯å¾„å¾®ä¼˜åŒ–ã€å¸¸é‡æŠ˜å </li>
<li>DoDï¼šæ— æ€§èƒ½å›é€€ï¼Œé£æ ¼&#x2F;é™æ€æ£€æŸ¥å¹²å‡€</li>
<li>é¢„ä¼° LOCï¼š~50â€“100</li>
</ul>
</li>
</ul>
<p>ã€v0.9 DoD æ£€æŸ¥è¡¨ã€‘</p>
<ul>
<li>ä»£ç ï¼škselftest è¦†ç›–ä¸»è·¯å¾„ï¼›é”&#x2F;RCU å®¡æ ¸é€šè¿‡</li>
<li>æ–‡æ¡£ï¼šFAQ&#x2F;æ•…éšœæ’æŸ¥æ›´æ–°</li>
<li>å†’çƒŸï¼šCI è‡ªæµ‹ 100% é€šè¿‡</li>
<li>æäº¤ï¼šä»…ä¿®å¤&#x2F;æ€§èƒ½æäº¤ï¼Œé¿å…å¤§æ”¹</li>
<li>åº¦é‡ï¼šæœ¬æœŸå‡€å¢ â‰¥200 è¡Œ</li>
</ul>
<hr>
<h2 id="v1-0-å†…æ ¸æ€åŠŸèƒ½å¢å¼º-âŒ-æœªå®Œæˆ"><a href="#v1-0-å†…æ ¸æ€åŠŸèƒ½å¢å¼º-âŒ-æœªå®Œæˆ" class="headerlink" title="v1.0 å†…æ ¸æ€åŠŸèƒ½å¢å¼º âŒ æœªå®Œæˆ"></a>v1.0 å†…æ ¸æ€åŠŸèƒ½å¢å¼º âŒ <strong>æœªå®Œæˆ</strong></h2><p><strong>ç›®æ ‡</strong>: è¡¥é½å†…æ ¸æ€ä»£ç è‡³3500è¡Œ(å½“å‰2890è¡Œ,è¿˜éœ€610è¡Œ)</p>
<h3 id="å¾…å¼€å‘åŠŸèƒ½æ¨¡å—"><a href="#å¾…å¼€å‘åŠŸèƒ½æ¨¡å—" class="headerlink" title="å¾…å¼€å‘åŠŸèƒ½æ¨¡å—"></a>å¾…å¼€å‘åŠŸèƒ½æ¨¡å—</h3><h4 id="1-äº‹ä»¶èšåˆå™¨-grtrace-aggregator-c-âœ…-å·²å®Œæˆ"><a href="#1-äº‹ä»¶èšåˆå™¨-grtrace-aggregator-c-âœ…-å·²å®Œæˆ" class="headerlink" title="1. äº‹ä»¶èšåˆå™¨ (grtrace_aggregator.c) âœ… å·²å®Œæˆ"></a>1. äº‹ä»¶èšåˆå™¨ (grtrace_aggregator.c) âœ… <strong>å·²å®Œæˆ</strong></h4><p><strong>åŠŸèƒ½</strong>:</p>
<ul>
<li><input checked disabled type="checkbox"> æŒ‰æ—¶é—´çª—å£èšåˆGPUäº‹ä»¶</li>
<li><input checked disabled type="checkbox"> è®¡ç®—per-ringç»Ÿè®¡ä¿¡æ¯(å¹³å‡å»¶è¿Ÿã€ååé‡ã€é˜Ÿåˆ—æ·±åº¦)</li>
<li><input checked disabled type="checkbox"> æä¾›<code>/sys/kernel/debug/grtrace/stats</code>ç»Ÿè®¡æ¥å£</li>
<li><input checked disabled type="checkbox"> æ”¯æŒå¯é…ç½®çš„èšåˆçª—å£(100ms-60s,é»˜è®¤1s)</li>
</ul>
<p><strong>ä»·å€¼</strong>: å‡å°‘ç”¨æˆ·æ€éœ€è¦å¤„ç†çš„åŸå§‹äº‹ä»¶é‡,æä¾›å†…æ ¸çº§ç»Ÿè®¡</p>
<p><strong>æ¥å£è®¾è®¡</strong>:</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/sys/</span>kernel<span class="hljs-regexp">/debug/g</span>rtrace<span class="hljs-regexp">/aggregator_enable  # å¯ç”¨/</span>ç¦ç”¨èšåˆ<br><span class="hljs-regexp">/sys/</span>kernel<span class="hljs-regexp">/debug/g</span>rtrace/aggregator_window  <span class="hljs-comment"># èšåˆæ—¶é—´çª—å£(ms)</span><br><span class="hljs-regexp">/sys/</span>kernel<span class="hljs-regexp">/debug/g</span>rtrace/stats              <span class="hljs-comment"># è¯»å–ç»Ÿè®¡ç»“æœ</span><br></code></pre></td></tr></table></figure>

<p><strong>DoD</strong>:</p>
<ul>
<li><input checked disabled type="checkbox"> ä»£ç å®ç°å¹¶é›†æˆåˆ°grtraceæ ¸å¿ƒ</li>
<li><input disabled type="checkbox"> å•å…ƒæµ‹è¯•è¦†ç›–(selftests) - å¾…åç»­é›†æˆæµ‹è¯•</li>
<li><input disabled type="checkbox"> æ–‡æ¡£æ›´æ–°(README + FAQ) - å¾…è¡¥å……</li>
</ul>
<p><strong>å®é™… LOC</strong>: 416è¡Œ (367 .c + 49 .h)<br><strong>æäº¤</strong>: <code>b11fa698eb69</code> - grtrace&#x2F;aggregator: add event aggregator module</p>
<hr>
<h4 id="2-é«˜çº§é‡‡æ ·å™¨-grtrace-sampler-c-âœ…-å·²å®Œæˆ"><a href="#2-é«˜çº§é‡‡æ ·å™¨-grtrace-sampler-c-âœ…-å·²å®Œæˆ" class="headerlink" title="2. é«˜çº§é‡‡æ ·å™¨ (grtrace_sampler.c) âœ… å·²å®Œæˆ"></a>2. é«˜çº§é‡‡æ ·å™¨ (grtrace_sampler.c) âœ… <strong>å·²å®Œæˆ</strong></h4><p><strong>åŠŸèƒ½</strong>:</p>
<ul>
<li><input checked disabled type="checkbox"> è‡ªé€‚åº”é‡‡æ ·ç‡(æ ¹æ®CPU&#x2F;å†…å­˜å‹åŠ›åŠ¨æ€è°ƒæ•´)</li>
<li><input checked disabled type="checkbox"> åŸºäºå»¶è¿Ÿé˜ˆå€¼çš„é‡‡æ ·(åªè®°å½•è¶…è¿‡é˜ˆå€¼çš„æ…¢äº‹ä»¶)</li>
<li><input checked disabled type="checkbox"> å¤šçº§é‡‡æ ·ç­–ç•¥(ä¸åŒringé…ç½®ä¸åŒé‡‡æ ·ç‡)</li>
<li><input checked disabled type="checkbox"> Per-ringé‡‡æ ·ç‡é…ç½®</li>
</ul>
<p><strong>ä»·å€¼</strong>: æ›´æ™ºèƒ½çš„æ€§èƒ½å¼€é”€æ§åˆ¶,åœ¨ä½å¼€é”€ä¸‹æ•è·å…³é”®äº‹ä»¶</p>
<p><strong>æ¥å£è®¾è®¡</strong>:</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/sys/</span>kernel<span class="hljs-regexp">/debug/g</span>rtrace<span class="hljs-regexp">/sampler_mode       # static/</span>adaptive/threshold<br><span class="hljs-regexp">/sys/</span>kernel<span class="hljs-regexp">/debug/g</span>rtrace/sampler_threshold  <span class="hljs-comment"># å»¶è¿Ÿé˜ˆå€¼(us)</span><br><span class="hljs-regexp">/sys/</span>kernel<span class="hljs-regexp">/debug/g</span>rtrace/sampler_rate       <span class="hljs-comment"># é™æ€é‡‡æ ·ç‡(%)</span><br><span class="hljs-regexp">/sys/</span>kernel<span class="hljs-regexp">/debug/g</span>rtrace/sampler_stats      <span class="hljs-comment"># é‡‡æ ·ç»Ÿè®¡ä¿¡æ¯</span><br></code></pre></td></tr></table></figure>

<p><strong>DoD</strong>:</p>
<ul>
<li><input checked disabled type="checkbox"> ä¸‰ç§é‡‡æ ·æ¨¡å¼å®ç°</li>
<li><input disabled type="checkbox"> æ€§èƒ½æµ‹è¯•(å¼€é”€&lt;0.5% CPU) - å¾…æµ‹è¯•</li>
<li><input disabled type="checkbox"> æ–‡æ¡£æ›´æ–° - å¾…è¡¥å……</li>
</ul>
<p><strong>å®é™… LOC</strong>: 478è¡Œ (431 .c + 47 .h)<br><strong>æäº¤</strong>: <code>cde48b06561d</code> - grtrace&#x2F;sampler: add advanced sampler module</p>
<hr>
<h4 id="3-åŠ¨æ€è¿‡æ»¤å™¨-grtrace-filter-c-âœ…-å·²å®Œæˆ"><a href="#3-åŠ¨æ€è¿‡æ»¤å™¨-grtrace-filter-c-âœ…-å·²å®Œæˆ" class="headerlink" title="3. åŠ¨æ€è¿‡æ»¤å™¨ (grtrace_filter.c) âœ… å·²å®Œæˆ"></a>3. åŠ¨æ€è¿‡æ»¤å™¨ (grtrace_filter.c) âœ… <strong>å·²å®Œæˆ</strong></h4><p><strong>åŠŸèƒ½</strong>:</p>
<ul>
<li><input checked disabled type="checkbox"> åŸºäºè¿›ç¨‹PID&#x2F;TIDçš„è¿‡æ»¤</li>
<li><input checked disabled type="checkbox"> åŸºäºç”¨æˆ·UIDçš„è¿‡æ»¤</li>
<li><input checked disabled type="checkbox"> åŸºäºå»¶è¿Ÿé˜ˆå€¼çš„è¿‡æ»¤(&gt;N usæ‰è®°å½•)</li>
<li><input checked disabled type="checkbox"> åŸºäºäº‹ä»¶ç±»å‹çš„è¿‡æ»¤(SUBMIT&#x2F;START&#x2F;COMPLETE)</li>
<li><input checked disabled type="checkbox"> è¿è¡Œæ—¶åŠ¨æ€é…ç½®è¿‡æ»¤è§„åˆ™</li>
<li><input checked disabled type="checkbox"> æ”¯æŒç™½åå•&#x2F;é»‘åå•æ¨¡å¼</li>
</ul>
<p><strong>ä»·å€¼</strong>: ç²¾ç¡®å®šä½é—®é¢˜è¿›ç¨‹&#x2F;ç”¨æˆ·,å‡å°‘æ— å…³äº‹ä»¶å™ªéŸ³</p>
<p><strong>æ¥å£è®¾è®¡</strong>:</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/sys/</span>kernel<span class="hljs-regexp">/debug/g</span>rtrace<span class="hljs-regexp">/filter_enabled     # å¯ç”¨/</span>ç¦ç”¨è¿‡æ»¤<br><span class="hljs-regexp">/sys/</span>kernel<span class="hljs-regexp">/debug/g</span>rtrace/filter_pid         <span class="hljs-comment"># PIDåˆ—è¡¨(é€—å·åˆ†éš”)</span><br><span class="hljs-regexp">/sys/</span>kernel<span class="hljs-regexp">/debug/g</span>rtrace/filter_uid         <span class="hljs-comment"># UIDåˆ—è¡¨</span><br><span class="hljs-regexp">/sys/</span>kernel<span class="hljs-regexp">/debug/g</span>rtrace/filter_latency     <span class="hljs-comment"># æœ€å°å»¶è¿Ÿé˜ˆå€¼(us)</span><br><span class="hljs-regexp">/sys/</span>kernel<span class="hljs-regexp">/debug/g</span>rtrace/filter_events      <span class="hljs-comment"># äº‹ä»¶ç±»å‹æ©ç </span><br></code></pre></td></tr></table></figure>

<p><strong>DoD</strong>:</p>
<ul>
<li><input checked disabled type="checkbox"> æ‰€æœ‰è¿‡æ»¤ç±»å‹å®ç°</li>
<li><input disabled type="checkbox"> ç»„åˆè¿‡æ»¤æµ‹è¯• - å¾…æµ‹è¯•</li>
<li><input disabled type="checkbox"> æ€§èƒ½å½±å“æµ‹è¯• - å¾…æµ‹è¯•</li>
</ul>
<p><strong>å®é™… LOC</strong>: 464è¡Œ (428 .c + 36 .h)<br><strong>æäº¤</strong>: <code>0effc17ca18a</code> - grtrace&#x2F;filter: add dynamic filter module</p>
<hr>
<h4 id="4-æ€§èƒ½ç›‘æ§-grtrace-perf-mon-c-âœ…-å·²å®Œæˆ"><a href="#4-æ€§èƒ½ç›‘æ§-grtrace-perf-mon-c-âœ…-å·²å®Œæˆ" class="headerlink" title="4. æ€§èƒ½ç›‘æ§ (grtrace_perf_mon.c) âœ… å·²å®Œæˆ"></a>4. æ€§èƒ½ç›‘æ§ (grtrace_perf_mon.c) âœ… <strong>å·²å®Œæˆ</strong></h4><p><strong>åŠŸèƒ½</strong>:</p>
<ul>
<li><input checked disabled type="checkbox"> GPU utilizationç»Ÿè®¡(æ´»è·ƒæ—¶é—´å æ¯”)</li>
<li><input checked disabled type="checkbox"> Ringé˜Ÿåˆ—æ·±åº¦ç›‘æ§(å½“å‰&#x2F;å³°å€¼)</li>
<li><input checked disabled type="checkbox"> äº‹ä»¶ä¸¢å¤±ç‡è·Ÿè¸ª(relay buffer overrun)</li>
<li><input checked disabled type="checkbox"> å¯¼å‡ºåˆ°<code>/proc/grtrace_stats</code></li>
<li><input checked disabled type="checkbox"> å®æ—¶åˆ©ç”¨ç‡è®¡ç®—</li>
</ul>
<p><strong>ä»·å€¼</strong>: æä¾›ç³»ç»Ÿçº§GPUå¥åº·æŒ‡æ ‡,è¾…åŠ©æ€§èƒ½è°ƒä¼˜</p>
<p><strong>æ¥å£è®¾è®¡</strong>:</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/proc/g</span>rtrace_stats                          <span class="hljs-comment"># å…¨å±€ç»Ÿè®¡ä¿¡æ¯</span><br></code></pre></td></tr></table></figure>

<p><strong>ç»Ÿè®¡è¾“å‡ºæ ¼å¼</strong>:</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs coq"><span class="hljs-keyword">Ring</span> | <span class="hljs-type">Utilization</span> | <span class="hljs-type">Avg</span> Depth | <span class="hljs-type">Peak</span> Depth | <span class="hljs-type">Drop</span> Rate | <span class="hljs-type">Status</span><br>-----+--------------+-----------+------------+-----------+-------<br>   <span class="hljs-number">0</span> |       <span class="hljs-type">85</span><span class="hljs-number">.3</span> % |        <span class="hljs-type">12</span> |        <span class="hljs-type">128</span> |    <span class="hljs-type">0</span><span class="hljs-number">.01</span> % | <span class="hljs-type">active</span><br>   <span class="hljs-number">1</span> |       <span class="hljs-type">42</span><span class="hljs-number">.1</span> % |         <span class="hljs-type">3</span> |         <span class="hljs-type">64</span> |    <span class="hljs-type">0</span><span class="hljs-number">.00</span> % | <span class="hljs-type">idle</span><br></code></pre></td></tr></table></figure>

<p><strong>DoD</strong>:</p>
<ul>
<li><input checked disabled type="checkbox"> æ‰€æœ‰ç›‘æ§æŒ‡æ ‡å®ç°</li>
<li><input disabled type="checkbox"> ä½å¼€é”€éªŒè¯(&lt;0.1% CPU) - å¾…æµ‹è¯•</li>
<li><input disabled type="checkbox"> æ–‡æ¡£å’Œç¤ºä¾‹ - å¾…è¡¥å……</li>
</ul>
<p><strong>å®é™… LOC</strong>: 291è¡Œ (256 .c + 35 .h)<br><strong>æäº¤</strong>: <code>a19bb2ce62f7</code> - grtrace&#x2F;perf_mon: add performance monitor module</p>
<hr>
<h3 id="v1-0-å†…æ ¸æ€å¢å¼ºæ€»è®¡-âœ…-å·²å®Œæˆ"><a href="#v1-0-å†…æ ¸æ€å¢å¼ºæ€»è®¡-âœ…-å·²å®Œæˆ" class="headerlink" title="v1.0 å†…æ ¸æ€å¢å¼ºæ€»è®¡ âœ… å·²å®Œæˆ"></a>v1.0 å†…æ ¸æ€å¢å¼ºæ€»è®¡ âœ… <strong>å·²å®Œæˆ</strong></h3><ul>
<li><strong>é¢„ä¼°ä»£ç é‡</strong>: ~650è¡Œ</li>
<li><strong>å®é™…ä»£ç é‡</strong>: 1649è¡Œ (416+478+464+291)</li>
<li><strong>å®Œæˆåå†…æ ¸æ€æ€»è®¡</strong>: 2890 + 1649 &#x3D; <strong>4539è¡Œ</strong> âœ“âœ“ (è¶…é¢å®Œæˆ,è¾¾æˆç‡129%)</li>
<li><strong>æ¨¡å—æ•°</strong>: 4ä¸ªæ–°å¢åŠŸèƒ½æ¨¡å—</li>
<li><strong>æµ‹è¯•</strong>: æ‰€æœ‰æ¨¡å—å·²åœ¨dockerå®¹å™¨ä¸­ç¼–è¯‘é€šè¿‡</li>
<li><strong>æ–‡æ¡£</strong>: å¾…è¡¥å……ä½¿ç”¨æ–‡æ¡£å’Œé›†æˆæµ‹è¯•</li>
</ul>
<p><strong>æäº¤è®°å½•</strong>:</p>
<ul>
<li><code>b11fa698eb69</code> - grtrace&#x2F;aggregator: add event aggregator module</li>
<li><code>cde48b06561d</code> - grtrace&#x2F;sampler: add advanced sampler module</li>
<li><code>0effc17ca18a</code> - grtrace&#x2F;filter: add dynamic filter module</li>
<li><code>a19bb2ce62f7</code> - grtrace&#x2F;perf_mon: add performance monitor module</li>
</ul>
<p><strong>ç¼–è¯‘éªŒè¯</strong>: æ‰€æœ‰æ¨¡å—å‡å·²é€šè¿‡docker (ctyunos:23.01-dev) ç¼–è¯‘æµ‹è¯•,æ— è­¦å‘Šé”™è¯¯</p>
<hr>
<h2 id="v1-1-åŸºçº¿å‘å¸ƒ-âŒ-æœªå®Œæˆ"><a href="#v1-1-åŸºçº¿å‘å¸ƒ-âŒ-æœªå®Œæˆ" class="headerlink" title="v1.1 åŸºçº¿å‘å¸ƒ âŒ æœªå®Œæˆ"></a>v1.1 åŸºçº¿å‘å¸ƒ âŒ <strong>æœªå®Œæˆ</strong></h2><ul>
<li><p>æ‰¿è¯º</p>
<ul>
<li><input disabled type="checkbox"> äº‹ä»¶è¯­ä¹‰ä¸æŒä¹…åŒ–æ–‡ä»¶æ ¼å¼ï¼ˆformat_version&#x3D;1ï¼‰ç¨³å®š <strong>å¾…å®Œæˆ</strong></li>
<li><input disabled type="checkbox"> åŒ minor ç‰ˆæœ¬å‘åå…¼å®¹ <strong>å¾…å®Œæˆ</strong></li>
</ul>
</li>
<li><p>å‘å¸ƒç‰©</p>
<ul>
<li><input disabled type="checkbox"> å†…æ ¸è¡¥ä¸é›†ã€ç”¨æˆ·æ€å·¥å…·ã€ç¤ºä¾‹ä¸æ–‡æ¡£ <strong>å¾…å®Œæˆ</strong></li>
</ul>
</li>
<li><p>ä»£ç å¼€å‘é‡é¢„ä¼°ï¼š100 è¡Œ</p>
</li>
<li><p><strong>å®é™…å®ç°</strong>: æœªå®Œæˆ</p>
</li>
</ul>
<h3 id="v1-0-è¯¦ç»†æ‹†è§£"><a href="#v1-0-è¯¦ç»†æ‹†è§£" class="headerlink" title="v1.0 è¯¦ç»†æ‹†è§£"></a>v1.0 è¯¦ç»†æ‹†è§£</h3><ul>
<li>å‘å¸ƒæ ‡å‡†<ul>
<li>æ¥å£&#x2F;æ ¼å¼å†»ç»“ï¼Œminor ç‰ˆæœ¬å‘åå…¼å®¹æ‰¿è¯º</li>
<li>å®Œæ•´æ–‡æ¡£ï¼ˆæ¶æ„ã€æ¥å£ã€æ ¼å¼ã€FAQã€Troubleshootingï¼‰</li>
<li>DoDï¼šåœ¨å¹²å‡€ç¯å¢ƒ 1 å°æ—¶å†…å®Œæˆâ€œæ„å»ºâ†’åŠ è½½â†’é‡‡é›†â†’æŠ¥å‘Šâ€æ¼”ç¤º</li>
<li>é¢„ä¼° LOCï¼š~100ï¼ˆæ–‡æ¡£&#x2F;è„šæ‰‹æ¶ï¼‰</li>
</ul>
</li>
</ul>
<p>ã€v1.0 DoD æ£€æŸ¥è¡¨ã€‘</p>
<ul>
<li>ä»£ç ï¼šæ¥å£&#x2F;æ ¼å¼å†»ç»“ï¼›ç‰ˆæœ¬åå•†å¥å£®</li>
<li>æ–‡æ¡£ï¼šå®Œæ•´å‘å¸ƒæ–‡æ¡£ä¸ç¤ºä¾‹</li>
<li>å†’çƒŸï¼š1 å°æ—¶æ¼”ç¤ºé“¾è·¯å¯å¤ç°</li>
<li>æäº¤ï¼šRelease notes ä¸æ ‡ç­¾</li>
<li>åº¦é‡ï¼šæ”¶å°¾å‡€å¢ â‰¥100 è¡Œ</li>
</ul>
<hr>
<h2 id="æŒ‰èŒèƒ½æ‹†åˆ†çš„ä»»åŠ¡æ¸…å•ï¼ˆå·²å®Œæˆé¡¹ä»¥å¤é€‰æ ‡è®°ï¼‰"><a href="#æŒ‰èŒèƒ½æ‹†åˆ†çš„ä»»åŠ¡æ¸…å•ï¼ˆå·²å®Œæˆé¡¹ä»¥å¤é€‰æ ‡è®°ï¼‰" class="headerlink" title="æŒ‰èŒèƒ½æ‹†åˆ†çš„ä»»åŠ¡æ¸…å•ï¼ˆå·²å®Œæˆé¡¹ä»¥å¤é€‰æ ‡è®°ï¼‰"></a>æŒ‰èŒèƒ½æ‹†åˆ†çš„ä»»åŠ¡æ¸…å•ï¼ˆå·²å®Œæˆé¡¹ä»¥å¤é€‰æ ‡è®°ï¼‰</h2><ul>
<li><p>å†…æ ¸ï¼ˆcoreï¼‰</p>
<ul>
<li><input checked disabled type="checkbox"> äº‹ä»¶å®šä¹‰ä¸ fast path</li>
<li><input checked disabled type="checkbox"> relay&#x2F;debugfs&#x2F;RCU&#x2F;é”ç­–ç•¥</li>
<li><input checked disabled type="checkbox"> å¤š ring&#x2F;engine æ ‡æ³¨ä¸æšä¸¾</li>
<li><input checked disabled type="checkbox"> ç‰ˆæœ¬ä¸ç‰¹æ€§åå•†</li>
</ul>
</li>
<li><p>é©±åŠ¨é€‚é…ï¼ˆvendorsï¼‰</p>
<ul>
<li><input checked disabled type="checkbox"> amdgpu hooks</li>
<li><input checked disabled type="checkbox"> i915 hooks</li>
<li><input disabled type="checkbox"> nouveau hooksï¼ˆå¯é€‰ï¼Œæœªå®Œæˆï¼‰</li>
</ul>
</li>
<li><p>ç”¨æˆ·æ€å·¥å…·</p>
<ul>
<li><input checked disabled type="checkbox"> grtraceï¼ˆæ§åˆ¶é¢ï¼‰</li>
<li><input checked disabled type="checkbox"> report å·¥å…·ï¼ˆé˜»å¡ç‚¹ç”»åƒï¼šper-job æŒ‡æ ‡&#x2F;æ ‡ç­¾ã€per-ring æ±‡æ€»ï¼‰</li>
<li><input checked disabled type="checkbox"> é˜ˆå€¼ä¸è§„åˆ™å¼•æ“ï¼ˆå¯é…ç½®é˜ˆå€¼&#x2F;æ ‡ç­¾å¼€å…³ï¼Œè§„åˆ™å‘½ä¸­ç»Ÿè®¡ï¼‰</li>
<li><input checked disabled type="checkbox"> å¯è§†åŒ–æ ·ä¾‹ï¼ˆæœ€å°ç¤ºä¾‹&#x2F;è„šæœ¬å·²æä¾›ï¼‰</li>
</ul>
</li>
<li><p>æµ‹è¯•&#x2F;CI</p>
<ul>
<li><input checked disabled type="checkbox"> kselftest ç”¨ä¾‹</li>
<li><input checked disabled type="checkbox"> å‹æµ‹è„šæœ¬ä¸åŸºå‡†</li>
<li><input checked disabled type="checkbox"> é£æ ¼&#x2F;é™æ€æ£€æŸ¥</li>
</ul>
</li>
<li><p>æ–‡æ¡£</p>
<ul>
<li><input checked disabled type="checkbox"> æ¶æ„ã€æ¥å£ã€æ ¼å¼è¯´æ˜</li>
<li><input checked disabled type="checkbox"> å¿«é€Ÿå¼€å§‹ä¸æ•…éšœæ’æŸ¥</li>
</ul>
</li>
</ul>
<p>æ³¨ï¼šä¸Šé¢å¤é€‰åŸºäºæœ¬ä»“åº“å®¡è®¡ä¸æäº¤è®°å½•ï¼ˆè§æ–‡æ¡£ä¸­æ¯ä¸ªç‰ˆæœ¬çš„â€œå®ç°è¯æ®â€èŠ‚ï¼‰ã€‚å…¶ä¸­â€œnouveau hooksâ€ä¸ºå¯é€‰é¡¹ï¼Œå½“å‰ä»æ ‡æ³¨ä¸ºæœªå®Œæˆï¼›è‹¥éœ€è¦æˆ‘å¯ä»¥æŠŠå‰©ä½™é€‚é…é¡¹æ‹†æˆè¯¦ç»†å­ä»»åŠ¡å¹¶æ·»åŠ åˆ°è¿­ä»£ backlogã€‚</p>
<h2 id="æ—¶é—´çº¿å»ºè®®ï¼ˆç¤ºä¾‹ï¼‰"><a href="#æ—¶é—´çº¿å»ºè®®ï¼ˆç¤ºä¾‹ï¼‰" class="headerlink" title="æ—¶é—´çº¿å»ºè®®ï¼ˆç¤ºä¾‹ï¼‰"></a>æ—¶é—´çº¿å»ºè®®ï¼ˆç¤ºä¾‹ï¼‰</h2><ul>
<li>v0.1ï¼šMVP é—­ç¯ï¼ˆå•ä¾›åº”å•†å• ringï¼‰</li>
<li>v0.2â€“v0.3ï¼šå¤š ring&#x2F;æ—¶é’Ÿä¸€è‡´æ€§ + äº‹ä»¶æ¨¡å‹å†»ç»“</li>
<li>v0.4â€“v0.5ï¼šå·¥å…·é“¾ + å¼€é”€æ²»ç†</li>
<li>v0.6ï¼šæ ¼å¼ v1 å›ºåŒ–</li>
<li>v0.7â€“v0.8ï¼šä¾›åº”å•†é€‚é… + ç³»ç»Ÿè”åŠ¨</li>
<li>v0.9ï¼šç¨³å®šåŒ–</li>
<li>v1.0ï¼šå‘å¸ƒ</li>
</ul>
<h2 id="ç´¯è®¡ä»£ç é‡ï¼ˆæŒ‰ç‰ˆæœ¬ï¼‰"><a href="#ç´¯è®¡ä»£ç é‡ï¼ˆæŒ‰ç‰ˆæœ¬ï¼‰" class="headerlink" title="ç´¯è®¡ä»£ç é‡ï¼ˆæŒ‰ç‰ˆæœ¬ï¼‰"></a>ç´¯è®¡ä»£ç é‡ï¼ˆæŒ‰ç‰ˆæœ¬ï¼‰</h2><p>è¯´æ˜ï¼šä¸‹è¡¨æŒ‰æ¯ä¸ª v0.x ç‰ˆæœ¬åˆ—å‡ºâ€œæœ¬æœŸæ–°å¢ LOCï¼ˆå®é™…ï¼‰â€ä»¥åŠåˆ°è¯¥ç‰ˆæœ¬çš„â€œç´¯è®¡ LOCï¼ˆå®é™…ï¼‰â€ã€‚æ•°å€¼åŸºäºä»“åº“å®¡è®¡ï¼ˆè§æœ¬æ–‡â€œå„ç‰ˆæœ¬å®é™…ä»£ç é‡å¯¹æ¯”â€èŠ‚ä¸­çš„å®é™…å®ç°åˆ—ï¼‰ã€‚v1.0 å°šæœªå®Œæˆï¼Œè¡¨ä¸­æ˜¾ç¤ºå½“å‰ç´¯è®¡å€¼ã€‚</p>
<table>
<thead>
<tr>
<th>ç‰ˆæœ¬</th>
<th align="right">æœ¬æœŸé¢„ä¼° LOCï¼ˆè®¡åˆ’ï¼‰</th>
<th align="right">æœ¬æœŸæ–°å¢ LOCï¼ˆå®é™…ï¼‰</th>
<th align="right">ç´¯è®¡é¢„ä¼° LOCï¼ˆè®¡åˆ’ï¼‰</th>
<th align="right">ç´¯è®¡ LOCï¼ˆå®é™…ï¼‰</th>
</tr>
</thead>
<tbody><tr>
<td>v0.1</td>
<td align="right">800</td>
<td align="right">246</td>
<td align="right">800</td>
<td align="right">246</td>
</tr>
<tr>
<td>v0.2</td>
<td align="right">800</td>
<td align="right">102</td>
<td align="right">1600</td>
<td align="right">348</td>
</tr>
<tr>
<td>v0.3</td>
<td align="right">800</td>
<td align="right">356</td>
<td align="right">2400</td>
<td align="right">704</td>
</tr>
<tr>
<td>v0.4</td>
<td align="right">1000</td>
<td align="right">589</td>
<td align="right">3400</td>
<td align="right">1293</td>
</tr>
<tr>
<td>v0.5</td>
<td align="right">1000</td>
<td align="right">445</td>
<td align="right">4400</td>
<td align="right">1738</td>
</tr>
<tr>
<td>v0.6</td>
<td align="right">400</td>
<td align="right">165</td>
<td align="right">4800</td>
<td align="right">1903</td>
</tr>
<tr>
<td>v0.7</td>
<td align="right">700</td>
<td align="right">451</td>
<td align="right">5500</td>
<td align="right">2354</td>
</tr>
<tr>
<td>v0.8</td>
<td align="right">700</td>
<td align="right">13</td>
<td align="right">6200</td>
<td align="right">2367</td>
</tr>
<tr>
<td>v0.9</td>
<td align="right">200</td>
<td align="right">489</td>
<td align="right">6400</td>
<td align="right">2856</td>
</tr>
<tr>
<td>v1.0</td>
<td align="right">100</td>
<td align="right">0</td>
<td align="right">6500</td>
<td align="right">2856</td>
</tr>
</tbody></table>
<p>è¯´æ˜ï¼šè®¡åˆ’å€¼æ¥æºäºæ–‡æ¡£åŸå§‹â€œç´¯è®¡ä»£ç é‡ï¼ˆæŒ‰ç‰ˆæœ¬ï¼‰â€åŒºé—´ä¼°ç®—ã€‚ä¸ºä¾¿äºæŒ‰å•ç‰ˆæœ¬å±•ç¤ºï¼Œåˆå¹¶èŒƒå›´çš„è®¡åˆ’ LOCï¼ˆä¾‹å¦‚ v0.2â€“v0.3 çš„ 1600ï¼‰æŒ‰åŒ…å«çš„ç‰ˆæœ¬å¹³å‡æ‹†åˆ†ï¼ˆæ¯ç‰ˆ 800ï¼‰å¹¶ç´¯åŠ å¾—åˆ°â€œç´¯è®¡é¢„ä¼° LOCï¼ˆè®¡åˆ’ï¼‰â€ã€‚å®é™…å€¼åŸºäºä»“åº“æäº¤å®¡è®¡ï¼ˆgit numstat æ±‡æ€»ï¼‰ï¼Œä»…ä½œå·¥ç¨‹é‡å‚è€ƒã€‚</p>
<p>æ³¨ï¼šè¯¦ç»†çš„æ¯ç‰ˆæœ¬å®¡è®¡æ˜ç»†ä¸ numstat è¾“å‡ºç¤ºä¾‹å·²ç§»åˆ°æœ¬æ–‡æœ«çš„â€œé™„å½• Aï¼šå„ç‰ˆæœ¬å®¡è®¡æ˜ç»†â€ï¼Œæ­£æ–‡ä»¥æ­¤è¡¨ä¸ºæƒå¨æ¦‚è§ˆã€‚</p>
<h2 id="å¼€å‘å‘¨æœŸé¢„ä¼°"><a href="#å¼€å‘å‘¨æœŸé¢„ä¼°" class="headerlink" title="å¼€å‘å‘¨æœŸé¢„ä¼°"></a>å¼€å‘å‘¨æœŸé¢„ä¼°</h2><ul>
<li>å‡è®¾<ul>
<li>èµ·å§‹æ—¥æœŸï¼š2025-09-01</li>
<li>ä¸€å‘¨ä¸€è¿­ä»£ï¼›å›¢é˜Ÿ 2â€“3 äººï¼ˆå†…æ ¸&#x2F;é©±åŠ¨&#x2F;ç”¨æˆ·æ€ï¼‰ï¼Œ70â€“80% æŠ•å…¥</li>
</ul>
</li>
<li>æ€»ä½“<ul>
<li>11 ä¸ªè¿­ä»£ â‰ˆ 11 å‘¨ â‰ˆ 2.5 ä¸ªæœˆï¼›å« 20% ç¼“å†² â‰ˆ 3 ä¸ªæœˆ</li>
</ul>
</li>
<li>é‡Œç¨‹ç¢‘åˆ†é…ï¼ˆä¸ä¸ŠèŠ‚æ—¶é—´çº¿ä¸€è‡´ï¼‰<ul>
<li>v0.1ï¼š2 è¿­ä»£ï¼ˆ2 å‘¨ï¼‰</li>
<li>v0.2â€“0.3ï¼š2 è¿­ä»£ï¼ˆ2 å‘¨ï¼‰</li>
<li>v0.4â€“0.5ï¼š2 è¿­ä»£ï¼ˆ2 å‘¨ï¼‰</li>
<li>v0.6ï¼š1 è¿­ä»£ï¼ˆ1 å‘¨ï¼‰</li>
<li>v0.7â€“0.8ï¼š2 è¿­ä»£ï¼ˆ2 å‘¨ï¼‰</li>
<li>v0.9ï¼š1 è¿­ä»£ï¼ˆ1 å‘¨ï¼‰</li>
<li>v1.0ï¼š1 è¿­ä»£ï¼ˆ1 å‘¨ï¼‰</li>
</ul>
</li>
<li>å…¶ä»–èŠ‚å¥ï¼ˆå‚è€ƒï¼‰<ul>
<li>1 å‘¨ä¸€è¿­ä»£ï¼šâ‰ˆ 11 å‘¨ï¼›å« 20% ç¼“å†² â‰ˆ 3 ä¸ªæœˆ</li>
<li>3 å‘¨ä¸€è¿­ä»£ï¼šâ‰ˆ 33 å‘¨ï¼›å« 20% ç¼“å†² â‰ˆ 7.5â€“8 ä¸ªæœˆ</li>
<li>å•äººå…¨æ ˆï¼ˆä¸¤å‘¨èŠ‚å¥ï¼‰ï¼šåœ¨åŸºçº¿åŸºç¡€ä¸Š +60â€“80% â†’ â‰ˆ 9â€“10 ä¸ªæœˆ</li>
</ul>
</li>
<li>é£é™©ç¼“å†²å»ºè®®<ul>
<li>ä¾›åº”å•†é€‚é…ã€æ€§èƒ½å¼€é”€æ²»ç†ã€ç³»ç»Ÿè”åŠ¨ä¸ç¡®å®šæ€§è¾ƒé«˜ï¼›å»ºè®®é¢„ç•™ 2â€“3 ä¸ª è¿­ä»£ é£é™©ç¼“å†²ï¼Œå¹¶ä» è¿­ä»£ 4 èµ·å¹¶è¡Œæ¨è¿›é€‚é…ä»¥é™ä½å°¾éƒ¨é£é™©</li>
</ul>
</li>
</ul>
<h2 id="è¿­ä»£æé€Ÿè®¡åˆ’ï¼ˆæ–¹æ¡ˆ-Bï¼‰"><a href="#è¿­ä»£æé€Ÿè®¡åˆ’ï¼ˆæ–¹æ¡ˆ-Bï¼‰" class="headerlink" title="è¿­ä»£æé€Ÿè®¡åˆ’ï¼ˆæ–¹æ¡ˆ Bï¼‰"></a>è¿­ä»£æé€Ÿè®¡åˆ’ï¼ˆæ–¹æ¡ˆ Bï¼‰</h2><p>ç›®æ ‡ï¼šåœ¨ä¿æŒ 11 ä¸ª è¿­ä»£ ä¸å˜çš„å‰æä¸‹ï¼Œé›†ä¸­æå‡ è¿­ä»£ 8â€“11 çš„äº§å‡ºä»¥é€¼è¿‘æœ€åˆ 6500 è¡Œç›®æ ‡ã€‚</p>
<p>ç°çŠ¶ä¸å·®è·ï¼ˆæˆªè‡³ v0.6 &#x2F; è¿­ä»£ 7ï¼‰</p>
<ul>
<li>å®é™…å‡€å¢çº¦ 1585 è¡Œï¼ˆä½œè€…å£å¾„ï¼Œè‡ª 8eacb27 èµ·ï¼‰</li>
<li>è®¡åˆ’ç´¯è®¡åº”ä¸º 4800 è¡Œ â†’ å·®è· â‰ˆ 3215 è¡Œ</li>
</ul>
<p>è°ƒæ•´åçš„ è¿­ä»£ ç›®æ ‡ï¼ˆæ¯å‘¨å‡€å¢ç›®æ ‡ï¼‰</p>
<ul>
<li>è¿­ä»£ 8ï¼šâ‰¥ 1000 è¡Œ</li>
<li>è¿­ä»£ 9ï¼šâ‰¥ 1000 è¡Œ</li>
<li>è¿­ä»£ 10ï¼šâ‰¥ 700 è¡Œ</li>
<li>è¿­ä»£ 11ï¼šâ‰¥ 700 è¡Œ</li>
<li>åˆè®¡æ–°å¢ â‰¥ 3400 è¡Œï¼ˆåœ¨ç°çŠ¶åŸºç¡€ä¸Šé€¼è¿‘æˆ–è¾¾åˆ° 6500 æ€»ç›®æ ‡ï¼‰</li>
</ul>
<p>é«˜äº§å‡ºä»»åŠ¡æ± ï¼ˆä¼˜å…ˆæŠ•å…¥ï¼Œå¯å¹¶è¡Œï¼‰</p>
<ul>
<li>ä¾›åº”å•†é€‚é…ï¼ˆamdgpu&#x2F;i915ï¼‰ï¼šæ ¸å¿ƒ hook è¦†ç›– + æœ€å°é—­ç¯ï¼ˆæ¯å®¶ â‰ˆ 800â€“1000 è¡Œï¼‰</li>
<li>ç”¨æˆ·æ€å·¥å…·é“¾å¢å¼ºï¼ˆreport&#x2F;åˆ†æï¼‰ï¼šTop-Nã€æ ‡ç­¾å™¨ã€ç›´æ–¹å›¾ä¸æ—¶é—´çº¿ï¼ˆâ‰ˆ 600â€“800 è¡Œ&#x2F;å‘¨ï¼‰</li>
<li>è‡ªæµ‹ä¸åŸºå‡†ï¼ˆkselftest&#x2F;å‹åŠ›è„šæœ¬ï¼‰ï¼šåŠŸèƒ½&#x2F;å›å½’&#x2F;åŸºå‡†ï¼ˆâ‰ˆ 500â€“800 è¡Œ&#x2F;å‘¨ï¼‰</li>
<li>ç³»ç»Ÿè”åŠ¨ï¼ˆftrace&#x2F;perf&#x2F;eBPFï¼‰ï¼šæ—¶é—´å¯¹é½ä¸å…³è”å­—æ®µï¼ˆâ‰ˆ 400â€“600 è¡Œ&#x2F;å‘¨ï¼‰</li>
</ul>
<h3 id="ä¿éšœæªæ–½"><a href="#ä¿éšœæªæ–½" class="headerlink" title="ä¿éšœæªæ–½"></a>ä¿éšœæªæ–½</h3><ul>
<li>æ˜ç¡®æ¨¡å— Owner ä¸åˆå¹¶çª—å£ï¼Œæ—¥æ›´è¿›åº¦æ¿ï¼›æ¯æ—¥æäº¤å‡€å¢ â‰¥ 150â€“200 è¡Œ</li>
<li>ä»£ç è¯„å®¡ fast-trackï¼š&lt; 24 å°æ—¶é¦–è¯„ï¼Œ&lt; 48 å°æ—¶åˆå…¥æˆ–åé¦ˆ</li>
<li>åº¦é‡ä¸ŠæŠ¥ï¼šä»¥ git numstat ä¸ºå‡†çš„æ–°å¢&#x2F;åˆ é™¤&#x2F;å‡€å¢ä¸é€šè¿‡ç‡ï¼ˆå‘¨ç´¯è®¡ï¼‰</li>
</ul>
<h2 id="ä¾èµ–ä¸å‰ç½®"><a href="#ä¾èµ–ä¸å‰ç½®" class="headerlink" title="ä¾èµ–ä¸å‰ç½®"></a>ä¾èµ–ä¸å‰ç½®</h2><ul>
<li>å†…æ ¸æœ€ä½ç‰ˆæœ¬ä¸é…ç½®ï¼šrelayã€debugfsã€RCUã€ktime</li>
<li>ç›®æ ‡é©±åŠ¨ç‰ˆæœ¬ï¼ˆamdgpu&#x2F;i915&#x2F;nouveauï¼‰ä¸å¼€å¯çš„è°ƒè¯•é€‰é¡¹</li>
<li>æ„å»ºä¸ CI ç¯å¢ƒï¼šç¼–è¯‘å™¨ç‰ˆæœ¬ã€é™æ€æ£€æŸ¥å·¥å…·ã€kselftest æ¡†æ¶</li>
</ul>
<h2 id="é£é™©ä¸ç¼“è§£"><a href="#é£é™©ä¸ç¼“è§£" class="headerlink" title="é£é™©ä¸ç¼“è§£"></a>é£é™©ä¸ç¼“è§£</h2><ul>
<li>çƒ­è·¯å¾„å¼€é”€è¿‡é«˜ â†’ é‡‡æ ·&#x2F;çº§åˆ«æ§åˆ¶ã€æ‰¹é‡å†™å…¥ã€é¢„åˆ†é…ã€ç¼“å­˜å‹å¥½</li>
<li>ä¸åŒé©±åŠ¨å·®å¼‚å¤§ â†’ äº‹ä»¶è¯­ä¹‰æŠ½è±¡ã€åˆ†å±‚é€‚é…ã€å…ˆè¦†ç›–ä¸»è·¯å¾„</li>
<li>æ—¶é—´æˆ³&#x2F;åºåˆ—ä¸€è‡´æ€§é—®é¢˜ â†’ æ˜ç¡®æºã€ç»Ÿä¸€è½¬æ¢ã€ä¸€è‡´æ€§æ ¡éªŒ</li>
<li>æ•°æ®é‡ä¸ç£ç›˜å‹åŠ› â†’ å¯è°ƒç¯å½¢ç¼“å†²ã€æ»šåŠ¨æ–‡ä»¶ã€é˜ˆå€¼æŠ¥è­¦</li>
</ul>
<hr>
<p>æ›´æ–°ç­–ç•¥ï¼šæ¯ä¸ªé‡Œç¨‹ç¢‘ç»“æŸåè¡¥å……â€œå˜æ›´è®°å½•&#x2F;ç»éªŒæ•™è®­&#x2F;åç»­è®¡åˆ’â€ï¼Œå¹¶æ»šåŠ¨ç»´æŠ¤æœ¬è·¯çº¿å›¾ã€‚</p>
<hr>
<h2 id="Definition-of-Doneï¼ˆDoDï¼‰ä¸æ‰§è¡Œå‡†åˆ™ï¼ˆå¼ºçº¦æŸï¼‰"><a href="#Definition-of-Doneï¼ˆDoDï¼‰ä¸æ‰§è¡Œå‡†åˆ™ï¼ˆå¼ºçº¦æŸï¼‰" class="headerlink" title="Definition of Doneï¼ˆDoDï¼‰ä¸æ‰§è¡Œå‡†åˆ™ï¼ˆå¼ºçº¦æŸï¼‰"></a>Definition of Doneï¼ˆDoDï¼‰ä¸æ‰§è¡Œå‡†åˆ™ï¼ˆå¼ºçº¦æŸï¼‰</h2><ul>
<li><p>DoDï¼ˆæ¯ä¸ªäº¤ä»˜æœ€å°‘æ»¡è¶³ï¼‰</p>
<ul>
<li>ä»£ç ï¼šå¯ç¼–è¯‘ï¼ˆå†…æ ¸æ¨¡å— M&#x3D;drivers&#x2F;gpu&#x2F;grtraceï¼‰ã€æ— æœªå®šä¹‰ç¬¦å·ã€é™æ€æ£€æŸ¥æ— æ–°å¢ä¸¥é‡å‘Šè­¦</li>
<li>æ–‡æ¡£ï¼šdebugfs æ¥å£ä¸æ–°é…ç½®é¡¹åœ¨æ–‡æ¡£ä¸­æœ‰è¯´æ˜ä¸ç¤ºä¾‹ï¼ˆè¯»&#x2F;å†™ç¤ºä¾‹ï¼‰</li>
<li>æ¼”ç¤ºï¼š1 ä¸ªæœ€å°åŒ–å†’çƒŸæ­¥éª¤ï¼ˆåŠ è½½æ¨¡å—â†’startâ†’å‘ 3 æ¡äº‹ä»¶â†’stopâ†’è¯»å– stats&#x2F;è§†å›¾ï¼‰</li>
<li>æäº¤ï¼šè‹±æ–‡ã€åˆ†ç‚¹ã€æ— è½¬ä¹‰â€œ\nâ€ï¼›ä½¿ç”¨ commit æ¨¡æ¿æ–‡ä»¶ -F æäº¤</li>
</ul>
</li>
<li><p>å®æ–½èŠ‚å¥</p>
<ul>
<li>æ¯æ—¥å‡€å¢ â‰¥ 150 è¡Œï¼ˆä»¥ git numstat ä¸ºå‡†ï¼‰ï¼Œå¤±è´¥åˆ™ä¸‹æ—¥è¡¥è¶³ï¼›æ¯æ™š 1 æ¬¡æœ€å°å†’çƒŸ</li>
<li>æ¯æ–°å¢æ ¸å¿ƒè¡Œä¸ºï¼ˆè¿‡æ»¤&#x2F;é™é€Ÿ&#x2F;è®¡æ•°&#x2F;è§†å›¾ï¼‰å¿…é¡»ï¼šä»£ç +æ–‡æ¡£+å†’çƒŸä¸‰è”ï¼ŒåŒæ—¶å®Œæˆ</li>
<li>åŠŸèƒ½ä¼˜å…ˆäºè¾“å‡ºèŠ±æ ·ï¼šå…ˆå†…æ ¸æ ¸å¿ƒè·¯å¾„ï¼ˆäº‹ä»¶â†’è¿‡æ»¤â†’é€Ÿç‡â†’å†™å…¥â†’ç»Ÿè®¡ï¼‰</li>
</ul>
</li>
</ul>
<h2 id="å¯æ‰§è¡Œ-WBSï¼ˆæŒ‰æ–‡ä»¶-å‡½æ•°ï¼‰"><a href="#å¯æ‰§è¡Œ-WBSï¼ˆæŒ‰æ–‡ä»¶-å‡½æ•°ï¼‰" class="headerlink" title="å¯æ‰§è¡Œ WBSï¼ˆæŒ‰æ–‡ä»¶&#x2F;å‡½æ•°ï¼‰"></a>å¯æ‰§è¡Œ WBSï¼ˆæŒ‰æ–‡ä»¶&#x2F;å‡½æ•°ï¼‰</h2><ul>
<li><p>å†…æ ¸æ ¸å¿ƒï¼ˆdrivers&#x2F;gpu&#x2F;grtrace&#x2F;grtrace.cï¼‰</p>
<ul>
<li>äº‹ä»¶å‘å°„ï¼šgrtrace_write_event()ï¼ˆé‡‡æ ·&#x2F;è¿‡æ»¤&#x2F;é™é€Ÿ&#x2F;å›å‹&#x2F;å†™å…¥&#x2F;è®¡æ—¶&#x2F;ç›´æ–¹å›¾&#x2F;è®¡æ•°ï¼‰</li>
<li>è¿‡æ»¤ï¼šgrtrace_should_drop_by_filter()ï¼ˆengine&#x2F;ring&#x2F;type + watchlistï¼‰</li>
<li>æ§åˆ¶é¢ï¼šctrl_fops&#x2F;config_fops&#x2F;emit_fopsï¼ˆstart&#x2F;stopã€é…ç½®è¯»å†™ã€æ‰‹åŠ¨å‘å°„ï¼‰</li>
<li>è§†å›¾ï¼ševents_by_type_fops&#x2F;latency_hist_fops&#x2F;pc_*_fops&#x2F;sec_stats_fops</li>
<li>æ¯ç§’ç»Ÿè®¡ï¼šgrtrace_stats_workfn() + sec_stats ring</li>
<li>æ–°å¢ï¼ˆå·²è½åœ°ï¼‰ï¼š<ul>
<li>type æ©ç è¿‡æ»¤ï¼ˆfilter_type_maskï¼‰</li>
<li>ctx watchlistï¼ˆwatch_ctx_add&#x2F;clearã€watch_allow_modeï¼‰</li>
<li>é€Ÿç‡é™åˆ¶ï¼šçª—å£&#x2F;ä»¤ç‰Œæ¡¶ï¼ˆrate_limiter_mode&#x3D;0&#x2F;1ï¼‰</li>
<li>ä¸¢å¼ƒç»†åˆ†ï¼šdisabled&#x2F;payload_oversize&#x2F;reserve_fail</li>
</ul>
</li>
</ul>
</li>
<li><p>ä¾›åº”å•†é€‚é…ï¼ˆæ–°å¢æ–‡ä»¶ï¼ŒæŒ‰é‡Œç¨‹ç¢‘æ¨è¿›ï¼‰</p>
<ul>
<li>drivers&#x2F;gpu&#x2F;grtrace&#x2F;grtrace_i915.cï¼ˆæŒ‚é’©æäº¤&#x2F;å®Œæˆ&#x2F;ctx åˆ‡æ¢ï¼‰</li>
<li>drivers&#x2F;gpu&#x2F;grtrace&#x2F;grtrace_amdgpu.cï¼ˆgfx&#x2F;comp&#x2F;copy æäº¤&#x2F;å®Œæˆ&#x2F;irqï¼‰</li>
</ul>
</li>
</ul>
<h2 id="API-æ•°æ®å¥‘çº¦ï¼ˆç‰‡æ®µï¼‰"><a href="#API-æ•°æ®å¥‘çº¦ï¼ˆç‰‡æ®µï¼‰" class="headerlink" title="API&#x2F;æ•°æ®å¥‘çº¦ï¼ˆç‰‡æ®µï¼‰"></a>API&#x2F;æ•°æ®å¥‘çº¦ï¼ˆç‰‡æ®µï¼‰</h2><ul>
<li>äº‹ä»¶å¤´ grtrace_event_hdrï¼š{type,u16 size,cpu,ts,gseq,cseq}</li>
<li>STREAM_INFO ç´§éš METADATAï¼ˆç°å·²å®ç°ï¼‰ï¼›å‘åå…¼å®¹ï¼šç”¨æˆ·æ€æŒ‰ size è·³è¯»</li>
<li>debugfs&#x2F;config æ”¯æŒé”®ï¼š<ul>
<li>level, sample, profile, max_events_per_sec,</li>
<li>rate_limiter_mode, backpressure_threshold, adaptive_sampling,</li>
<li>filter_engine_mask, filter_ring_id, filter_type_mask,</li>
<li>watch_allow_mode, watch_ctx_add, watch_ctx_clear, reset_stats</li>
</ul>
</li>
<li>stats å¢é‡å­—æ®µï¼šfiltered_type, filtered_watch, rate_limited_drops, backpressure_drops</li>
</ul>
<h2 id="è¿­ä»£-8â€“11-å¯æ‰§è¡Œ-Backlogï¼ˆæ–‡ä»¶-å‡½æ•°çº§ï¼Œå«-LOC-é¢„ä¼°ï¼‰"><a href="#è¿­ä»£-8â€“11-å¯æ‰§è¡Œ-Backlogï¼ˆæ–‡ä»¶-å‡½æ•°çº§ï¼Œå«-LOC-é¢„ä¼°ï¼‰" class="headerlink" title="è¿­ä»£ 8â€“11 å¯æ‰§è¡Œ Backlogï¼ˆæ–‡ä»¶&#x2F;å‡½æ•°çº§ï¼Œå« LOC é¢„ä¼°ï¼‰"></a>è¿­ä»£ 8â€“11 å¯æ‰§è¡Œ Backlogï¼ˆæ–‡ä»¶&#x2F;å‡½æ•°çº§ï¼Œå« LOC é¢„ä¼°ï¼‰</h2><ul>
<li><p>è¿­ä»£ 8ï¼ˆâ‰¥1000 LOCï¼‰</p>
<ul>
<li>[core] äº‹ä»¶å¤§å°ç›´æ–¹å›¾ï¼ˆpayload bucketsï¼‰ä¸å†™å…¥ç»“æœç›´æ–¹å›¾ï¼ˆok&#x2F;short&#x2F;disabled&#x2F;reserve_failï¼‰<ul>
<li>grtrace_write_event()&#x2F;stats_readï¼ˆ+120 LOCï¼‰</li>
</ul>
</li>
<li>[core] ring_id è§‚å¯Ÿåå•ï¼ˆallow&#x2F;deny + AND&#x2F;OR ä¸ ctxï¼‰<ul>
<li>config_fops + grtrace_should_drop_by_filterï¼ˆ+180 LOCï¼‰</li>
</ul>
</li>
<li>[core] STREAM_INFO å¢åŠ  session_id&#x2F;feature bitsï¼ˆç”¨æˆ·æ€å…¼å®¹ä¸å˜ï¼‰ï¼ˆ+80 LOCï¼‰</li>
<li>[vendor] i915 æœ€å°é—­ç¯ï¼ˆæäº¤&#x2F;å®Œæˆ&#x2F;ctxswï¼‰éª¨æ¶æ–‡ä»¶ä¸ç©ºå®ç°ï¼ˆå¯ç¼–è¯‘å ä½ï¼‰ï¼ˆ+350 LOCï¼‰</li>
<li>[kselftest] æœ€å°ç”¨ä¾‹ï¼šåŠ è½½â†’startâ†’emitâ†’è¯»å–â†’æ–­è¨€è®¡æ•°ï¼ˆtools&#x2F;testing&#x2F;selftests&#x2F;grtrace&#x2F;ï¼‰ï¼ˆ+300 LOCï¼‰</li>
</ul>
</li>
<li><p>è¿­ä»£ 9ï¼ˆâ‰¥1000 LOCï¼‰</p>
<ul>
<li>[vendor] amdgpu æœ€å°é—­ç¯ï¼ˆgfx æäº¤&#x2F;å®Œæˆ&#x2F;irq é’©å­éª¨æ¶ï¼‰ï¼ˆ+500 LOCï¼‰</li>
<li>[core] è§„åˆ™å¼•æ“é›å½¢ï¼ˆç®€å•é˜ˆå€¼ï¼št_queue&#x2F;t_exec è¶…é˜ˆç½®æ ‡è®°å­—æ®µï¼‰<ul>
<li>åœ¨ submit&#x2F;complete è·¯å¾„å¢åŠ è§„åˆ™å‘½ä¸­è®¡æ•°ä¸ debugfs è§†å›¾ï¼ˆ+250 LOCï¼‰</li>
</ul>
</li>
<li>[core] sec_stats æ‰©å±•ï¼šæ”¯æŒ burst&#x2F;max_rate è§‚æµ‹ã€token æ§½ä½ï¼ˆ+120 LOCï¼‰</li>
<li>[userspace] tools&#x2F;grtrace å¢åŠ ç»Ÿè®¡æ‰“å°é€‰é¡¹ï¼ˆå¯é€‰ï¼‰ï¼ˆ+200 LOCï¼‰</li>
</ul>
</li>
<li><p>è¿­ä»£ 10ï¼ˆâ‰¥700 LOCï¼‰</p>
<ul>
<li>[core] ftrace&#x2F;perf å¯¹æ—¶æ ‡è®°äº‹ä»¶ï¼ˆå¯¹é½ CPU è°ƒåº¦ï¼‰ï¼ˆ+200 LOCï¼‰</li>
<li>[vendor] i915&#x2F;AMDGPU è¡¥é½ ring&#x2F;å¼•æ“ç»´åº¦ä¸é”™è¯¯äº‹ä»¶ï¼ˆ+300 LOCï¼‰</li>
<li>[kselftest] å‹æµ‹ç”¨ä¾‹ï¼šé«˜äº‹ä»¶ç‡&#x2F;é‡‡æ ·&#x2F;é™é€Ÿ&#x2F;å›å‹ç»„åˆï¼ˆ+200 LOCï¼‰</li>
</ul>
</li>
<li><p>è¿­ä»£ 11ï¼ˆâ‰¥700 LOCï¼‰</p>
<ul>
<li>[core] ç¨³å®šåŒ–ï¼šé”&#x2F;RCU å®¡æ ¸ã€çƒ­è·¯å¾„å¾®ä¼˜åŒ–ã€ç›´æ–¹å›¾å¸¸é‡ä¼˜åŒ–ï¼ˆ+250 LOCï¼‰</li>
<li>[doc+test] æ–‡æ¡£é½å¥—ã€FAQã€kselftest è¦†ç›–åˆ°ä¸»è¦è·¯å¾„ï¼ˆ+250 LOCï¼‰</li>
<li>[vendor] nouveau éª¨æ¶ï¼ˆå¯é€‰ï¼‰ï¼ˆ+200 LOCï¼‰</li>
</ul>
</li>
</ul>
<p>è¯´æ˜ï¼šæ¯é¡¹åŒ…å« DoDï¼ˆä¸‰è”ï¼‰ä¸ commit æ¨¡æ¿ï¼ŒæŒ‰æ—¥æ¨è¿›å¹¶æ ¡éªŒå‡€å¢ LOCã€‚</p>
<h2 id="æœ€å°å†’çƒŸè„šæœ¬ï¼ˆäººå·¥æ­¥éª¤ï¼‰"><a href="#æœ€å°å†’çƒŸè„šæœ¬ï¼ˆäººå·¥æ­¥éª¤ï¼‰" class="headerlink" title="æœ€å°å†’çƒŸè„šæœ¬ï¼ˆäººå·¥æ­¥éª¤ï¼‰"></a>æœ€å°å†’çƒŸè„šæœ¬ï¼ˆäººå·¥æ­¥éª¤ï¼‰</h2><ol>
<li>modprobe grtrace æˆ– insmod grtrace.ko</li>
<li>echo start &gt; &#x2F;sys&#x2F;kernel&#x2F;debug&#x2F;grtrace&#x2F;control</li>
<li>echo â€œsubmit CTX ENG RING SEQâ€ &gt; &#x2F;sys&#x2F;kernel&#x2F;debug&#x2F;grtrace&#x2F;emit ï¼ˆx3ï¼‰</li>
<li>cat &#x2F;sys&#x2F;kernel&#x2F;debug&#x2F;grtrace&#x2F;stats | grep -E â€œ^(written|filtered_)â€</li>
<li>echo stop &gt; &#x2F;sys&#x2F;kernel&#x2F;debug&#x2F;grtrace&#x2F;control</li>
</ol>
<h2 id="æäº¤-åˆ†æ”¯è§„èŒƒï¼ˆé¿å…â€œç³Šæˆä¸€å¨â€ï¼‰"><a href="#æäº¤-åˆ†æ”¯è§„èŒƒï¼ˆé¿å…â€œç³Šæˆä¸€å¨â€ï¼‰" class="headerlink" title="æäº¤&#x2F;åˆ†æ”¯è§„èŒƒï¼ˆé¿å…â€œç³Šæˆä¸€å¨â€ï¼‰"></a>æäº¤&#x2F;åˆ†æ”¯è§„èŒƒï¼ˆé¿å…â€œç³Šæˆä¸€å¨â€ï¼‰</h2><ul>
<li>ä¸€å¾‹ä½¿ç”¨æ–‡ä»¶ -F æ–¹å¼æäº¤ä¿¡æ¯ï¼ˆå«æ ‡é¢˜ + ç©ºè¡Œ + åˆ—è¡¨ï¼‰</li>
<li>æ ‡é¢˜åªç”¨ ASCII å­—ç¬¦ï¼ˆé¿å…é•¿ç ´æŠ˜å·ç­‰ Unicodeï¼‰</li>
<li>ç¤ºä¾‹ï¼š</li>
</ul>
<p>grtrace: add ctx watchlist and token-bucket mode</p>
<ul>
<li>Add ctx_id watchlist (allow&#x2F;deny) wired into filter path.</li>
<li>Add token-bucket rate limiter alongside windowed limiter.</li>
<li>Extend stats with filtered_watch, update sec_stats ring.</li>
</ul>
<hr>
<h2 id="é£é™©åˆ°è¡ŒåŠ¨ï¼ˆå…·ä½“åŒ–ï¼‰"><a href="#é£é™©åˆ°è¡ŒåŠ¨ï¼ˆå…·ä½“åŒ–ï¼‰" class="headerlink" title="é£é™©åˆ°è¡ŒåŠ¨ï¼ˆå…·ä½“åŒ–ï¼‰"></a>é£é™©åˆ°è¡ŒåŠ¨ï¼ˆå…·ä½“åŒ–ï¼‰</h2><ul>
<li>é«˜äº‹ä»¶ç‡å¯¼è‡´çŸ­å†™ï¼šä»¤ç‰Œæ¡¶&#x2F;å›å‹é˜ˆå€¼â†’åœ¨ sec_stats è§‚å¯Ÿ short&#x2F;write_calls æ¯”ä¾‹å¹¶è‡ªé€‚åº”é‡‡æ ·</li>
<li>ä¾›åº”å•†æ¥å£å·®å¼‚ï¼šå…ˆæäº¤ç©ºéª¨æ¶ + ç¼–è¯‘é€šè¿‡ï¼Œå†é€æ­¥æ›¿æ¢é’©å­å®ç°</li>
<li>LOC äº§å‡ºä¸è¶³ï¼šæ¯æ—¥å‡€å¢è¾¾ä¸åˆ°æ—¶ï¼Œä»â€œéª¨æ¶&#x2F;å ä½â€åˆ‡å…¥ï¼ˆè§†å›¾ã€kselftestã€vendor ç©ºå‡½æ•°ï¼‰å¡«å……</li>
</ul>
<hr>
<h2 id="å®é™…ä»£ç é‡ç»Ÿè®¡"><a href="#å®é™…ä»£ç é‡ç»Ÿè®¡" class="headerlink" title="å®é™…ä»£ç é‡ç»Ÿè®¡"></a>å®é™…ä»£ç é‡ç»Ÿè®¡</h2><p>åŸºäºgitæäº¤è®°å½•çš„å®é™…ä»£ç é‡åˆ†æï¼š</p>
<h3 id="å„ç‰ˆæœ¬å®é™…ä»£ç é‡å¯¹æ¯”"><a href="#å„ç‰ˆæœ¬å®é™…ä»£ç é‡å¯¹æ¯”" class="headerlink" title="å„ç‰ˆæœ¬å®é™…ä»£ç é‡å¯¹æ¯”"></a>å„ç‰ˆæœ¬å®é™…ä»£ç é‡å¯¹æ¯”</h3><table>
<thead>
<tr>
<th>ç‰ˆæœ¬</th>
<th>è®¡åˆ’ä»£ç é‡</th>
<th>å®é™…ä»£ç é‡</th>
<th>å®Œæˆåº¦</th>
<th>ä¸»è¦æäº¤</th>
</tr>
</thead>
<tbody><tr>
<td>v0.1 MVP</td>
<td>800è¡Œ</td>
<td>246è¡Œ</td>
<td>31%</td>
<td>5d3e65b4 (relay+debugfsæ ¸å¿ƒ)</td>
</tr>
<tr>
<td>v0.2 å¤šring&#x2F;å¼•æ“</td>
<td>700è¡Œ</td>
<td>102è¡Œ</td>
<td>15%</td>
<td>091ef9f8 (åºåˆ—å·+engine_class)</td>
</tr>
<tr>
<td>v0.3 äº‹ä»¶æ¨¡å‹</td>
<td>900è¡Œ</td>
<td>356è¡Œ</td>
<td>40%</td>
<td>4592fa4b+fcda982a (äº‹ä»¶é›†+METADATA)</td>
</tr>
<tr>
<td>v0.4 å·¥å…·é“¾</td>
<td>1200è¡Œ</td>
<td>589è¡Œ</td>
<td>49%</td>
<td>91c89d26 (CLIå·¥å…·)</td>
</tr>
<tr>
<td>v0.5 æ€§èƒ½æ²»ç†</td>
<td>800è¡Œ</td>
<td>445è¡Œ</td>
<td>56%</td>
<td>fbab7b03+12d848cd+cd2b731d</td>
</tr>
<tr>
<td>v0.6 æŒä¹…åŒ–æ ¼å¼</td>
<td>400è¡Œ</td>
<td>165è¡Œ</td>
<td>41%</td>
<td>fcda982a (å·²åŒ…å«åœ¨v0.3)</td>
</tr>
<tr>
<td>v0.7 ä¾›åº”å•†é€‚é…</td>
<td>900è¡Œ</td>
<td>451è¡Œ</td>
<td>50%</td>
<td>a452c062+83b63505+bridge</td>
</tr>
<tr>
<td>v0.8 ç³»ç»Ÿè”åŠ¨</td>
<td>500è¡Œ</td>
<td>13è¡Œ</td>
<td>3%</td>
<td>tracepointå¯¼å‡º</td>
</tr>
<tr>
<td>v0.9 ç¨³å®šåŒ–</td>
<td>200è¡Œ</td>
<td>489è¡Œ</td>
<td>245%</td>
<td>selftestså¥—ä»¶</td>
</tr>
<tr>
<td><strong>æ€»è®¡</strong></td>
<td><strong>6500è¡Œ</strong></td>
<td><strong>2856è¡Œ</strong></td>
<td><strong>44%</strong></td>
<td>35ä¸ªæäº¤</td>
</tr>
</tbody></table>
<h3 id="é™„å½•-Aï¼šå„ç‰ˆæœ¬å®¡è®¡æ˜ç»†ï¼ˆå¤ç°å‘½ä»¤ä¸å…³é”®å‘ç°ï¼‰"><a href="#é™„å½•-Aï¼šå„ç‰ˆæœ¬å®¡è®¡æ˜ç»†ï¼ˆå¤ç°å‘½ä»¤ä¸å…³é”®å‘ç°ï¼‰" class="headerlink" title="é™„å½• Aï¼šå„ç‰ˆæœ¬å®¡è®¡æ˜ç»†ï¼ˆå¤ç°å‘½ä»¤ä¸å…³é”®å‘ç°ï¼‰"></a>é™„å½• Aï¼šå„ç‰ˆæœ¬å®¡è®¡æ˜ç»†ï¼ˆå¤ç°å‘½ä»¤ä¸å…³é”®å‘ç°ï¼‰</h3><p>å¤ç°å®¡è®¡ï¼ˆç¤ºä¾‹å‘½ä»¤ï¼‰ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git diff --numstat 5d3e65b4^..8896f28 -- drivers/gpu/grtrace<br></code></pre></td></tr></table></figure>

<h4 id="å…³é”®å‘ç°"><a href="#å…³é”®å‘ç°" class="headerlink" title="å…³é”®å‘ç°"></a>å…³é”®å‘ç°</h4><ol>
<li><strong>å®ç°æ›´ç²¾ç®€</strong>: å®é™…ä»£ç é‡æ¯”è®¡åˆ’å°‘56%ï¼Œè¯´æ˜å®ç°æ›´åŠ é«˜æ•ˆç²¾ç®€</li>
<li><strong>æµ‹è¯•æŠ•å…¥å¤§</strong>: v0.9ç¨³å®šåŒ–è¶…å‡ºè®¡åˆ’145%ï¼Œä½“ç°äº†å¯¹è´¨é‡çš„é‡è§†</li>
<li><strong>æ ¸å¿ƒåŠŸèƒ½å®Œæ•´</strong>: è™½ç„¶ä»£ç é‡å°‘ï¼Œä½†æ ¸å¿ƒåŠŸèƒ½(v0.1-v0.7)åŸºæœ¬å®Œæ•´å®ç°</li>
<li><strong>ç³»ç»Ÿè”åŠ¨ä¸è¶³</strong>: v0.8ä»…å®ŒæˆåŸºç¡€tracepointå¯¼å‡ºï¼Œå®Œæ•´é›†æˆå¾…è¡¥å……</li>
</ol>
<h4 id="ä»£ç åˆ†å¸ƒåˆ†æ"><a href="#ä»£ç åˆ†å¸ƒåˆ†æ" class="headerlink" title="ä»£ç åˆ†å¸ƒåˆ†æ"></a>ä»£ç åˆ†å¸ƒåˆ†æ</h4><ul>
<li><strong>å†…æ ¸æ ¸å¿ƒ</strong>: ~1710è¡Œ (grtrace.c)</li>
<li><strong>ä¾›åº”å•†é€‚é…</strong>: ~435è¡Œ (amdgpu+i915+bridge)</li>
<li><strong>ç”¨æˆ·æ€å·¥å…·</strong>: ~730è¡Œ (CLIå·¥å…·)</li>
<li><strong>æµ‹è¯•ç”¨ä¾‹</strong>: ~489è¡Œ (selftests)</li>
<li><strong>é…ç½®æ„å»º</strong>: ~100è¡Œ (Kconfig+Makefileç­‰)</li>
</ul>
<p><strong>ç»“è®º</strong>: è™½ç„¶æ€»ä»£ç é‡ä¸åŠè®¡åˆ’ï¼Œä½†åŠŸèƒ½å®Œæ•´åº¦é«˜ï¼Œæ¶æ„è®¾è®¡åˆç†ï¼Œæ˜¯ä¸€ä¸ªé«˜è´¨é‡çš„ç²¾ç®€å®ç°ã€‚</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/linux/" class="category-chain-item">linux</a>
  
  
    <span>></span>
    
  <a href="/categories/linux/drivers/" class="category-chain-item">drivers</a>
  
  
    <span>></span>
    
  <a href="/categories/linux/drivers/gpu/" class="category-chain-item">gpu</a>
  
  
    <span>></span>
    
  <a href="/categories/linux/drivers/gpu/grtrace/" class="category-chain-item">grtrace</a>
  
  
    <span>></span>
    
  <a href="/categories/linux/drivers/gpu/grtrace/docs/" class="category-chain-item">docs</a>
  
  

  

  

  

  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/bpf/">#bpf</a>
      
        <a href="/tags/deb/">#deb</a>
      
        <a href="/tags/debug/">#debug</a>
      
        <a href="/tags/docker/">#docker</a>
      
        <a href="/tags/drivers/">#drivers</a>
      
        <a href="/tags/fs/">#fs</a>
      
        <a href="/tags/git/">#git</a>
      
        <a href="/tags/go/">#go</a>
      
        <a href="/tags/gpu/">#gpu</a>
      
        <a href="/tags/kernel/">#kernel</a>
      
        <a href="/tags/linux/">#linux</a>
      
        <a href="/tags/log/">#log</a>
      
        <a href="/tags/markdown/">#markdown</a>
      
        <a href="/tags/perf/">#perf</a>
      
        <a href="/tags/performance/">#performance</a>
      
        <a href="/tags/python/">#python</a>
      
        <a href="/tags/testing/">#testing</a>
      
        <a href="/tags/tools/">#tools</a>
      
        <a href="/tags/virt/">#virt</a>
      
        <a href="/tags/mm/">#mm</a>
      
        <a href="/tags/proc/">#proc</a>
      
        <a href="/tags/sync/">#sync</a>
      
        <a href="/tags/rcu/">#rcu</a>
      
        <a href="/tags/irq/">#irq</a>
      
        <a href="/tags/grtrace/">#grtrace</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>grtrace å¼€å‘è¿­ä»£è®¡åˆ’ï¼ˆRoadmapï¼‰</div>
      <div>https://realwujing.github.io/linux/drivers/gpu/grtrace/docs/grtrace å¼€å‘è¿­ä»£è®¡åˆ’/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>ä½œè€…</div>
          <div>Wu Jing</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>å‘å¸ƒäº</div>
          <div>2025å¹´11æœˆ21æ—¥</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>è®¸å¯åè®®</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - ç½²å">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/linux/drivers/gpu/grtrace/docs/GPU%20Ring%20Buffer%E8%BF%BD%E8%B8%AA%E6%9E%B6%E6%9E%84%E6%B7%B1%E5%BA%A6%E5%88%86%E6%9E%90%EF%BC%9A%E4%BB%8Eblktrace%E5%88%B0grtrace%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%BC%94%E8%BF%9B/" title="GPU Ring Bufferè¿½è¸ªæ¶æ„æ·±åº¦åˆ†æï¼šä»blktraceåˆ°grtraceçš„è®¾è®¡æ¼”è¿›">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">GPU Ring Bufferè¿½è¸ªæ¶æ„æ·±åº¦åˆ†æï¼šä»blktraceåˆ°grtraceçš„è®¾è®¡æ¼”è¿›</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/linux/drivers/modules/bugs/insmod/ubuntu22.04%20panic%20on%20insmod/" title="ubuntu22.04 panic on insmod">
                        <span class="hidden-mobile">ubuntu22.04 panic on insmod</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="gitalk-container"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#gitalk-container', function() {
      Fluid.utils.createCssLink('/css/gitalk.css')
      Fluid.utils.createScript('https://lib.baomitu.com/gitalk/1.8.0/gitalk.min.js', function() {
        var options = Object.assign(
          {"clientID":"c11f8471a6ae4d3eea12","clientSecret":"87bfa232882af2b005f4c3352132dd418bf6d113","repo":"realwujing.github.io","owner":"realwujing","admin":["realwujing"],"language":"zh-CN","labels":["Gitalk"],"perPage":10,"pagerDirection":"last","distractionFreeMode":false,"createIssueManually":false,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token"},
          {
            id: '075c1a2072691025e704bb1beb2d3c92'
          }
        )
        var gitalk = new Gitalk(options);
        gitalk.render('gitalk-container');
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>ç›®å½•</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  





  <script>
  Fluid.utils.createScript('https://lib.baomitu.com/mermaid/8.14.0/mermaid.min.js', function() {
    mermaid.initialize({"theme":"default"});

    Fluid.events.registerRefreshCallback(function() {
      if ('mermaid' in window) {
        mermaid.init();
      }
    });
  });
</script>






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        æ€»è®¿é—®é‡ 
        <span id="busuanzi_value_site_pv"></span>
         æ¬¡
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        æ€»è®¿å®¢æ•° 
        <span id="busuanzi_value_site_uv"></span>
         äºº
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }

        Fluid.events.registerRefreshCallback(function() {
          if ('MathJax' in window && MathJax.startup.document && typeof MathJax.startup.document.state === 'function') {
            MathJax.startup.document.state(0);
            MathJax.texReset();
            MathJax.typeset();
            MathJax.typesetPromise();
          }
        });
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js" ></script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ï¼Œå°†å®ƒä¿æŒåœ¨æœ€åº•éƒ¨ -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">åšå®¢åœ¨å…è®¸ JavaScript è¿è¡Œçš„ç¯å¢ƒä¸‹æµè§ˆæ•ˆæœæ›´ä½³</div>
  </noscript>
</body>
</html>
